import{u as M,j as e}from"./app-CZwS2G5Y.js";import{r as u}from"./vendor-DkBadjUr.js";import{D as L,a as q,b as D,c as E,d as F}from"./dialog-Tf1FOk7X.js";import{B as _}from"./button-BesobgtA.js";import{I as o}from"./input-BuSGIsg0.js";import{L as l}from"./label-IliVNXtj.js";import{U as B}from"./unitOptions-DzV97WAR.js";import{H as I}from"./hash-AgYeaIxt.js";import{C as P}from"./calendar-D9APQM2e.js";import{P as R}from"./package-L7rgkkVO.js";import{c as b}from"./createLucideIcon-BKWaAi2G.js";import{T as A}from"./trending-down-DADUT3dQ.js";import{T as O}from"./trending-up-BFbz08q-.js";import{P as H}from"./plus-MavOGQlj.js";import{m as V}from"./proxy-C0TaRtDf.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-Bo4nchVy.js";import"./index-B3OEEYC6.js";import"./index-VaCZcEHj.js";import"./tslib.es6-M_FJ09fS.js";import"./index-Bgkzuaxa.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]],U=b("Factory",$);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],W=b("Scale",X),ge=({open:v,onClose:h,item:t,categories:Z=[],onBatchAdded:y,onCloseEditModal:j})=>{const[k,N]=u.useState({storage_location:"",batch_number:"",expiry_date:"",minimum_stock:"",maximum_stock:"",unit_of_measure:"",manufacturer:"",current_quantity:""}),[w,c]=u.useState(!1),[C,p]=u.useState(""),[x,g]=u.useState("success");u.useEffect(()=>{t&&N({storage_location:t.storageLocation||"",batch_number:"",expiry_date:"",minimum_stock:t.minimum_stock||t.minimumStock||"",maximum_stock:t.maximum_stock||t.maximumStock||"",unit_of_measure:t.unit||t.unit_type||"",manufacturer:t.manufacturer||"",current_quantity:t.currentQuantity||t.quantity||t.stock?.stocks||""})},[t]);const{data:s,setData:T,post:z,processing:f,errors:a}=M(k),i=n=>{const{name:m,value:d}=n.target;T(m,d),N(r=>({...r,[m]:d}))},S=n=>{if(n.preventDefault(),console.log("Form submitted with data:",s),console.log("Item object:",t),!s.batch_number.trim()){console.log("Validation failed: No batch number"),alert("Please enter a batch number");return}if(!s.expiry_date){console.log("Validation failed: No expiry date"),alert("Please select an expiry date");return}if(s.expiry_date&&new Date(s.expiry_date)<=new Date){console.log("Validation failed: Expiry date in past"),alert("Expiry date must be in the future");return}const m={itemname:t.name||"",categoryid:t.categoryId||t.category?.id||"",manufacturer:s.manufacturer||t.manufacturer||"",description:t.description||"",unit_type:s.unit_of_measure||t.unit||t.unit_type||"",storage_location:s.storage_location||"",batch_number:s.batch_number.trim(),expiry_date:s.expiry_date,minimum_stock:s.minimum_stock||"",maximum_stock:s.maximum_stock||"",current_quantity:s.current_quantity||"",original_item_id:t.id};console.log("Item object:",t),console.log("Creating new batch:",m),console.log("About to call post with route:",route("pharmacist.inventory.item.add-batch"));const d=setTimeout(()=>{console.log("Request timeout - resetting loading state"),p("Request timed out. Please try again."),g("error"),c(!0),setTimeout(()=>{c(!1)},3e3)},1e4);fetch(route("pharmacist.inventory.item.add-batch"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(m)}).then(r=>{if(clearTimeout(d),console.log("Response received:",r.status),r.ok)return r.json();throw new Error(`HTTP error! status: ${r.status}`)}).then(r=>{console.log("Batch creation successful:",r),p("Batch added successfully!"),g("success"),c(!0),setTimeout(()=>{c(!1),h(),j&&j(),y&&y()},2e3)}).catch(r=>{clearTimeout(d),console.error("Error creating batch:",r),p("Error creating batch: "+r.message),g("error"),c(!0),setTimeout(()=>{c(!1)},3e3)})};return t?e.jsxs(L,{open:v,onOpenChange:h,children:[e.jsxs(q,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(E,{className:"text-xl font-semibold text-gray-900",children:"Add New Batch"}),e.jsxs("p",{className:"text-sm text-gray-600",children:['Add a new batch for "',t.name,'"']})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Batch Information"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"New batch details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"batch_number",name:"batch_number",value:s.batch_number,onChange:i,placeholder:"Enter batch number (e.g., RX12001121)",className:"pl-10",required:!0})]}),a.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:a.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"expiry_date",name:"expiry_date",type:"date",value:s.expiry_date,onChange:i,className:"pl-10",required:!0})]}),a.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:a.expiry_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"storage_location",className:"text-sm font-medium",children:"Storage Location"}),e.jsx(o,{id:"storage_location",name:"storage_location",value:s.storage_location,onChange:i,placeholder:"Enter storage location"}),a.storage_location&&e.jsx("p",{className:"text-sm text-red-600",children:a.storage_location})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Item Information"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Current item details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"current_quantity",className:"text-sm font-medium",children:"Current Quantity"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"current_quantity",name:"current_quantity",type:"number",value:s.current_quantity,onChange:i,placeholder:"Enter current quantity",className:"pl-10",readOnly:!0})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Current stock level (read-only)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"unit_of_measure",className:"text-sm font-medium",children:"Unit of Measure"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsxs("select",{id:"unit_of_measure",name:"unit_of_measure",value:s.unit_of_measure,onChange:i,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select unit"}),B.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]})]}),a.unit_of_measure&&e.jsx("p",{className:"text-sm text-red-600",children:a.unit_of_measure})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"manufacturer",className:"text-sm font-medium",children:"Manufacturer"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"manufacturer",name:"manufacturer",value:s.manufacturer,onChange:i,placeholder:"Enter manufacturer name",className:"pl-10"})]}),a.manufacturer&&e.jsx("p",{className:"text-sm text-red-600",children:a.manufacturer})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"minimum_stock",className:"text-sm font-medium",children:"Minimum Stock Level"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"minimum_stock",name:"minimum_stock",type:"number",min:"0",value:s.minimum_stock,onChange:i,placeholder:"Enter minimum stock level",className:"pl-10"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alert threshold for low stock"}),a.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600",children:a.minimum_stock})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"maximum_stock",className:"text-sm font-medium",children:"Maximum Stock Level"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"maximum_stock",name:"maximum_stock",type:"number",min:"0",value:s.maximum_stock,onChange:i,placeholder:"Enter maximum stock level",className:"pl-10"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum capacity limit"}),a.maximum_stock&&e.jsx("p",{className:"text-sm text-red-600",children:a.maximum_stock})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Stock Level Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:s.current_quantity||0}),e.jsx("div",{className:"text-gray-600",children:"Current"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:s.minimum_stock||0}),e.jsx("div",{className:"text-gray-600",children:"Minimum"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:s.maximum_stock||0}),e.jsx("div",{className:"text-gray-600",children:"Maximum"})]})]})]})]}),e.jsxs(F,{className:"flex justify-end space-x-2",children:[e.jsx(_,{type:"button",variant:"outline",onClick:h,disabled:f,children:"Cancel"}),e.jsxs(_,{type:"submit",disabled:f,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),f?"Adding Batch...":"Add Batch"]})]})]})]}),w&&e.jsx(V.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:`fixed top-4 right-4 z-50 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden ${x==="success"?"border-l-4 border-green-400":"border-l-4 border-red-400"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`flex-shrink-0 ${x==="success"?"text-green-400":"text-red-400"}`,children:x==="success"?e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:`text-sm font-medium ${x==="success"?"text-green-800":"text-red-800"}`,children:C})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:()=>c(!1),children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})})})]}):null};export{ge as default};
