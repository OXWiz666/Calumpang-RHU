import{j as o}from"./app-CpaPFaK-.js";import{r as a}from"./vendor-DkBadjUr.js";class j{constructor(){this.TOKEN_KEY="patient_verification_token",this.TOKEN_EXPIRY_HOURS=24}generateToken(){return"token_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}createTokenSession(i){const r=this.generateToken(),d=Date.now(),y=d+this.TOKEN_EXPIRY_HOURS*60*60*1e3,g={token:r,patientData:i,timestamp:d,expiresAt:y};return localStorage.setItem(this.TOKEN_KEY,JSON.stringify(g)),r}getTokenSession(){try{const i=localStorage.getItem(this.TOKEN_KEY);if(!i)return null;const r=JSON.parse(i);return Date.now()>r.expiresAt?(this.clearTokenSession(),null):r}catch(i){return console.error("Error retrieving token session:",i),this.clearTokenSession(),null}}hasValidTokenSession(){return this.getTokenSession()!==null}getPatientData(){const i=this.getTokenSession();return i?i.patientData:null}updatePatientData(i){const r=this.getTokenSession();return r?(r.patientData={...r.patientData,...i},localStorage.setItem(this.TOKEN_KEY,JSON.stringify(r)),!0):!1}clearTokenSession(){localStorage.removeItem(this.TOKEN_KEY)}refreshTokenSession(){const i=this.getTokenSession();return i?(i.expiresAt=Date.now()+this.TOKEN_EXPIRY_HOURS*60*60*1e3,localStorage.setItem(this.TOKEN_KEY,JSON.stringify(i)),!0):!1}getTokenExpiryMinutes(){const i=this.getTokenSession();if(!i)return 0;const r=i.expiresAt-Date.now();return Math.max(0,Math.floor(r/(60*1e3)))}}const C=new j,O=({formData:s,setFormData:i,isDisabled:r=!1})=>{const[d,y]=a.useState([]),[g,p]=a.useState([]),[u,f]=a.useState([]),[b,h]=a.useState([]),[l,c]=a.useState({regions:!1,provinces:!1,cities:!1,barangays:!1});a.useEffect(()=>{v()},[]),a.useEffect(()=>{if(s.region_id){const e=d.find(n=>n.id.toString()===s.region_id.toString());e&&e.region_id&&_(e.region_id)}else p([]),f([]),h([]),i(e=>({...e,province_id:null,city_id:null,barangay_id:null,province:"",city:"",barangay:""}))},[s.region_id,d]),a.useEffect(()=>{if(s.province_id){const e=g.find(n=>n.id.toString()===s.province_id.toString());e&&e.province_id&&S(e.province_id)}else f([]),h([]),i(e=>({...e,city_id:null,barangay_id:null,city:"",barangay:""}))},[s.province_id,g]),a.useEffect(()=>{if(s.city_id){const e=u.find(n=>n.id.toString()===s.city_id.toString());e&&e.city_id&&x(e.city_id)}else h([]),i(e=>({...e,barangay_id:null,barangay:""}))},[s.city_id,u]);const v=async()=>{c(e=>({...e,regions:!0}));try{const e=await fetch("/api/address/regions");if(!e.ok)throw new Error("Failed to fetch regions");const n=await e.json();console.log("Regions data:",n),y(n)}catch(e){console.error("Error loading regions:",e)}finally{c(e=>({...e,regions:!1}))}},_=async e=>{c(n=>({...n,provinces:!0}));try{const n=await fetch(`/api/address/provinces/${e}`);if(!n.ok)throw new Error("Failed to fetch provinces");const t=await n.json();console.log("Provinces data:",t),p(t)}catch(n){console.error("Error loading provinces:",n)}finally{c(n=>({...n,provinces:!1}))}},S=async e=>{c(n=>({...n,cities:!0}));try{const n=await fetch(`/api/address/cities/${e}`);if(!n.ok)throw new Error("Failed to fetch cities");const t=await n.json();console.log("Cities data:",t),f(t)}catch(n){console.error("Error loading cities:",n)}finally{c(n=>({...n,cities:!1}))}},x=async e=>{c(n=>({...n,barangays:!0}));try{const n=await fetch(`/api/address/barangays/${e}`);if(!n.ok)throw new Error("Failed to fetch barangays");const t=await n.json();console.log("Barangays data:",t),h(t)}catch(n){console.error("Error loading barangays:",n)}finally{c(n=>({...n,barangays:!1}))}},w=e=>{const n=d.find(t=>t.id.toString()===e);i(t=>({...t,region_id:e,region:n?.name||"",province_id:null,city_id:null,barangay_id:null,province:"",city:"",barangay:""}))},k=e=>{const n=g.find(t=>t.id==e);i(t=>({...t,province_id:e,province:n?.name||"",city_id:null,barangay_id:null,city:"",barangay:""}))},E=e=>{const n=u.find(t=>t.id==e);i(t=>({...t,city_id:e,city:n?.name||"",barangay_id:null,barangay:""}))},m=e=>{const n=b.find(t=>t.id==e);i(t=>({...t,barangay_id:e,barangay:n?.name||""}))};return o.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Region *"}),o.jsxs("select",{value:s.region_id?.toString()||"",onChange:e=>w(e.target.value),disabled:r||l.regions,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md bg-white",children:[o.jsx("option",{value:"",children:l.regions?"Loading regions...":"Select Region"}),d.map(e=>o.jsx("option",{value:e.id.toString(),children:e.name},e.id))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Province *"}),o.jsxs("select",{value:s.province_id?.toString()||"",onChange:e=>k(e.target.value),disabled:r||l.provinces||!s.region_id,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md bg-white",children:[o.jsx("option",{value:"",children:l.provinces?"Loading provinces...":s.region_id?"Select Province":"Select Region first"}),g.map(e=>o.jsx("option",{value:e.id.toString(),children:e.name},e.id))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"City *"}),o.jsxs("select",{value:s.city_id?.toString()||"",onChange:e=>E(e.target.value),disabled:r||l.cities||!s.province_id,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md bg-white",children:[o.jsx("option",{value:"",children:l.cities?"Loading cities...":s.province_id?"Select City":"Select Province first"}),u.map(e=>o.jsx("option",{value:e.id.toString(),children:e.name},e.id))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Barangay *"}),o.jsxs("select",{value:s.barangay_id?.toString()||"",onChange:e=>m(e.target.value),disabled:r||l.barangays||!s.city_id,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm hover:shadow-md bg-white",children:[o.jsx("option",{value:"",children:l.barangays?"Loading barangays...":s.city_id?"Select Barangay":"Select City first"}),b.map(e=>o.jsx("option",{value:e.id.toString(),children:e.name},e.id))]})]})]})};export{O as P,C as t};
