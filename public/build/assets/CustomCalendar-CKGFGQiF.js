import{j as t}from"./app-Bz1k8fwb.js";import{R as X,r as f}from"./vendor-DkBadjUr.js";import{C as Y}from"./calendar-D9APQM2e.js";import{C as q}from"./chevron-left-B36-TXNE.js";import{C as z}from"./chevron-right-B3qqnx4D.js";import{C as G}from"./circle-x-Cf2XhiVO.js";import{C as w}from"./circle-alert-D8zT41fC.js";import{C as H}from"./circle-check-big-BQVCuGNJ.js";import{f as u}from"./format-Dp3w_Y3x.js";import{i as K,a as D,s as y,e as h,b as Q}from"./isSameMonth-BOwz-_mK.js";import{i as V,e as Z,s as I}from"./subMonths-B67T7BWk.js";import{i as ee}from"./isBefore-Bnl9x5VB.js";import"./pusher-DVtoYAOu.js";import"./createLucideIcon-BKWaAi2G.js";const fe=({selectedDate:m,onDateSelect:M,hasPrograms:v=[],serviceId:n=null,subserviceId:S=null})=>{const[i,p]=X.useState(new Date),[g,C]=f.useState({}),[te,j]=f.useState(!1);console.log("CustomCalendar received serviceId:",n,"type:",typeof n);const k=async()=>{if(!n||n===""||n===null||n===void 0){console.log("No valid serviceId provided to calendar:",n);return}console.log("Fetching availability for serviceId:",n),j(!0);try{const e=y(i),l=h(i),o=`/patient/get-date-availability?start_date=${u(e,"yyyy-MM-dd")}&end_date=${u(l,"yyyy-MM-dd")}&service_id=${Number(n)}`;console.log("Fetching from URL:",o);const a=await fetch(o);if(!a.ok)throw console.error("API call failed:",a.status,a.statusText),new Error(`API call failed: ${a.status} ${a.statusText}`);const s=await a.json();if(console.log("API Response:",s),console.log("API Response type:",typeof s),console.log("API Response keys:",Object.keys(s)),s.availability&&Array.isArray(s.availability)){const r={};s.availability.forEach(c=>{r[c.date]=c}),C(r),console.log("‚úÖ Date availability loaded successfully:",r),console.log("‚úÖ Availability map keys:",Object.keys(r)),console.log("‚úÖ Sample availability data:",r[Object.keys(r)[0]])}else console.log("‚ùå No availability data received:",s),console.log("‚ùå data.availability:",s.availability),console.log("‚ùå data.availability type:",typeof s.availability),console.log("‚ùå Full API response:",JSON.stringify(s,null,2))}catch(e){console.error("Error fetching date availability:",e)}finally{j(!1)}};f.useEffect(()=>{console.log("Calendar useEffect triggered - serviceId:",n,"currentMonth:",i),k()},[i,n,S]);const A=()=>{const e=y(i),l=h(i);return Z({start:e,end:l})},E=()=>{const e=y(i),l=e.getDay();if(l===0)return[];const o=new Date(e);o.setDate(0);const a=l,s=[];for(let r=0;r<a;r++){const c=new Date(o);c.setDate(o.getDate()-r),s.unshift(c)}return s},$=()=>{const e=h(i),l=e.getDay();if(l===6)return[];const o=6-l,a=[];for(let s=1;s<=o;s++){const r=new Date(e);r.setDate(e.getDate()+s),a.push(r)}return a},O=e=>{e.preventDefault(),p(I(i))},P=e=>{e.preventDefault(),p(Q(i,1))},F=(e,l=[])=>{const o=u(e,"EEEE");return l.includes(o)},x=e=>{const l=u(e,"yyyy-MM-dd"),o=g[l];if(console.log(`üîç Checking availability for ${l}:`,o),console.log("dateAvailability keys:",Object.keys(g)),console.log("dateAvailability object:",g),!o)return console.log(`No availability data for ${l}`),"unknown";u(e,"EEEE");const a=o.max_slots,s=o.appointment_count||0;if(!a||a===0)return"full";const r=Math.max(0,a-s);return console.log(`${l}: maxSlots=${a}, usedSlots=${s}, availableSlots=${r}`),r===0?"full":r<=2?"limited":r<=5?"moderate":"available"},R=e=>{const l=u(e,"yyyy-MM-dd"),o=g[l];if(!o)return{available:0,total:0};const a=o.max_slots,s=o.appointment_count||0;return!a||a===0?{available:0,total:0}:{available:Math.max(0,a-s),total:a}},_=e=>{switch(x(e)){case"available":return t.jsx(H,{className:"h-3 w-3 text-green-500"});case"moderate":return t.jsx(w,{className:"h-3 w-3 text-yellow-500"});case"limited":return t.jsx(w,{className:"h-3 w-3 text-orange-500"});case"full":return t.jsx(G,{className:"h-3 w-3 text-red-500"});default:return null}},T=e=>{switch(x(e)){case"available":return"bg-green-100 border-green-300 text-green-800";case"moderate":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"limited":return"bg-orange-100 border-orange-300 text-orange-800";case"full":return"bg-red-100 border-red-300 text-red-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}},L=[...E(),...A(),...$()],W=["Su","Mo","Tu","We","Th","Fr","Sa"];return!n||n===""||n===null||n===void 0?(console.log('Showing "Select a Service First" message because serviceId is:',n),t.jsx("div",{className:"w-full",children:t.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsx(Y,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Select a Service First"}),t.jsx("p",{className:"text-gray-500",children:"Please select a service type to view available appointment dates."})]})})):t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:O,className:"p-1 rounded-full hover:bg-gray-100","aria-label":"Previous month",children:t.jsx(q,{className:"h-5 w-5"})}),t.jsx("h2",{className:"text-base font-medium",children:u(i,"MMMM yyyy")}),t.jsx("button",{onClick:P,className:"p-1 rounded-full hover:bg-gray-100","aria-label":"Next month",children:t.jsx(z,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[W.map(e=>t.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-1",children:e},e)),L.map((e,l)=>{const o=K(e,i),a=m&&D(e,m);e.getDate()===31&&e.getMonth()===9&&(console.log("October 31 debug:"),console.log("day:",e),console.log("selectedDate:",m),console.log("isSelected:",a),console.log("isSameDay result:",m?D(e,m):!1));const s=F(e,v),r=V(e);u(e,"EEEE");const c=ee(new Date,e),d=x(e),N=_(e),B=T(e),b=R(e);return e.getDate()>=26&&e.getDate()<=31&&e.getMonth()===9&&(console.log(`üîç October ${e.getDate()} Debug:`),console.log("isFutureDay:",c),console.log("availabilityStatus:",d),console.log("isProgramDay:",s),console.log("hasPrograms:",v),console.log("Will be disabled:",!c||d==="full")),t.jsxs("button",{onClick:J=>{J.preventDefault();const U=new Date(e.getFullYear(),e.getMonth(),e.getDate());M(U)},disabled:!c||d==="full",className:`
                h-12 w-12 mx-auto flex flex-col items-center justify-center rounded-lg text-sm relative border-2
                ${o?"":"text-gray-400"}
                ${a?"bg-blue-500 text-white border-blue-500":""}
                ${!a&&c&&d!=="unknown"?B||"bg-blue-50 border-blue-200":""}
                ${r&&!a?"border-2 border-blue-500":""}
                ${d==="full"?"opacity-50 cursor-not-allowed":""}
                hover:bg-gray-100 transition-all duration-200
              `,title:c?d!=="unknown"?`${b.available}/${b.total} slots available`:"No data available":"Cannot select past or current date",children:[t.jsx("span",{className:"text-xs font-medium",children:u(e,"d")}),c&&d!=="unknown"&&t.jsxs("div",{className:"text-xs font-bold mt-0.5 flex items-center gap-1",children:[t.jsx("span",{className:`${d==="available"?"text-green-700":d==="moderate"?"text-yellow-700":d==="limited"?"text-orange-700":"text-red-700"}`,children:b.available}),t.jsxs("span",{className:"text-gray-500",children:["/",b.total]})]}),N&&t.jsx("div",{className:"absolute -top-1 -right-1",children:N})]},l)})]}),n&&t.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[t.jsxs("h4",{className:"text-sm font-semibold text-gray-800 mb-3 flex items-center",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),"Slot Availability Legend"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 bg-green-100 border-2 border-green-300 rounded flex items-center justify-center",children:t.jsx("span",{className:"text-green-700 text-xs font-bold"})}),t.jsx("span",{className:"text-gray-700 font-medium",children:"Available (6+ slots)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 bg-yellow-100 border-2 border-yellow-300 rounded flex items-center justify-center",children:t.jsx("span",{className:"text-yellow-700 text-xs font-bold"})}),t.jsx("span",{className:"text-gray-700 font-medium",children:"Moderate (3-5 slots)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 bg-orange-100 border-2 border-orange-300 rounded flex items-center justify-center",children:t.jsx("span",{className:"text-orange-700 text-xs font-bold"})}),t.jsx("span",{className:"text-gray-700 font-medium",children:"Limited (1-2 slots)"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 bg-red-100 border-2 border-red-300 rounded flex items-center justify-center",children:t.jsx("span",{className:"text-red-700 text-xs font-bold"})}),t.jsx("span",{className:"text-gray-700 font-medium",children:"Full (0 slots)"})]})]})]})]})};export{fe as default};
