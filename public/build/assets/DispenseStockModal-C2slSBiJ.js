import{u as Ue,j as e,r as ze}from"./app-Dq_Q3Qwg.js";import{r as x}from"./vendor-DkBadjUr.js";import{D as O,a as B,b as U,c as z,e as me,d as Q}from"./dialog-BOQ1IyqS.js";import{B as N}from"./button-C5uFo_s4.js";import{I as q}from"./input-onBXUy1Y.js";import{L as j}from"./label-D-GXHI76.js";import{T as Qe}from"./textarea-C9hsFzqx.js";import"./select-DVTvZC0C.js";import{E as Ge}from"./jspdf.es.min-DN2_QRbC.js";import{P as T}from"./package-L7rgkkVO.js";import{Z as He}from"./zap-BCMzj8QL.js";import{F as G}from"./file-text-YZXa1D2L.js";import{m as E}from"./proxy-CrAtMFvn.js";import{H as We}from"./hash-AgYeaIxt.js";import{T as Xe}from"./triangle-alert-BslwqqvL.js";import{C as ue}from"./calendar-D9APQM2e.js";import{C as pe}from"./circle-check-big-BQVCuGNJ.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-B4fS-S41.js";import"./index-Cwj52g8w.js";import"./index-BLzoH2V5.js";import"./tslib.es6-M_FJ09fS.js";import"./index-CTYbBDNA.js";import"./index-DWmZ7jWL.js";import"./index-DZ3-Nn1l.js";import"./index-Z1kVBYZG.js";import"./index-BZWX2-NB.js";import"./index-DqxisvwK.js";import"./index-Bjz1F0Gi.js";import"./createLucideIcon-BKWaAi2G.js";const Ts=({open:f,onClose:S,item:n})=>{const[k,A]=x.useState([]),[v,b]=x.useState({}),[g,D]=x.useState("prescription"),[H,I]=x.useState([]),[p,W]=x.useState(null),[Je,X]=x.useState([]),[Ke,J]=x.useState([]),[Ve,$]=x.useState([]),[xe,K]=x.useState(!1),[w,V]=x.useState(!1),[Ye,Y]=x.useState(!1),[l,M]=x.useState([]),[Ze,he]=x.useState({}),[Z,C]=x.useState(!1),[o,F]=x.useState(null),[ge,ee]=x.useState(n?.quantity||0),[se,P]=x.useState(!1),[te,L]=x.useState(!1),[i,ae]=x.useState(null),[ne,ie]=x.useState(!1),{data:u,setData:h,post:be,processing:_,errors:es}=Ue({item_id:n?.id||"",batch_id:"",batch_number:"",quantity:"",reason:"",patient_name:"",case_id:"",dispensed_by:"",notes:"",prescription_id:"",patient_id:"",doctor_id:""}),re=s=>{const a=new Date;return s.filter(t=>{if(!t.expiry_date||t.expiry_date==="N/A"||t.expiry_date==="Invalid Date")return!0;try{return new Date(t.expiry_date)>=a}catch{return console.warn("Invalid expiry date format:",t.expiry_date),!0}})},R=async()=>{if(!(!n||!f)){V(!0);try{let s=[];if(n.batches&&Array.isArray(n.batches)&&n.batches.length>0)s=n.batches.filter(t=>t.batchNumber&&t.batchNumber!=="new_batch"&&t.batchNumber!=="N/A").map(t=>({batch_number:t.batchNumber||"N/A",expiry_date:t.expiryDate||"N/A",available_quantity:t.quantity||0,location:t.storageLocation||"N/A",batch_id:t.id})),console.log("Loaded grouped batches:",s);else{const t=await fetch(`/pharmacist/inventory/item/${n.id}/batches`);t.ok?(s=await t.json(),console.log("Loaded API batches:",s)):(console.error("Failed to load batches:",t.statusText),s=[{batch_number:n.batchNumber||n.batch_number||"N/A",expiry_date:n.expiryDate||n.expiry_date||"N/A",available_quantity:n.quantity||n.totalQuantity||0,location:n.storageLocation||n.storage_location||"N/A",batch_id:n.id}])}const a=re(s);A(a),console.log("Filtered batches (expired removed):",a)}catch(s){console.error("Error loading batches:",s);const a=[{batch_number:n.batchNumber||n.batch_number||"N/A",expiry_date:n.expiryDate||n.expiry_date||"N/A",available_quantity:n.quantity||n.totalQuantity||0,location:n.storageLocation||n.storage_location||"N/A",batch_id:n.id}],t=re(a);A(t)}finally{V(!1)}}};x.useEffect(()=>{n&&f&&(console.log("Modal opened, resetting to prescription mode"),R(),h("item_id",n.id),h("dispensed_by","Current User"),ee(n.quantity||0),D("prescription"),M([]),h("batch_id",""),h("batch_number",""))},[n,f]),x.useEffect(()=>{console.log("Dispense mode changed to:",g)},[g]),x.useEffect(()=>{},[f]);const ye=async()=>{console.log("Loading pending prescriptions for medicine:",n?.id),K(!0);try{const s=`/pharmacist/inventory/prescriptions/pending?medicine_id=${n?.id||""}`;console.log("Fetching from URL:",s);const a=await fetch(s,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},credentials:"same-origin"});if(console.log("Response status:",a.status),console.log("Response headers:",Object.fromEntries(a.headers.entries())),!a.ok){console.error("Failed to load prescriptions:",a.status,a.statusText),I([]);return}const t=a.headers.get("content-type");if(!t||!t.includes("application/json")){console.error("Invalid response format:",t),I([]);return}const r=await a.json();console.log("=== PRESCRIPTION LOADING SUCCESS ==="),console.log("Filtered for medicine ID:",n?.id),console.log("Loaded prescriptions:",r),console.log("Number of prescriptions:",r.length),console.log("Type of prescriptions:",typeof r),console.log("Is array:",Array.isArray(r)),I(r)}catch(s){console.error("=== PRESCRIPTION LOADING ERROR ==="),console.error("Error loading prescriptions:",s),console.error("Error message:",s.message),console.error("Error stack:",s.stack),I([])}finally{K(!1)}},fe=async()=>{try{const s=await fetch("/pharmacist/inventory/patients-doctors");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=s.headers.get("content-type");if(!a||!a.includes("application/json")){const r=await s.text();throw console.error("Expected JSON but got:",r),new Error("Server returned non-JSON response")}const t=await s.json();X(t.patients||[]),J(t.doctors||[])}catch(s){console.error("Error loading patients and doctors:",s),X([]),J([])}},ve=async()=>{Y(!0);try{const s=await fetch("/pharmacist/inventory/case-ids");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=s.headers.get("content-type");if(!a||!a.includes("application/json")){const r=await s.text();throw console.error("Expected JSON but got:",r),new Error("Server returned non-JSON response")}const t=await s.json();console.log("Loaded available Case IDs:",t),$(t.case_ids||[])}catch(s){console.error("Error loading available Case IDs:",s),$([])}finally{Y(!1)}};x.useEffect(()=>{console.log("=== DISPENSE MODAL USEEFFECT ==="),console.log("Modal open:",f),console.log("Item:",n),f&&(console.log("Loading data for dispense modal..."),fe(),ve(),ye())},[f,n]);const Ne=(s,a)=>{const t=`${s.batch_number}-${a}-${s.batch_id||s.id}`;if(console.log("Batch selection clicked:",{clickedBatch:s.batch_number,batchUniqueId:t,currentSelectedBatches:l.map(c=>c.uniqueId),availableQuantity:s.available_quantity,isSelectable:s.available_quantity>0}),s.available_quantity<=0){b({batch_number:`Cannot select batch ${s.batch_number} - no available quantity (${s.available_quantity} units)`});return}const r={...s,uniqueId:t};M(c=>{if(c.some(m=>m.uniqueId===t)){console.log("Deselecting batch:",s.batch_number,"instance:",t);const m=c.filter(y=>y.uniqueId!==t);return m.length===0?(h("batch_id",""),h("batch_number","")):m.length===1&&(h("batch_id",m[0].batch_id||m[0].id),h("batch_number",m[0].batch_number)),m}else{console.log("Selecting batch:",s.batch_number,"instance:",t);const m=[...c,r];return m.length===1&&(h("batch_id",s.batch_id||s.id),h("batch_number",s.batch_number)),m}}),b({})},je=s=>{W(s),h("prescription_id",s.id),h("patient_name",s.patient_name),h("patient_id",s.patient_id),h("doctor_id",s.doctor_id),h("case_id",s.case_id||s.prescription_number),h("reason","Prescription Dispensing")},_e=()=>{if(!p)return b({prescription:"Please select a prescription"}),!1;if(l.length===0)return b({batch_number:"Please select at least one batch"}),!1;if(!p.medicines?.some(r=>r.medicine_id===n.id))return b({prescription:"This prescription does not contain the selected item"}),!1;const a=p.medicines.filter(r=>r.medicine_id===n.id).reduce((r,c)=>r+(c.quantity||0),0),t=l.reduce((r,c)=>r+(c.available_quantity||0),0);return a>t?(b({batch_number:`Insufficient stock in selected batches. Required: ${a}, Available: ${t}`}),!1):!0},Se=(s,a)=>{const t=s.medicines.find(y=>y.medicine_id===n.id),r=a.reduce((y,Be)=>y+Be.quantity,0),c=()=>t?.medicine_name&&t.medicine_name!=="Unknown Medicine"?t.medicine_name:n?.name?n.name:"Medicine",m={name:c(),generic_name:n?.generic_name||n?.name||"Generic",unit:n?.unit||"units",manufacturer:n?.manufacturer||"Unknown Manufacturer"};return{prescription_number:s.prescription_number,case_id:s.case_id||"N/A",patient_name:s.patient_name,doctor_name:s.doctor_name,medicine_name:m.name,medicine_generic:m.generic_name,medicine_unit:m.unit,medicine_manufacturer:m.manufacturer,required_quantity:t?.quantity||0,dispensed_quantity:r,batches_used:a.length,expiry_dates:a.map(y=>y.expiry_date),allocated_batches:a}},De=()=>{let s={};if(g==="prescription"?s=oe():g==="manual"&&(s=le()),Object.keys(s).length>0){b(s);return}if(!_e())return;const t=p.medicines.find(d=>d.medicine_id===n.id)?.quantity||0,r=l.map(d=>({batch_id:d.batch_id||d.id,batch_number:d.batch_number,quantity:Math.min(t,d.available_quantity),expiry_date:d.expiry_date})),c=Se(p,r);F(c),C(!0)},Ie=(s,a,t)=>{console.log("Executing post-dispense functions for transaction:",s),we(s,a),Te(s,a,"completed"),Ee(s,a),ke(p.id,"dispensed"),Ae(s,a,"dispense_completed"),$e(n.id),Me(s,a),Ce(),console.log("Post-dispense functions completed for transaction:",s)},we=(s,a)=>{console.log("Updating stock quantities for transaction:",s),a.allocated_batches.forEach(r=>{console.log(`Updating batch ${r.batch_number}: -${r.quantity} units`),A(c=>c.map(d=>d.batch_number===r.batch_number?{...d,available_quantity:Math.max(0,d.available_quantity-r.quantity),dispensed_quantity:(d.dispensed_quantity||0)+r.quantity}:d))});const t=a.allocated_batches.reduce((r,c)=>r+c.quantity,0);console.log(`Total dispensed: ${t} units from item ${n.name}`),ee(r=>{const c=Math.max(0,r-t);return console.log(`Stock updated: ${r} - ${t} = ${c}`),c})},Ce=()=>{console.log("Refreshing inventory data..."),R()},Pe=()=>{if(!i)return;const s=new Ge,a={black:[0,0,0],darkGray:[64,64,64],lightGray:[128,128,128],blue:[0,51,102],white:[255,255,255]};let t=20;s.setFontSize(16),s.setTextColor(...a.blue),s.text("REPUBLIC OF THE PHILIPPINES",105,t,{align:"center"}),t+=8,s.setFontSize(14),s.setTextColor(...a.blue),s.text("RURAL HEALTH UNIT OF CALUMPANG",105,t,{align:"center"}),t+=8,s.setFontSize(12),s.setTextColor(...a.darkGray),s.text("Calumpang, General Santos City.",105,t,{align:"center"}),t+=15,s.setFontSize(18),s.setTextColor(...a.black),s.text("MEDICINE DISPENSE RECEIPT",105,t,{align:"center"}),t+=15,s.setDrawColor(...a.blue),s.setLineWidth(.5),s.line(20,t,190,t),t+=10,s.setFontSize(10),s.setTextColor(...a.darkGray),s.text(`Transaction ID: ${i.transactionId}`,20,t),s.text(`Date: ${i.timestamp}`,20,t+5),t+=15,s.setFontSize(12),s.setTextColor(...a.blue),s.text("PRESCRIPTION INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Prescription Number:",20,t),s.text(i.prescription.number,80,t),t+=5,s.text("Case ID:",20,t),s.text(i.prescription.caseId||"N/A",80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("PATIENT INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Patient Name:",20,t),s.text(i.patient.name,80,t),t+=5,s.text("Patient ID:",20,t),s.text(i.patient.id,80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("MEDICINE INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Medicine Name:",20,t),s.text(i.medicine.name,80,t),t+=5,s.text("Manufacturer:",20,t),s.text(i.medicine.manufacturer,80,t),t+=5,s.text("Quantity Dispensed:",20,t),s.text(`${i.medicine.quantity} ${i.medicine.unit}`,80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("BATCH INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Batch Number:",20,t),s.text(i.batch.number,80,t),t+=5,s.text("Expiration Date:",20,t),s.text(i.batch.expiration,80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("STAFF INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Prescribing Doctor:",20,t),s.text(i.doctor.name,80,t),t+=5,s.text("Dispensing Pharmacist:",20,t),s.text(i.pharmacist.name,80,t),t+=15,s.setFontSize(12),s.setTextColor(...a.blue),s.text("DISPENSE SUMMARY",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.setFillColor(...a.lightGray),s.rect(20,t-2,50,8,"F"),s.rect(70,t-2,50,8,"F"),s.rect(120,t-2,50,8,"F"),s.setTextColor(...a.white),s.text("Total Items",25,t+3),s.text("Total Quantity",75,t+3),s.text("Inventory Impact",125,t+3),t+=8,s.setTextColor(...a.black),s.text(i.summary.totalItems.toString(),25,t+3),s.text(i.summary.totalQuantity.toString(),75,t+3),s.text(i.summary.inventoryImpact.toString(),125,t+3),t+=20,s.setFontSize(10),s.setTextColor(...a.black),s.text("Dispensing Pharmacist:",20,t),s.text("_________________________",20,t+15),s.text(i.pharmacist.name,20,t+20),s.text("Date:",100,t),s.text("_________________________",100,t+15),s.text(new Date().toLocaleDateString(),100,t+20),t+=40,s.setFontSize(8),s.setTextColor(...a.lightGray),s.text("This is an official document generated by RHU Calumpang Management System",105,t,{align:"center"}),s.text(`Generated on: ${new Date().toLocaleString()}`,105,t+5,{align:"center"});const r=`Dispense_Receipt_${i.transactionId}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(r)},qe=()=>{if(!i)return;const s=window.open("","_blank"),a=`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Dispense Summary - ${i.transactionId}</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 20px; }
                    .header { text-align: center; margin-bottom: 30px; }
                    .header h1 { color: #059669; margin: 0; }
                    .header p { color: #666; margin: 5px 0; }
                    .section { margin-bottom: 20px; padding: 15px; border-radius: 8px; }
                    .prescription { background: #dbeafe; }
                    .patient { background: #e9d5ff; }
                    .medicine { background: #dcfce7; }
                    .batch { background: #fed7aa; }
                    .staff { background: #f3f4f6; }
                    .summary { background: linear-gradient(90deg, #dbeafe, #dcfce7); border: 1px solid #93c5fd; }
                    .section h3 { margin: 0 0 10px 0; font-size: 16px; }
                    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                    .info-item { margin-bottom: 8px; }
                    .info-label { font-weight: bold; color: #374151; font-size: 12px; }
                    .info-value { color: #111827; font-size: 14px; }
                    .summary-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center; }
                    .summary-card { background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
                    .summary-number { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
                    .summary-label { font-size: 12px; color: #666; }
                    .blue { color: #2563eb; }
                    .green { color: #059669; }
                    .purple { color: #7c3aed; }
                    @media print { 
                        body { margin: 0; }
                        .no-print { display: none; }
                    }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>Dispense Summary</h1>
                    <p>Transaction ID: ${i.transactionId}</p>
                    <p>Date: ${i.timestamp}</p>
                </div>
                
                <div class="info-grid">
                    <div class="section prescription">
                        <h3>Prescription Information</h3>
                        <div class="info-item">
                            <div class="info-label">Prescription Number:</div>
                            <div class="info-value">${i.prescription.number}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Case ID:</div>
                            <div class="info-value">${i.prescription.caseId||"N/A"}</div>
                        </div>
                    </div>
                    
                    <div class="section patient">
                        <h3>Patient Information</h3>
                        <div class="info-item">
                            <div class="info-label">Patient Name:</div>
                            <div class="info-value">${i.patient.name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Patient ID:</div>
                            <div class="info-value">${i.patient.id}</div>
                        </div>
                    </div>
                    
                    <div class="section medicine">
                        <h3>Medicine Details</h3>
                        <div class="info-item">
                            <div class="info-label">Medicine Name:</div>
                            <div class="info-value">${i.medicine.name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Manufacturer:</div>
                            <div class="info-value">${i.medicine.manufacturer}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Quantity Dispensed:</div>
                            <div class="info-value">${i.medicine.quantity} ${i.medicine.unit}</div>
                        </div>
                    </div>
                    
                    <div class="section batch">
                        <h3>Batch Information</h3>
                        <div class="info-item">
                            <div class="info-label">Batch Number:</div>
                            <div class="info-value">${i.batch.number}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Expiration Date:</div>
                            <div class="info-value">${i.batch.expiration}</div>
                        </div>
                    </div>
                </div>
                
                <div class="section staff">
                    <h3>Staff Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Prescribing Doctor:</div>
                            <div class="info-value">${i.doctor.name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Dispensing Pharmacist:</div>
                            <div class="info-value">${i.pharmacist.name}</div>
                        </div>
                    </div>
                </div>
                
                <div class="section summary">
                    <h3>Dispense Summary</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-number blue">${i.summary.totalItems}</div>
                            <div class="summary-label">Total Items</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number green">${i.summary.totalQuantity}</div>
                            <div class="summary-label">Total Quantity</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number purple">${i.summary.inventoryImpact}</div>
                            <div class="summary-label">Inventory Impact</div>
                        </div>
                    </div>
                </div>
            </body>
            </html>
        `;s.document.write(a),s.document.close(),s.focus(),setTimeout(()=>{s.print()},500)},Te=(s,a,t)=>{const r={transaction_id:s,action:"dispense",status:t,patient_name:a.patient_name,prescription_number:a.prescription_number,medicine_name:a.medicine_name,quantity:a.dispensed_quantity,batches_used:a.batches_used,timestamp:new Date().toISOString(),user:"pharmacist"};console.log("Dispense activity logged:",r)},Ee=(s,a)=>{const t={type:"dispense_completed",title:"Medicine Dispensed Successfully",message:`Prescription ${a.prescription_number} has been dispensed for ${a.patient_name}`,transaction_id:s,patient_name:a.patient_name,medicine_name:a.medicine_name,quantity:a.dispensed_quantity,timestamp:new Date().toISOString()};console.log("Dispense notification:",t)},ke=(s,a)=>{console.log(`Updating prescription ${s} status to: ${a}`)},Ae=(s,a,t)=>{const r={transaction_id:s,action:t,entity_type:"prescription",entity_id:p.id,changes:{status:"dispensed",dispensed_at:new Date().toISOString(),dispensed_by:"pharmacist",dispensed_quantity:a.dispensed_quantity,batches_used:a.batches_used},timestamp:new Date().toISOString(),user:"pharmacist"};console.log("Audit trail entry created:",r)},$e=s=>{console.log(`Checking low stock alerts for item: ${s}`)},Me=(s,a)=>{const t={transaction_id:s,prescription_number:a.prescription_number,patient_name:a.patient_name,doctor_name:a.doctor_name,medicine_name:a.medicine_name,quantity:a.dispensed_quantity,batches:a.allocated_batches,dispensed_at:new Date().toISOString(),dispensed_by:"pharmacist"};console.log("Dispense receipt generated:",t)},Fe=async()=>{if(console.log("Confirm Dispense started"),console.log("Preview data:",o),console.log("Selected prescription:",p),console.log("Selected batches:",l),console.log("Item:",n),!o){console.error("No preview data available!"),alert("Error: No preview data available. Please try again.");return}if(!p){console.error("No prescription selected!"),alert("Error: No prescription selected. Please select a prescription first.");return}if(l.length===0){console.error("No batches selected!"),alert("Error: No batches selected. Please select at least one batch first.");return}const s=`DISP-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("Generated transaction ID:",s);const a=l[0],t={prescription_id:p.id,dispensed_by:"pharmacist",batch_id:String(a?.batch_id||a?.id||""),batch_number:a?.batch_number,item_id:n.id};P(!0),console.log("Sending dispense data:",t);let r;try{r="/pharmacist/inventory/prescriptions/auto-dispense"}catch(c){console.error("Route helper failed:",c),r="/pharmacist/inventory/prescriptions/auto-dispense"}try{console.log("Making API call...");const c=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)});if(c.ok){const d=await c.json();console.log("Dispense completed successfully:",d);const m=d.dispense_summary||{};console.log("Dispense summary from backend:",m);const y={transactionId:m.transaction_id||s,timestamp:new Date().toLocaleString(),prescription:{number:o.prescription_number,caseId:o.case_id||"N/A"},patient:{name:o.patient_name,id:m.patient?.id||"N/A"},doctor:{name:o.doctor_name,id:m.doctor?.id||"N/A"},medicine:{name:o.medicine_name,generic:o.medicine_generic,manufacturer:o.medicine_manufacturer,quantity:o.dispensed_quantity,unit:o.medicine_unit},batch:{number:l.length>0?l[0].batch_number:"N/A",expiration:l.length>0&&l[0].expiry_date?new Date(l[0].expiry_date).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A"},summary:{totalItems:m.summary?.total_items||1,totalQuantity:m.summary?.total_quantity||o.dispensed_quantity,inventoryImpact:m.inventory_impact?.items_affected||1},pharmacist:{name:m.pharmacist?.name||"Current User",id:m.pharmacist?.id||"N/A"}};ae(y),L(!0),S(),ce(),C(!1),F(null),P(!1),Ie(y.transactionId,o,y)}else{const d=await c.json();console.error("Auto-dispense error:",d),b(d),P(!1);const m={transactionId:s,prescription:o.prescription_number,patient:o.patient_name,medicine:o.medicine_name,error:d,timestamp:new Date().toLocaleString(),status:"failed"};console.log("Dispense error summary:",m);const y=`âŒ Dispense Failed!

ðŸ“‹ Transaction ID: ${s}
ðŸ‘¤ Patient: ${o.patient_name}
ðŸ’Š Medicine: ${o.medicine_name}
ðŸ·ï¸ Generic: ${o.medicine_generic}
ðŸ­ Manufacturer: ${o.medicine_manufacturer}
âŒ Error: ${Object.values(d).join(", ")}
â° Time: ${new Date().toLocaleString()}`;alert(y)}}catch(c){console.error("Network error during dispense:",c),P(!1);const d=`âŒ Network Error!

ðŸ“‹ Transaction ID: ${s}
ðŸ‘¤ Patient: ${o.patient_name}
ðŸ’Š Medicine: ${o.medicine_name}
âŒ Error: ${c.message}
â° Time: ${new Date().toLocaleString()}`;alert(d)}console.log("Confirm Dispense completed")},oe=()=>{const s={};return l.length===0&&(s.batch_number="Please select at least one batch"),p||(s.prescription="Please select a prescription"),s},le=()=>{const s={};return l.length===0&&(s.batch_number="Please select at least one batch"),(!u.quantity||u.quantity<=0)&&(s.quantity="Please enter a valid quantity"),u.reason||(s.reason="Please enter a reason for dispensing"),s},Le=s=>{s.preventDefault(),console.log("=== FORM SUBMITTED ==="),console.log("Form submitted, mode:",g),console.log("Selected batches:",l),console.log("Selected prescription:",p),console.log("Form data:",u);let a={};if(g==="prescription"?a=oe():g==="manual"&&(a=le()),console.log("Validation errors:",a),Object.keys(a).length>0){b(a);return}b({}),g==="prescription"?(console.log("Calling previewDispense"),De()):(console.log("Calling handleManualDispense"),Re())},Re=()=>{if(console.log("=== MANUAL DISPENSE STARTED ==="),console.log("Selected batches:",l),console.log("Quantity:",u.quantity),console.log("Reason:",u.reason),console.log("Patient name:",u.patient_name),console.log("Case ID:",u.case_id),console.log("Notes:",u.notes),l.length===0){console.error("No batches selected"),b({batch_number:"Please select at least one batch"});return}if(!u.quantity||u.quantity<=0){console.error("Invalid quantity"),b({quantity:"Please enter a valid quantity"});return}if(!u.reason){console.error("No reason provided"),b({reason:"Please enter a reason for dispensing"});return}const s=l[0],a={item_id:n.id,batch_id:s.batch_id||s.id,batch_number:s.batch_number,quantity:parseInt(u.quantity),reason:u.reason,patient_name:u.patient_name||"Manual Dispense",case_id:u.case_id||null,dispensed_by:u.dispensed_by||"Current User",notes:u.notes||`Manual dispense - ${u.reason}`,dispense_mode:"manual"};console.log("Dispense data prepared:",a),console.log("Submitting to route:","/pharmacist/inventory/dispense"),be(route("pharmacist.inventory.dispense"),a,{onSuccess:()=>{console.log("=== MANUAL DISPENSE SUCCESSFUL ==="),S(),ce(),ze.reload({only:["pharmacist.inventory.index"]})},onError:t=>{console.log("=== MANUAL DISPENSE ERROR ===",t),b(t)}})},ce=()=>{console.log("Resetting form and clearing selected batches"),h({item_id:"",batch_id:"",batch_number:"",quantity:"",reason:"",patient_name:"",case_id:"",dispensed_by:"",notes:"",prescription_id:"",patient_id:"",doctor_id:""}),W(null),M([]),he({}),b({}),D("prescription"),$([]),ie(!1)},de=s=>s?new Date(s).toLocaleDateString():"N/A",Oe=s=>{if(!s)return!1;const a=new Date(s);return Math.ceil((a-new Date)/(1e3*60*60*24))<=30};return n?e.jsxs(e.Fragment,{children:[e.jsx(O,{open:f,onOpenChange:S,children:e.jsxs(B,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(U,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Dispense Stock - ",n.name]}),e.jsx(me,{children:g==="prescription"?"Select a prescription to automatically dispense the required medicines from available stock.":"Select a batch and enter dispensing details to dispense stock from inventory."})]}),e.jsxs("form",{onSubmit:Le,className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5"}),"Stock Dispense"]}),e.jsx("p",{className:"text-sm text-gray-600",children:g==="prescription"?"Choose how you want to dispense this item from inventory.":"Enter the details for manual dispensing of this item."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3",children:["Dispense Mode (Current: ",g,")"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{console.log("Switching to prescription mode"),D("prescription")},className:`p-3 border rounded-lg text-left transition-all ${g==="prescription"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Prescription Based"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Dispense based on existing prescriptions"})]}),e.jsxs("button",{type:"button",onClick:()=>{console.log("Switching to manual mode"),D("manual")},className:`p-3 border rounded-lg text-left transition-all ${g==="manual"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Manual Dispense"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Dispense directly without prescription"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Item Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:n.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2 font-medium",children:n.manufacturer||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"ml-2 font-medium",children:n.category?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[ge," ",n.unit_type||"units"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(j,{className:"text-sm font-medium",children:["Available Batches for ",n.name]}),l.length>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:[l.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:ne,onChange:s=>ie(s.target.checked),className:"rounded"}),"Show all batches"]}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:R,disabled:w,className:"flex items-center gap-1",children:[e.jsx(T,{className:`h-3 w-3 ${w?"animate-spin":""}`}),w?"Loading...":"Refresh"]})]})]}),e.jsx("div",{className:"mt-2 space-y-2",children:w&&k.length===0?e.jsxs("div",{className:"flex items-center justify-center py-4 text-gray-500",children:[e.jsx(T,{className:"h-4 w-4 animate-spin mr-2"}),"Loading available batches..."]}):k.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No batches available for this item"}):k.filter(s=>ne||s.available_quantity>0).map((s,a)=>{const t=s.available_quantity>0,r=`${s.batch_number}-${a}-${s.batch_id||s.id}`,c=l.some(d=>d.uniqueId===r);return console.log("Rendering batch:",{batchNumber:s.batch_number,batchUniqueId:r,isSelectable:t,isSelected:c,selectedBatchesCount:l.length,selectedBatchUniqueIds:l.map(d=>d.uniqueId),availableQuantity:s.available_quantity}),e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:`p-3 border rounded-lg transition-all ${c?"border-blue-500 bg-blue-50":t?"border-gray-200 hover:border-gray-300 cursor-pointer":"border-gray-200 bg-gray-50 cursor-not-allowed opacity-60"}`,onClick:()=>t?Ne(s,a):null,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${c?"bg-blue-500 border-blue-500":t?"bg-white border-gray-300 hover:border-blue-300":"bg-gray-100 border-gray-200"}`,children:c&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.batch_number}),e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["#",a+1]}),Oe(s.expiry_date)&&e.jsx(Xe,{className:"h-4 w-4 text-amber-500"}),!t&&e.jsx("span",{className:"text-xs bg-red-100 text-red-600 px-2 py-1 rounded",children:"No Stock"})]}),e.jsxs("div",{className:`text-sm ${t?"text-gray-600":"text-gray-400"}`,children:["Available: ",s.available_quantity," units",!t&&" (Cannot select)"]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),de(s.expiry_date)]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.location})]})]})},r)})}),v.batch_number&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:v.batch_number})]}),g==="prescription"&&e.jsxs("div",{children:[e.jsx(j,{className:"text-sm font-medium",children:"Select Prescription"}),xe?e.jsx("div",{className:"mt-2 p-4 text-center text-gray-500",children:"Loading prescriptions..."}):e.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:H.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:["No pending prescriptions found for ",n?.name||"this medicine"]}):H.map((s,a)=>e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:`p-3 border rounded-lg cursor-pointer transition-all ${p?.id===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>je(s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${p?.id===s.id?"bg-blue-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.prescription_number})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Patient: ",s.patient_name]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Doctor: ",s.doctor_name]}),e.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["Case ID: ",s.case_id||"N/A"]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),de(s.prescription_date)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.medicines.length," medicines"]})]})]}),p?.id===s.id&&e.jsxs(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Medicines in Prescription:"}),e.jsx("div",{className:"space-y-2",children:s.medicines.map((t,r)=>e.jsx("div",{className:"bg-white p-2 rounded border text-sm",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.medicine_name}),e.jsxs("div",{className:"text-gray-600",children:["Quantity: ",t.quantity," | Dosage: ",t.dosage]}),e.jsxs("div",{className:"text-gray-600",children:["Frequency: ",t.frequency," | Duration: ",t.duration]}),t.instructions&&e.jsxs("div",{className:"text-gray-600",children:["Instructions: ",t.instructions]})]}),t.is_dispensed&&e.jsx(pe,{className:"h-4 w-4 text-green-500"})]})},r))})]})]},s.id))}),v.prescription&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:v.prescription})]}),g==="manual"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"quantity",children:"Quantity to Dispense *"}),e.jsx(q,{id:"quantity",type:"number",min:"1",value:u.quantity,onChange:s=>h("quantity",s.target.value),placeholder:"Enter quantity to dispense",className:"mt-1"}),v.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:v.quantity})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"reason",children:"Reason for Dispensing *"}),e.jsx(q,{id:"reason",value:u.reason,onChange:s=>h("reason",s.target.value),placeholder:"e.g., Emergency use, Over-the-counter, etc.",className:"mt-1"}),v.reason&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:v.reason})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"patient_name",children:"Patient/Recipient Name"}),e.jsx(q,{id:"patient_name",value:u.patient_name,onChange:s=>h("patient_name",s.target.value),placeholder:"Enter patient or recipient name (optional)",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"case_id",children:"Case ID"}),e.jsx(q,{id:"case_id",value:u.case_id,onChange:s=>h("case_id",s.target.value),placeholder:"Enter case ID (optional)",className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(Qe,{id:"notes",value:u.notes,onChange:s=>h("notes",s.target.value),placeholder:"Any additional notes or instructions...",className:"mt-1",rows:3})]}),p&&l.length>0&&e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Dispense Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:n.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Selected Batches:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[l.length," batch(es)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total Available:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[l.reduce((s,a)=>s+(a.available_quantity||0),0)," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Batch Numbers:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.map(s=>s.batch_number).join(", ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Patient:"}),e.jsx("span",{className:"ml-2 font-medium",children:p.patient_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Case ID:"}),e.jsx("span",{className:"ml-2 font-medium",children:p.case_id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Doctor:"}),e.jsx("span",{className:"ml-2 font-medium",children:p.doctor_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Prescription:"}),e.jsx("span",{className:"ml-2 font-medium",children:p.prescription_number})]})]})]}),e.jsxs(Q,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:S,disabled:_,children:"Cancel"}),e.jsx(N,{type:"submit",disabled:_||l.length===0||g==="prescription"&&!p,style:{backgroundColor:"#2C3E50"},onClick:s=>{console.log("=== BUTTON CLICKED ==="),console.log("Button type:",s.target.type),console.log("Form element:",s.target.closest("form")),console.log("Dispense mode:",g),console.log("Selected batches:",l),console.log("Form data:",u),console.log("Button disabled:",_||l.length===0||g==="prescription"&&!p),console.log("Processing:",_),console.log("Selected batches count:",l.length),console.log("Prescription mode check:",g==="prescription"&&!p)},children:_?"Stock Dispensing...":`Stock Dispense${l.length>0?` (${l.length} batches)`:""}`})]})]})]})}),Z&&o&&e.jsx(O,{open:Z,onOpenChange:C,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsxs(U,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Dispense Preview"]}),e.jsx(me,{children:"Review the dispense details before confirming"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"Prescription Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Prescription:"}),e.jsx("span",{className:"ml-2",children:o.prescription_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Patient:"}),e.jsx("span",{className:"ml-2",children:o.patient_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Doctor:"}),e.jsx("span",{className:"ml-2",children:o.doctor_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Medicine:"}),e.jsx("span",{className:"ml-2",children:o.medicine_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Generic Name:"}),e.jsx("span",{className:"ml-2",children:o.medicine_generic})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2",children:o.medicine_manufacturer})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"Dispense Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Required Quantity:"}),e.jsxs("span",{className:"ml-2",children:[o.required_quantity," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Will Dispense:"}),e.jsxs("span",{className:"ml-2 font-bold text-green-800",children:[o.dispensed_quantity," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Batches Used:"}),e.jsxs("span",{className:"ml-2",children:[o.batches_used," batches"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Status:"}),e.jsx("span",{className:"ml-2",children:o.required_quantity===o.dispensed_quantity?e.jsx("span",{className:"text-green-600 font-medium",children:"âœ“ Complete"}):e.jsx("span",{className:"text-orange-600 font-medium",children:"âš  Partial"})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Batch Allocation"}),e.jsx("div",{className:"space-y-2",children:o.allocated_batches.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded border",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.batch_number}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",new Date(s.expiry_date).toLocaleDateString(),")"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"font-bold text-blue-600",children:[s.quantity," units"]})})]},a))})]})]}),e.jsxs(Q,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>{C(!1),F(null)},children:"Cancel"}),e.jsx(N,{type:"button",onClick:Fe,disabled:se||!p||l.length===0,className:"bg-green-600 hover:bg-green-700",children:se?"Processing...":"Confirm Dispense"})]})]})}),te&&i&&e.jsx(O,{open:te,onOpenChange:L,children:e.jsxs(B,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx(z,{className:"text-xl font-bold text-green-600",children:"Dispense Completed Successfully!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Transaction Summary"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-gray-800",children:"Transaction Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Transaction ID:"}),e.jsx("p",{className:"font-mono text-sm font-semibold",children:i.transactionId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Date & Time:"}),e.jsx("p",{className:"text-sm font-semibold",children:i.timestamp})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-blue-800",children:"Prescription Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Prescription Number:"}),e.jsx("p",{className:"font-semibold",children:i.prescription.number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Case ID:"}),e.jsx("p",{className:"font-semibold",children:i.prescription.caseId})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-purple-800",children:"Patient Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-purple-600",children:"Patient Name:"}),e.jsx("p",{className:"font-semibold",children:i.patient.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-purple-600",children:"Patient ID:"}),e.jsx("p",{className:"font-semibold",children:i.patient.id})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-green-800",children:"Medicine Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-600",children:"Medicine Name:"}),e.jsx("p",{className:"font-semibold",children:i.medicine.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-600",children:"Manufacturer:"}),e.jsx("p",{className:"font-semibold",children:i.medicine.manufacturer})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-600",children:"Quantity Dispensed:"}),e.jsxs("p",{className:"font-semibold text-lg",children:[i.medicine.quantity," ",i.medicine.unit]})]})]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-orange-800",children:"Batch Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-orange-600",children:"Batch Number:"}),e.jsx("p",{className:"font-semibold",children:i.batch.number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-orange-600",children:"Expiration Date:"}),e.jsx("p",{className:"font-semibold",children:i.batch.expiration})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-gray-800",children:"Staff Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Prescribing Doctor:"}),e.jsx("p",{className:"font-semibold",children:i.doctor.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Dispensing Pharmacist:"}),e.jsx("p",{className:"font-semibold",children:i.pharmacist.name})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-3 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-gray-800",children:"Dispense Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:i.summary.totalItems}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Items"})]}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:i.summary.totalQuantity}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Quantity"})]}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:i.summary.inventoryImpact}),e.jsx("div",{className:"text-xs text-gray-600",children:"Inventory Impact"})]})]})]})]}),e.jsxs(Q,{className:"flex gap-3",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>{L(!1),ae(null)},children:"Close"}),e.jsx(N,{type:"button",onClick:qe,className:"bg-blue-600 hover:bg-blue-700",children:"Print Summary"}),e.jsx(N,{type:"button",onClick:Pe,className:"bg-green-600 hover:bg-green-700",children:"Export PDF"})]})]})})]}):null};export{Ts as default};
