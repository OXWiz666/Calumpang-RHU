import{u as Ie,j as e}from"./app-eZyzAlSs.js";import{r as x}from"./vendor-DkBadjUr.js";import{D as $,a as E,b as F,c as B,e as ee,d as L}from"./dialog-BzlMUvts.js";import{B as f}from"./button-DNMV_MSQ.js";import{I}from"./input-BJU2rtKG.js";import{L as v}from"./label-WQnCAFKW.js";import{T as qe}from"./textarea-C403ahG8.js";import"./select-C9YWAol8.js";import{E as Ce}from"./jspdf.es.min-Tk500Ll_.js";import{P as q}from"./package-L7rgkkVO.js";import{Z as we}from"./zap-BCMzj8QL.js";import{F as R}from"./file-text-YZXa1D2L.js";import{m as C}from"./proxy-sduFE7Ck.js";import{H as Me}from"./hash-AgYeaIxt.js";import{T as ke}from"./triangle-alert-BslwqqvL.js";import{C as se}from"./calendar-D9APQM2e.js";import{C as te}from"./circle-check-big-BQVCuGNJ.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-DaVxrTli.js";import"./index-BJkdhMqG.js";import"./index-DOgo2JBp.js";import"./tslib.es6-M_FJ09fS.js";import"./index-gB5goOSr.js";import"./index-Cho6R3Au.js";import"./index-CiP63iIg.js";import"./index-CHOi5dQy.js";import"./index-OEludBFL.js";import"./index-DqxisvwK.js";import"./index-DOKE1DCM.js";import"./createLucideIcon-BKWaAi2G.js";const ms=({open:b,onClose:_,item:i})=>{const[w,M]=x.useState([]),[y,h]=x.useState({}),[j,O]=x.useState(!1),[c,k]=x.useState([]),[Te,ae]=x.useState({}),[z,S]=x.useState(!1),[l,T]=x.useState(null),[ne,U]=x.useState(i?.quantity||0),[Q,D]=x.useState(!1),[G,A]=x.useState(!1),[n,H]=x.useState(null),[W,X]=x.useState(!1),{data:p,setData:u,post:ie,processing:N,errors:Ae}=Ie({item_id:i?.id||"",batch_id:"",batch_number:"",quantity:"",reason:"",patient_name:"",case_id:"",dispensed_by:"",notes:""}),K=s=>{const a=new Date;return s.filter(t=>{if(!t.expiry_date||t.expiry_date==="N/A"||t.expiry_date==="Invalid Date")return!0;try{return new Date(t.expiry_date)>=a}catch{return console.warn("Invalid expiry date format:",t.expiry_date),!0}})},P=async()=>{if(!(!i||!b)){O(!0);try{let s=[];if(i.batches&&Array.isArray(i.batches)&&i.batches.length>0)s=i.batches.filter(t=>t.batchNumber&&t.batchNumber!=="new_batch"&&t.batchNumber!=="N/A").map(t=>({batch_number:t.batchNumber||"N/A",expiry_date:t.expiryDate||"N/A",available_quantity:t.quantity||0,location:t.storageLocation||"N/A",batch_id:t.id})),console.log("Loaded grouped batches:",s);else{const t=await fetch(`/pharmacist/inventory/item/${i.id}/batches`);t.ok?(s=await t.json(),console.log("Loaded API batches:",s)):(console.error("Failed to load batches:",t.statusText),s=[{batch_number:i.batchNumber||i.batch_number||"N/A",expiry_date:i.expiryDate||i.expiry_date||"N/A",available_quantity:i.quantity||i.totalQuantity||0,location:i.storageLocation||i.storage_location||"N/A",batch_id:i.id}])}const a=K(s);M(a),console.log("Filtered batches (expired removed):",a)}catch(s){console.error("Error loading batches:",s);const a=[{batch_number:i.batchNumber||i.batch_number||"N/A",expiry_date:i.expiryDate||i.expiry_date||"N/A",available_quantity:i.quantity||i.totalQuantity||0,location:i.storageLocation||i.storage_location||"N/A",batch_id:i.id}],t=K(a);M(t)}finally{O(!1)}}};x.useEffect(()=>{i&&b&&(console.log("Modal opened, resetting to prescription mode"),P(),u("item_id",i.id),u("dispensed_by","Current User"),U(i.quantity||0),setDispenseMode("prescription"),k([]),u("batch_id",""),u("batch_number",""))},[i,b]),x.useEffect(()=>{console.log("Dispense mode changed to:",dispenseMode)},[dispenseMode]),x.useEffect(()=>{},[b]),x.useEffect(()=>{console.log("=== DISPENSE MODAL USEEFFECT ==="),console.log("Modal open:",b),console.log("Item:",i),b&&(console.log("Loading data for dispense modal..."),P())},[b,i]);const re=(s,a)=>{const t=`${s.batch_number}-${a}-${s.batch_id||s.id}`;if(console.log("Batch selection clicked:",{clickedBatch:s.batch_number,batchUniqueId:t,currentSelectedBatches:c.map(o=>o.uniqueId),availableQuantity:s.available_quantity,isSelectable:s.available_quantity>0}),s.available_quantity<=0){h({batch_number:`Cannot select batch ${s.batch_number} - no available quantity (${s.available_quantity} units)`});return}const r={...s,uniqueId:t};k(o=>{if(o.some(m=>m.uniqueId===t)){console.log("Deselecting batch:",s.batch_number,"instance:",t);const m=o.filter(g=>g.uniqueId!==t);return m.length===0?(u("batch_id",""),u("batch_number","")):m.length===1&&(u("batch_id",m[0].batch_id||m[0].id),u("batch_number",m[0].batch_number)),m}else{console.log("Selecting batch:",s.batch_number,"instance:",t);const m=[...o,r];return m.length===1&&(u("batch_id",s.batch_id||s.id),u("batch_number",s.batch_number)),m}}),h({})},le=s=>{setSelectedPrescription(s),u("prescription_id",s.id),u("patient_name",s.patient_name),u("patient_id",s.patient_id),u("doctor_id",s.doctor_id),u("case_id",s.case_id||s.prescription_number),u("reason","Prescription Dispensing")},ce=()=>{if(!selectedPrescription)return h({prescription:"Please select a prescription"}),!1;if(c.length===0)return h({batch_number:"Please select at least one batch"}),!1;if(!selectedPrescription.medicines?.some(r=>r.medicine_id===i.id))return h({prescription:"This prescription does not contain the selected item"}),!1;const a=selectedPrescription.medicines.filter(r=>r.medicine_id===i.id).reduce((r,o)=>r+(o.quantity||0),0),t=c.reduce((r,o)=>r+(o.available_quantity||0),0);return a>t?(h({batch_number:`Insufficient stock in selected batches. Required: ${a}, Available: ${t}`}),!1):!0},oe=(s,a)=>{const t=s.medicines.find(g=>g.medicine_id===i.id),r=a.reduce((g,Pe)=>g+Pe.quantity,0),o=()=>t?.medicine_name&&t.medicine_name!=="Unknown Medicine"?t.medicine_name:i?.name?i.name:"Medicine",m={name:o(),generic_name:i?.generic_name||i?.name||"Generic",unit:i?.unit||"units",manufacturer:i?.manufacturer||"Unknown Manufacturer"};return{prescription_number:s.prescription_number,case_id:s.case_id||"N/A",patient_name:s.patient_name,doctor_name:s.doctor_name,medicine_name:m.name,medicine_generic:m.generic_name,medicine_unit:m.unit,medicine_manufacturer:m.manufacturer,required_quantity:t?.quantity||0,dispensed_quantity:r,batches_used:a.length,expiry_dates:a.map(g=>g.expiry_date),allocated_batches:a}},de=()=>{let s={};if(dispenseMode==="prescription"?s=V():dispenseMode==="manual"&&(s=Y()),Object.keys(s).length>0){h(s);return}if(!ce())return;const t=selectedPrescription.medicines.find(d=>d.medicine_id===i.id)?.quantity||0,r=c.map(d=>({batch_id:d.batch_id||d.id,batch_number:d.batch_number,quantity:Math.min(t,d.available_quantity),expiry_date:d.expiry_date})),o=oe(selectedPrescription,r);T(o),S(!0)},me=(s,a,t)=>{console.log("Executing post-dispense functions for transaction:",s),pe(s,a),ge(s,a,"completed"),be(s,a),ye(selectedPrescription.id,"dispensed"),fe(s,a,"dispense_completed"),ve(i.id),Ne(s,a),ue(),console.log("Post-dispense functions completed for transaction:",s)},pe=(s,a)=>{console.log("Updating stock quantities for transaction:",s),a.allocated_batches.forEach(r=>{console.log(`Updating batch ${r.batch_number}: -${r.quantity} units`),M(o=>o.map(d=>d.batch_number===r.batch_number?{...d,available_quantity:Math.max(0,d.available_quantity-r.quantity),dispensed_quantity:(d.dispensed_quantity||0)+r.quantity}:d))});const t=a.allocated_batches.reduce((r,o)=>r+o.quantity,0);console.log(`Total dispensed: ${t} units from item ${i.name}`),U(r=>{const o=Math.max(0,r-t);return console.log(`Stock updated: ${r} - ${t} = ${o}`),o})},ue=()=>{console.log("Refreshing inventory data..."),P()},xe=()=>{if(!n)return;const s=new Ce,a={black:[0,0,0],darkGray:[64,64,64],lightGray:[128,128,128],blue:[0,51,102],white:[255,255,255]};let t=20;s.setFontSize(16),s.setTextColor(...a.blue),s.text("REPUBLIC OF THE PHILIPPINES",105,t,{align:"center"}),t+=8,s.setFontSize(14),s.setTextColor(...a.blue),s.text("RURAL HEALTH UNIT OF CALUMPANG",105,t,{align:"center"}),t+=8,s.setFontSize(12),s.setTextColor(...a.darkGray),s.text("Calumpang, General Santos City.",105,t,{align:"center"}),t+=15,s.setFontSize(18),s.setTextColor(...a.black),s.text("MEDICINE DISPENSE RECEIPT",105,t,{align:"center"}),t+=15,s.setDrawColor(...a.blue),s.setLineWidth(.5),s.line(20,t,190,t),t+=10,s.setFontSize(10),s.setTextColor(...a.darkGray),s.text(`Transaction ID: ${n.transactionId}`,20,t),s.text(`Date: ${n.timestamp}`,20,t+5),t+=15,s.setFontSize(12),s.setTextColor(...a.blue),s.text("PRESCRIPTION INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Prescription Number:",20,t),s.text(n.prescription.number,80,t),t+=5,s.text("Case ID:",20,t),s.text(n.prescription.caseId||"N/A",80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("PATIENT INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Patient Name:",20,t),s.text(n.patient.name,80,t),t+=5,s.text("Patient ID:",20,t),s.text(n.patient.id,80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("MEDICINE INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Medicine Name:",20,t),s.text(n.medicine.name,80,t),t+=5,s.text("Manufacturer:",20,t),s.text(n.medicine.manufacturer,80,t),t+=5,s.text("Quantity Dispensed:",20,t),s.text(`${n.medicine.quantity} ${n.medicine.unit}`,80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("BATCH INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Batch Number:",20,t),s.text(n.batch.number,80,t),t+=5,s.text("Expiration Date:",20,t),s.text(n.batch.expiration,80,t),t+=10,s.setFontSize(12),s.setTextColor(...a.blue),s.text("STAFF INFORMATION",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.text("Prescribing Doctor:",20,t),s.text(n.doctor.name,80,t),t+=5,s.text("Dispensing Pharmacist:",20,t),s.text(n.pharmacist.name,80,t),t+=15,s.setFontSize(12),s.setTextColor(...a.blue),s.text("DISPENSE SUMMARY",20,t),t+=8,s.setFontSize(10),s.setTextColor(...a.black),s.setFillColor(...a.lightGray),s.rect(20,t-2,50,8,"F"),s.rect(70,t-2,50,8,"F"),s.rect(120,t-2,50,8,"F"),s.setTextColor(...a.white),s.text("Total Items",25,t+3),s.text("Total Quantity",75,t+3),s.text("Inventory Impact",125,t+3),t+=8,s.setTextColor(...a.black),s.text(n.summary.totalItems.toString(),25,t+3),s.text(n.summary.totalQuantity.toString(),75,t+3),s.text(n.summary.inventoryImpact.toString(),125,t+3),t+=20,s.setFontSize(10),s.setTextColor(...a.black),s.text("Dispensing Pharmacist:",20,t),s.text("_________________________",20,t+15),s.text(n.pharmacist.name,20,t+20),s.text("Date:",100,t),s.text("_________________________",100,t+15),s.text(new Date().toLocaleDateString(),100,t+20),t+=40,s.setFontSize(8),s.setTextColor(...a.lightGray),s.text("This is an official document generated by RHU Calumpang Management System",105,t,{align:"center"}),s.text(`Generated on: ${new Date().toLocaleString()}`,105,t+5,{align:"center"});const r=`Dispense_Receipt_${n.transactionId}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(r)},he=()=>{if(!n)return;const s=window.open("","_blank"),a=`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Dispense Summary - ${n.transactionId}</title>
                <style>
                    * { box-sizing: border-box; }
                    body { 
                        font-family: Arial, sans-serif; 
                        margin: 0; 
                        padding: 10px; 
                        font-size: 12px;
                        line-height: 1.4;
                    }
                    .header { 
                        text-align: center; 
                        margin-bottom: 20px; 
                    }
                    .header h1 { 
                        color: #059669; 
                        margin: 0; 
                        font-size: 18px;
                    }
                    .header p { 
                        color: #666; 
                        margin: 3px 0; 
                        font-size: 12px;
                    }
                    .section { 
                        margin-bottom: 15px; 
                        padding: 10px; 
                        border-radius: 4px; 
                    }
                    .prescription { background: #dbeafe; }
                    .patient { background: #e9d5ff; }
                    .medicine { background: #dcfce7; }
                    .batch { background: #fed7aa; }
                    .staff { background: #f3f4f6; }
                    .summary { 
                        background: #f0f9ff; 
                        border: 1px solid #93c5fd; 
                    }
                    .section h3 { 
                        margin: 0 0 8px 0; 
                        font-size: 14px; 
                    }
                    .info-grid { 
                        display: grid; 
                        grid-template-columns: 1fr 1fr; 
                        gap: 10px; 
                    }
                    .info-item { 
                        margin-bottom: 5px; 
                    }
                    .info-label { 
                        font-weight: bold; 
                        color: #374151; 
                        font-size: 10px; 
                    }
                    .info-value { 
                        color: #111827; 
                        font-size: 12px; 
                    }
                    .summary-cards { 
                        display: grid; 
                        grid-template-columns: repeat(3, 1fr); 
                        gap: 10px; 
                        text-align: center; 
                    }
                    .summary-card { 
                        background: white; 
                        padding: 8px; 
                        border-radius: 4px; 
                        box-shadow: 0 1px 2px rgba(0,0,0,0.1); 
                    }
                    .summary-number { 
                        font-size: 16px; 
                        font-weight: bold; 
                        margin-bottom: 3px; 
                    }
                    .summary-label { 
                        font-size: 10px; 
                        color: #666; 
                    }
                    .blue { color: #2563eb; }
                    .green { color: #059669; }
                    .purple { color: #7c3aed; }
                    @media print { 
                        body { 
                            margin: 0; 
                            padding: 8px; 
                            font-size: 10px;
                        }
                        .no-print { display: none; }
                        .section { 
                            margin-bottom: 10px; 
                            padding: 8px; 
                        }
                        .summary-cards { 
                            gap: 8px; 
                        }
                        .summary-card { 
                            padding: 6px; 
                        }
                        .summary-number { 
                            font-size: 14px; 
                        }
                    }
                    @page {
                        margin: 0.5in;
                        size: A4;
                    }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>Dispense Summary</h1>
                    <p>Transaction ID: ${n.transactionId}</p>
                    <p>Date: ${n.timestamp}</p>
                </div>
                
                <div class="info-grid">
                    <div class="section prescription">
                        <h3>Prescription Information</h3>
                        <div class="info-item">
                            <div class="info-label">Prescription Number:</div>
                            <div class="info-value">${n.prescription.number}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Case ID:</div>
                            <div class="info-value">${n.prescription.caseId||"N/A"}</div>
                        </div>
                    </div>
                    
                    <div class="section patient">
                        <h3>Patient Information</h3>
                        <div class="info-item">
                            <div class="info-label">Patient Name:</div>
                            <div class="info-value">${n.patient.name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Patient ID:</div>
                            <div class="info-value">${n.patient.id}</div>
                        </div>
                    </div>
                    
                    <div class="section medicine">
                        <h3>Medicine Details</h3>
                        <div class="info-item">
                            <div class="info-label">Medicine Name:</div>
                            <div class="info-value">${n.medicine.name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Manufacturer:</div>
                            <div class="info-value">${n.medicine.manufacturer}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Quantity Dispensed:</div>
                            <div class="info-value">${n.medicine.quantity} ${n.medicine.unit}</div>
                        </div>
                    </div>
                    
                    <div class="section batch">
                        <h3>Batch Information</h3>
                        <div class="info-item">
                            <div class="info-label">Batch Number:</div>
                            <div class="info-value">${n.batch.number}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Expiration Date:</div>
                            <div class="info-value">${n.batch.expiration}</div>
                        </div>
                    </div>
                </div>
                
                <div class="section staff">
                    <h3>Staff Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Prescribing Doctor:</div>
                            <div class="info-value">${n.doctor.name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Dispensing Pharmacist:</div>
                            <div class="info-value">${n.pharmacist.name}</div>
                        </div>
                    </div>
                </div>
                
                <div class="section summary">
                    <h3>Dispense Summary</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-number blue">${n.summary.totalItems}</div>
                            <div class="summary-label">Total Items</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number green">${n.summary.totalQuantity}</div>
                            <div class="summary-label">Total Quantity</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number purple">${n.summary.inventoryImpact}</div>
                            <div class="summary-label">Inventory Impact</div>
                        </div>
                    </div>
                </div>
            </body>
            </html>
        `;s.document.write(a),s.document.close(),s.focus(),setTimeout(()=>{s.print()},500)},ge=(s,a,t)=>{const r={transaction_id:s,action:"dispense",status:t,patient_name:a.patient_name,prescription_number:a.prescription_number,medicine_name:a.medicine_name,quantity:a.dispensed_quantity,batches_used:a.batches_used,timestamp:new Date().toISOString(),user:"pharmacist"};console.log("Dispense activity logged:",r)},be=(s,a)=>{const t={type:"dispense_completed",title:"Medicine Dispensed Successfully",message:`Prescription ${a.prescription_number} has been dispensed for ${a.patient_name}`,transaction_id:s,patient_name:a.patient_name,medicine_name:a.medicine_name,quantity:a.dispensed_quantity,timestamp:new Date().toISOString()};console.log("Dispense notification:",t)},ye=(s,a)=>{console.log(`Updating prescription ${s} status to: ${a}`)},fe=(s,a,t)=>{const r={transaction_id:s,action:t,entity_type:"prescription",entity_id:selectedPrescription.id,changes:{status:"dispensed",dispensed_at:new Date().toISOString(),dispensed_by:"pharmacist",dispensed_quantity:a.dispensed_quantity,batches_used:a.batches_used},timestamp:new Date().toISOString(),user:"pharmacist"};console.log("Audit trail entry created:",r)},ve=s=>{console.log(`Checking low stock alerts for item: ${s}`)},Ne=(s,a)=>{const t={transaction_id:s,prescription_number:a.prescription_number,patient_name:a.patient_name,doctor_name:a.doctor_name,medicine_name:a.medicine_name,quantity:a.dispensed_quantity,batches:a.allocated_batches,dispensed_at:new Date().toISOString(),dispensed_by:"pharmacist"};console.log("Dispense receipt generated:",t)},_e=async()=>{if(console.log("Confirm Dispense started"),console.log("Preview data:",l),console.log("Selected prescription:",selectedPrescription),console.log("Selected batches:",c),console.log("Item:",i),!l){console.error("No preview data available!"),alert("Error: No preview data available. Please try again.");return}if(!selectedPrescription){console.error("No prescription selected!"),alert("Error: No prescription selected. Please select a prescription first.");return}if(c.length===0){console.error("No batches selected!"),alert("Error: No batches selected. Please select at least one batch first.");return}const s=`DISP-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("Generated transaction ID:",s);const a=c[0],t={prescription_id:selectedPrescription.id,dispensed_by:"pharmacist",batch_id:String(a?.batch_id||a?.id||""),batch_number:a?.batch_number,item_id:i.id};D(!0),console.log("Sending dispense data:",t);let r;try{r="/pharmacist/inventory/prescriptions/auto-dispense"}catch(o){console.error("Route helper failed:",o),r="/pharmacist/inventory/prescriptions/auto-dispense"}try{console.log("Making API call...");const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)});if(o.ok){const d=await o.json();console.log("Dispense completed successfully:",d);const m=d.dispense_summary||{};console.log("Dispense summary from backend:",m);const g={transactionId:m.transaction_id||s,timestamp:new Date().toLocaleString(),prescription:{number:l.prescription_number,caseId:l.case_id||"N/A"},patient:{name:l.patient_name,id:m.patient?.id||"N/A"},doctor:{name:l.doctor_name,id:m.doctor?.id||"N/A"},medicine:{name:l.medicine_name,generic:l.medicine_generic,manufacturer:l.medicine_manufacturer,quantity:l.dispensed_quantity,unit:l.medicine_unit},batch:{number:c.length>0?c[0].batch_number:"N/A",expiration:c.length>0&&c[0].expiry_date?new Date(c[0].expiry_date).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A"},summary:{totalItems:m.summary?.total_items||1,totalQuantity:m.summary?.total_quantity||l.dispensed_quantity,inventoryImpact:m.inventory_impact?.items_affected||1},pharmacist:{name:m.pharmacist?.name||"Current User",id:m.pharmacist?.id||"N/A"}};H(g),A(!0),_(),Z(),S(!1),T(null),D(!1),me(g.transactionId,l,g)}else{const d=await o.json();console.error("Auto-dispense error:",d),h(d),D(!1);const m={transactionId:s,prescription:l.prescription_number,patient:l.patient_name,medicine:l.medicine_name,error:d,timestamp:new Date().toLocaleString(),status:"failed"};console.log("Dispense error summary:",m);const g=`âŒ Dispense Failed!

ðŸ“‹ Transaction ID: ${s}
ðŸ‘¤ Patient: ${l.patient_name}
ðŸ’Š Medicine: ${l.medicine_name}
ðŸ·ï¸ Generic: ${l.medicine_generic}
ðŸ­ Manufacturer: ${l.medicine_manufacturer}
âŒ Error: ${Object.values(d).join(", ")}
â° Time: ${new Date().toLocaleString()}`;alert(g)}}catch(o){console.error("Network error during dispense:",o),D(!1);const d=`âŒ Network Error!

ðŸ“‹ Transaction ID: ${s}
ðŸ‘¤ Patient: ${l.patient_name}
ðŸ’Š Medicine: ${l.medicine_name}
âŒ Error: ${o.message}
â° Time: ${new Date().toLocaleString()}`;alert(d)}console.log("Confirm Dispense completed")},V=()=>{const s={};return c.length===0&&(s.batch_number="Please select at least one batch"),selectedPrescription||(s.prescription="Please select a prescription"),s},Y=()=>{const s={};return c.length===0&&(s.batch_number="Please select at least one batch"),(!p.quantity||p.quantity<=0)&&(s.quantity="Please enter a valid quantity"),p.reason||(s.reason="Please enter a reason for dispensing"),s},je=s=>{s.preventDefault(),console.log("=== FORM SUBMITTED ==="),console.log("Form submitted, mode:",dispenseMode),console.log("Selected batches:",c),console.log("Selected prescription:",selectedPrescription),console.log("Form data:",p);let a={};if(dispenseMode==="prescription"?a=V():dispenseMode==="manual"&&(a=Y()),console.log("Validation errors:",a),Object.keys(a).length>0){h(a);return}h({}),dispenseMode==="prescription"?(console.log("Calling previewDispense"),de()):(console.log("Calling handleManualDispense"),Se())},Se=()=>{if(console.log("=== MANUAL DISPENSE STARTED ==="),console.log("Selected batches:",c),console.log("Quantity:",p.quantity),console.log("Reason:",p.reason),console.log("Patient name:",p.patient_name),console.log("Case ID:",p.case_id),console.log("Notes:",p.notes),c.length===0){console.error("No batches selected"),h({batch_number:"Please select at least one batch"});return}if(!p.quantity||p.quantity<=0){console.error("Invalid quantity"),h({quantity:"Please enter a valid quantity"});return}if(!p.reason){console.error("No reason provided"),h({reason:"Please enter a reason for dispensing"});return}const s=c[0],a={item_id:i.id,batch_id:s.batch_id||s.id,batch_number:s.batch_number,quantity:parseInt(p.quantity),reason:p.reason,patient_name:p.patient_name||"Manual Dispense",case_id:p.case_id||null,dispensed_by:p.dispensed_by||"Current User",notes:p.notes||`Manual dispense - ${p.reason}`,dispense_mode:"manual"};console.log("Dispense data prepared:",a),console.log("Submitting to route:","/pharmacist/inventory/dispense"),ie("/pharmacist/inventory/dispense",a,{onSuccess:()=>{console.log("=== MANUAL DISPENSE SUCCESSFUL ==="),_(),Z(),window.location.reload()},onError:t=>{console.error("=== MANUAL DISPENSE ERROR ===",t),h(t)}})},Z=()=>{console.log("Resetting form and clearing selected batches"),u({item_id:"",batch_id:"",batch_number:"",quantity:"",reason:"",patient_name:"",case_id:"",dispensed_by:"",notes:"",prescription_id:"",patient_id:"",doctor_id:""}),setSelectedPrescription(null),k([]),ae({}),h({}),setDispenseMode("prescription"),setAvailableCaseIds([]),X(!1)},J=s=>s?new Date(s).toLocaleDateString():"N/A",De=s=>{if(!s)return!1;const a=new Date(s);return Math.ceil((a-new Date)/(1e3*60*60*24))<=30};return i?e.jsxs(e.Fragment,{children:[e.jsx($,{open:b,onOpenChange:_,children:e.jsxs(E,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(F,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Dispense Stock - ",i.name]}),e.jsx(ee,{children:dispenseMode==="prescription"?"Select a prescription to automatically dispense the required medicines from available stock.":"Select a batch and enter dispensing details to dispense stock from inventory."})]}),e.jsxs("form",{onSubmit:je,className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Stock Dispense"]}),e.jsx("p",{className:"text-sm text-gray-600",children:dispenseMode==="prescription"?"Choose how you want to dispense this item from inventory.":"Enter the details for manual dispensing of this item."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3",children:["Dispense Mode (Current: ",dispenseMode,")"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{console.log("Switching to prescription mode"),setDispenseMode("prescription")},className:`p-3 border rounded-lg text-left transition-all ${dispenseMode==="prescription"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Prescription Based"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Dispense based on existing prescriptions"})]}),e.jsxs("button",{type:"button",onClick:()=>{console.log("Switching to manual mode"),setDispenseMode("manual")},className:`p-3 border rounded-lg text-left transition-all ${dispenseMode==="manual"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Manual Dispense"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Dispense directly without prescription"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Item Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.manufacturer||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.category?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[ne," ",i.unit_type||"units"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{className:"text-sm font-medium",children:["Available Batches for ",i.name]}),c.length>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:[c.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:s=>X(s.target.checked),className:"rounded"}),"Show all batches"]}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:P,disabled:j,className:"flex items-center gap-1",children:[e.jsx(q,{className:`h-3 w-3 ${j?"animate-spin":""}`}),j?"Loading...":"Refresh"]})]})]}),e.jsx("div",{className:"mt-2 space-y-2",children:j&&w.length===0?e.jsxs("div",{className:"flex items-center justify-center py-4 text-gray-500",children:[e.jsx(q,{className:"h-4 w-4 animate-spin mr-2"}),"Loading available batches..."]}):w.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No batches available for this item"}):w.filter(s=>W||s.available_quantity>0).map((s,a)=>{const t=s.available_quantity>0,r=`${s.batch_number}-${a}-${s.batch_id||s.id}`,o=c.some(d=>d.uniqueId===r);return console.log("Rendering batch:",{batchNumber:s.batch_number,batchUniqueId:r,isSelectable:t,isSelected:o,selectedBatchesCount:c.length,selectedBatchUniqueIds:c.map(d=>d.uniqueId),availableQuantity:s.available_quantity}),e.jsx(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:`p-3 border rounded-lg transition-all ${o?"border-blue-500 bg-blue-50":t?"border-gray-200 hover:border-gray-300 cursor-pointer":"border-gray-200 bg-gray-50 cursor-not-allowed opacity-60"}`,onClick:()=>t?re(s,a):null,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${o?"bg-blue-500 border-blue-500":t?"bg-white border-gray-300 hover:border-blue-300":"bg-gray-100 border-gray-200"}`,children:o&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.batch_number}),e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["#",a+1]}),De(s.expiry_date)&&e.jsx(ke,{className:"h-4 w-4 text-amber-500"}),!t&&e.jsx("span",{className:"text-xs bg-red-100 text-red-600 px-2 py-1 rounded",children:"No Stock"})]}),e.jsxs("div",{className:`text-sm ${t?"text-gray-600":"text-gray-400"}`,children:["Available: ",s.available_quantity," units",!t&&" (Cannot select)"]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),J(s.expiry_date)]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.location})]})]})},r)})}),y.batch_number&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:y.batch_number})]}),dispenseMode==="prescription"&&e.jsxs("div",{children:[e.jsx(v,{className:"text-sm font-medium",children:"Select Prescription"}),loadingPrescriptions?e.jsx("div",{className:"mt-2 p-4 text-center text-gray-500",children:"Loading prescriptions..."}):e.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:pendingPrescriptions.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:["No pending prescriptions found for ",i?.name||"this medicine"]}):pendingPrescriptions.map((s,a)=>e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:`p-3 border rounded-lg cursor-pointer transition-all ${selectedPrescription?.id===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>le(s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${selectedPrescription?.id===s.id?"bg-blue-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.prescription_number})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Patient: ",s.patient_name]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Doctor: ",s.doctor_name]}),e.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["Case ID: ",s.case_id||"N/A"]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),J(s.prescription_date)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.medicines.length," medicines"]})]})]}),selectedPrescription?.id===s.id&&e.jsxs(C.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Medicines in Prescription:"}),e.jsx("div",{className:"space-y-2",children:s.medicines.map((t,r)=>e.jsx("div",{className:"bg-white p-2 rounded border text-sm",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.medicine_name}),e.jsxs("div",{className:"text-gray-600",children:["Quantity: ",t.quantity," | Dosage: ",t.dosage]}),e.jsxs("div",{className:"text-gray-600",children:["Frequency: ",t.frequency," | Duration: ",t.duration]}),t.instructions&&e.jsxs("div",{className:"text-gray-600",children:["Instructions: ",t.instructions]})]}),t.is_dispensed&&e.jsx(te,{className:"h-4 w-4 text-green-500"})]})},r))})]})]},s.id))}),y.prescription&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:y.prescription})]}),dispenseMode==="manual"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"quantity",children:"Quantity to Dispense *"}),e.jsx(I,{id:"quantity",type:"number",min:"1",value:p.quantity,onChange:s=>u("quantity",s.target.value),placeholder:"Enter quantity to dispense",className:"mt-1"}),y.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:y.quantity})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"reason",children:"Reason for Dispensing *"}),e.jsx(I,{id:"reason",value:p.reason,onChange:s=>u("reason",s.target.value),placeholder:"e.g., Emergency use, Over-the-counter, etc.",className:"mt-1"}),y.reason&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:y.reason})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"patient_name",children:"Patient/Recipient Name"}),e.jsx(I,{id:"patient_name",value:p.patient_name,onChange:s=>u("patient_name",s.target.value),placeholder:"Enter patient or recipient name (optional)",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"case_id",children:"Case ID"}),e.jsx(I,{id:"case_id",value:p.case_id,onChange:s=>u("case_id",s.target.value),placeholder:"Enter case ID (optional)",className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(qe,{id:"notes",value:p.notes,onChange:s=>u("notes",s.target.value),placeholder:"Any additional notes or instructions...",className:"mt-1",rows:3})]}),selectedPrescription&&c.length>0&&e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Dispense Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Selected Batches:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[c.length," batch(es)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Total Available:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[c.reduce((s,a)=>s+(a.available_quantity||0),0)," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Batch Numbers:"}),e.jsx("span",{className:"ml-2 font-medium",children:c.map(s=>s.batch_number).join(", ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Patient:"}),e.jsx("span",{className:"ml-2 font-medium",children:selectedPrescription.patient_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Case ID:"}),e.jsx("span",{className:"ml-2 font-medium",children:selectedPrescription.case_id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Doctor:"}),e.jsx("span",{className:"ml-2 font-medium",children:selectedPrescription.doctor_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Prescription:"}),e.jsx("span",{className:"ml-2 font-medium",children:selectedPrescription.prescription_number})]})]})]}),e.jsxs(L,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:_,disabled:N,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:N||c.length===0||dispenseMode==="prescription"&&!selectedPrescription,style:{backgroundColor:"#2C3E50"},onClick:s=>{console.log("=== BUTTON CLICKED ==="),console.log("Button type:",s.target.type),console.log("Form element:",s.target.closest("form")),console.log("Dispense mode:",dispenseMode),console.log("Selected batches:",c),console.log("Form data:",p),console.log("Button disabled:",N||c.length===0||dispenseMode==="prescription"&&!selectedPrescription),console.log("Processing:",N),console.log("Selected batches count:",c.length),console.log("Prescription mode check:",dispenseMode==="prescription"&&!selectedPrescription)},children:N?"Stock Dispensing...":`Stock Dispense${c.length>0?` (${c.length} batches)`:""}`})]})]})]})}),z&&l&&e.jsx($,{open:z,onOpenChange:S,children:e.jsxs(E,{className:"max-w-2xl",children:[e.jsxs(F,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Dispense Preview"]}),e.jsx(ee,{children:"Review the dispense details before confirming"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"Prescription Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Prescription:"}),e.jsx("span",{className:"ml-2",children:l.prescription_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Patient:"}),e.jsx("span",{className:"ml-2",children:l.patient_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Doctor:"}),e.jsx("span",{className:"ml-2",children:l.doctor_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Medicine:"}),e.jsx("span",{className:"ml-2",children:l.medicine_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Generic Name:"}),e.jsx("span",{className:"ml-2",children:l.medicine_generic})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2",children:l.medicine_manufacturer})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"Dispense Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Required Quantity:"}),e.jsxs("span",{className:"ml-2",children:[l.required_quantity," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Will Dispense:"}),e.jsxs("span",{className:"ml-2 font-bold text-green-800",children:[l.dispensed_quantity," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Batches Used:"}),e.jsxs("span",{className:"ml-2",children:[l.batches_used," batches"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Status:"}),e.jsx("span",{className:"ml-2",children:l.required_quantity===l.dispensed_quantity?e.jsx("span",{className:"text-green-600 font-medium",children:"âœ“ Complete"}):e.jsx("span",{className:"text-orange-600 font-medium",children:"âš  Partial"})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Batch Allocation"}),e.jsx("div",{className:"space-y-2",children:l.allocated_batches.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded border",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.batch_number}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",new Date(s.expiry_date).toLocaleDateString(),")"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"font-bold text-blue-600",children:[s.quantity," units"]})})]},a))})]})]}),e.jsxs(L,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>{S(!1),T(null)},children:"Cancel"}),e.jsx(f,{type:"button",onClick:_e,disabled:Q||!selectedPrescription||c.length===0,className:"bg-green-600 hover:bg-green-700",children:Q?"Processing...":"Confirm Dispense"})]})]})}),G&&n&&e.jsx($,{open:G,onOpenChange:A,children:e.jsxs(E,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-xl font-bold text-green-600",children:"Dispense Completed Successfully!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Transaction Summary"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-gray-800",children:"Transaction Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Transaction ID:"}),e.jsx("p",{className:"font-mono text-sm font-semibold",children:n.transactionId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Date & Time:"}),e.jsx("p",{className:"text-sm font-semibold",children:n.timestamp})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-blue-800",children:"Prescription Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Prescription Number:"}),e.jsx("p",{className:"font-semibold",children:n.prescription.number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Case ID:"}),e.jsx("p",{className:"font-semibold",children:n.prescription.caseId})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-purple-800",children:"Patient Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-purple-600",children:"Patient Name:"}),e.jsx("p",{className:"font-semibold",children:n.patient.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-purple-600",children:"Patient ID:"}),e.jsx("p",{className:"font-semibold",children:n.patient.id})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-green-800",children:"Medicine Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-600",children:"Medicine Name:"}),e.jsx("p",{className:"font-semibold",children:n.medicine.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-600",children:"Manufacturer:"}),e.jsx("p",{className:"font-semibold",children:n.medicine.manufacturer})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-green-600",children:"Quantity Dispensed:"}),e.jsxs("p",{className:"font-semibold text-lg",children:[n.medicine.quantity," ",n.medicine.unit]})]})]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-orange-800",children:"Batch Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-orange-600",children:"Batch Number:"}),e.jsx("p",{className:"font-semibold",children:n.batch.number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-orange-600",children:"Expiration Date:"}),e.jsx("p",{className:"font-semibold",children:n.batch.expiration})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-gray-800",children:"Staff Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Prescribing Doctor:"}),e.jsx("p",{className:"font-semibold",children:n.doctor.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Dispensing Pharmacist:"}),e.jsx("p",{className:"font-semibold",children:n.pharmacist.name})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-3 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-base mb-2 text-gray-800",children:"Dispense Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:n.summary.totalItems}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Items"})]}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:n.summary.totalQuantity}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Quantity"})]}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:n.summary.inventoryImpact}),e.jsx("div",{className:"text-xs text-gray-600",children:"Inventory Impact"})]})]})]})]}),e.jsxs(L,{className:"flex gap-3",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>{A(!1),H(null)},children:"Close"}),e.jsx(f,{type:"button",onClick:he,className:"bg-blue-600 hover:bg-blue-700",children:"Print Summary"}),e.jsx(f,{type:"button",onClick:xe,className:"bg-green-600 hover:bg-green-700",children:"Export PDF"})]})]})})]}):null};export{ms as default};
