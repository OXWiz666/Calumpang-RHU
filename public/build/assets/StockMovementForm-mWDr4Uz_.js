import{r as l,j as o,P as Y,q as J,b as Z}from"./app-DTOPyzmI.js";import{D as ee,b as oe,c as re,d as se,f as ae}from"./dialog-FMIhcSqO.js";import{B as D}from"./button-BqLhTAke.js";import{I as b}from"./input-BCgr6PED.js";import{L as g}from"./label-yLQ5pDDc.js";import{a as te}from"./react-icons.esm-BqNRnAL3.js";import{a as ne,c as k}from"./index-COYBpvQB.js";import{P as C,u as G}from"./index-D6B22X2E.js";import{c as q}from"./index-BGLIzSNA.js";import{c as O,R as ce,I as ie}from"./index-B2BXr_Es.js";import{u as de}from"./index-CiiYDEYU.js";import{u as le,a as ue}from"./index-BQ8_2lOh.js";import{P as pe}from"./index-BYkPXFVm.js";import{c as A}from"./utils-CNyX0PrB.js";import{T as me}from"./textarea-ChsNCoCT.js";import{P as fe}from"./PrintErrors-BN5e-_mt.js";import"./index-DOPmQrrw.js";import"./Combination-CEuVJAod.js";var I="Radio",[ve,F]=q(I),[he,xe]=ve(I),M=l.forwardRef((s,t)=>{const{__scopeRadio:e,name:u,checked:r=!1,required:a,disabled:i,value:h="on",onCheck:p,form:m,...y}=s,[n,f]=l.useState(null),d=G(t,c=>f(c)),v=l.useRef(!1),x=n?m||!!n.closest("form"):!0;return o.jsxs(he,{scope:e,checked:r,disabled:i,children:[o.jsx(C.button,{type:"button",role:"radio","aria-checked":r,"data-state":B(r),"data-disabled":i?"":void 0,disabled:i,value:h,...y,ref:d,onClick:k(s.onClick,c=>{r||p==null||p(),x&&(v.current=c.isPropagationStopped(),v.current||c.stopPropagation())})}),x&&o.jsx(ye,{control:n,bubbles:!v.current,name:u,value:h,checked:r,required:a,disabled:i,form:m,style:{transform:"translateX(-100%)"}})]})});M.displayName=I;var L="RadioIndicator",T=l.forwardRef((s,t)=>{const{__scopeRadio:e,forceMount:u,...r}=s,a=xe(L,e);return o.jsx(pe,{present:u||a.checked,children:o.jsx(C.span,{"data-state":B(a.checked),"data-disabled":a.disabled?"":void 0,...r,ref:t})})});T.displayName=L;var ye=s=>{const{control:t,checked:e,bubbles:u=!0,...r}=s,a=l.useRef(null),i=le(e),h=ue(t);return l.useEffect(()=>{const p=a.current,m=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(m,"checked").set;if(i!==e&&n){const f=new Event("click",{bubbles:u});n.call(p,e),p.dispatchEvent(f)}},[i,e,u]),o.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:e,...r,tabIndex:-1,ref:a,style:{...s.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function B(s){return s?"checked":"unchecked"}var ge=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],P="RadioGroup",[Re,Ke]=q(P,[O,F]),V=O(),K=F(),[je,be]=Re(P),$=l.forwardRef((s,t)=>{const{__scopeRadioGroup:e,name:u,defaultValue:r,value:a,required:i=!1,disabled:h=!1,orientation:p,dir:m,loop:y=!0,onValueChange:n,...f}=s,d=V(e),v=de(m),[x,c]=ne({prop:a,defaultProp:r,onChange:n});return o.jsx(je,{scope:e,name:u,required:i,disabled:h,value:x,onValueChange:c,children:o.jsx(ce,{asChild:!0,...d,orientation:p,dir:v,loop:y,children:o.jsx(C.div,{role:"radiogroup","aria-required":i,"aria-orientation":p,"data-disabled":h?"":void 0,dir:v,...f,ref:t})})})});$.displayName=P;var H="RadioGroupItem",U=l.forwardRef((s,t)=>{const{__scopeRadioGroup:e,disabled:u,...r}=s,a=be(H,e),i=a.disabled||u,h=V(e),p=K(e),m=l.useRef(null),y=G(t,m),n=a.value===r.value,f=l.useRef(!1);return l.useEffect(()=>{const d=x=>{ge.includes(x.key)&&(f.current=!0)},v=()=>f.current=!1;return document.addEventListener("keydown",d),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",d),document.removeEventListener("keyup",v)}},[]),o.jsx(ie,{asChild:!0,...h,focusable:!i,active:n,children:o.jsx(M,{disabled:i,required:a.required,checked:n,...p,...r,name:a.name,ref:y,onCheck:()=>a.onValueChange(r.value),onKeyDown:k(d=>{d.key==="Enter"&&d.preventDefault()}),onFocus:k(r.onFocus,()=>{var d;f.current&&((d=m.current)==null||d.click())})})})});U.displayName=H;var ke="RadioGroupIndicator",z=l.forwardRef((s,t)=>{const{__scopeRadioGroup:e,...u}=s,r=K(e);return o.jsx(T,{...r,...u,ref:t})});z.displayName=ke;var W=$,Q=U,Ne=z;const X=l.forwardRef(({className:s,...t},e)=>o.jsx(W,{className:A("grid gap-2",s),...t,ref:e}));X.displayName=W.displayName;const N=l.forwardRef(({className:s,...t},e)=>o.jsx(Q,{ref:e,className:A("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:o.jsx(Ne,{className:"flex items-center justify-center",children:o.jsx(te,{className:"h-3.5 w-3.5 fill-primary"})})}));N.displayName=Q.displayName;const $e=({open:s,onClose:t,item:e,onSave:u})=>{var f,d,v,x;const{data:r,setData:a,processing:i,errors:h,put:p}=Y({type:"",batchNumber:"",quantity:"",reason:"",expiry:""});l.useEffect(()=>{var c,R,j,_,w,S,E;e&&(a({type:(c=e==null?void 0:e.stocks_movement[0])==null?void 0:c.type,quantity:0,reason:(R=e==null?void 0:e.stocks_movement[0])==null?void 0:R.reason,expiry:(w=(_=e==null?void 0:e.stocks_movement)==null?void 0:_[((j=e==null?void 0:e.stocks_movement)==null?void 0:j.length)-1])==null?void 0:w.expiry_date,batchNumber:((S=e==null?void 0:e.stocks_movement[0])==null?void 0:S.batch_number)||""}),console.log("item:",e,(E=e==null?void 0:e.stocks_movement[0])==null?void 0:E.type))},[e]);const m=c=>{a(c.target.name,c.target.value)},y=c=>{var R,j;if(c.preventDefault(),r.type==="Outgoing"&&parseInt(r.quantity)>((R=e==null?void 0:e.stock[0])==null?void 0:R.stocks)){alert("Cannot remove more items than current stock");return}p(route("admin.inventory.item.stockmovement.update",{movement:(j=e==null?void 0:e.stocks_movement[0])==null?void 0:j.id}),{onFinish:()=>{Z.reload({only:["flash","inventory","movements_"]})},onSuccess:()=>{t()}})},{user:n}=J().props.auth;return o.jsx(ee,{open:s,onOpenChange:t,children:o.jsxs(oe,{className:"sm:max-w-[425px]",children:[o.jsx(re,{children:o.jsx(se,{children:"Record Stock Movement"})}),o.jsx(fe,{errors:h}),o.jsxs("form",{onSubmit:y,className:"space-y-4 pt-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(g,{children:"Item"}),o.jsx("p",{className:"font-medium",children:e==null?void 0:e.name}),o.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current stock: ",(f=e==null?void 0:e.stock[0])==null?void 0:f.stocks," ",(d=e==null?void 0:e.stock[0])==null?void 0:d.stockname,"s"]})]}),o.jsx("div",{className:"space-y-2",children:o.jsxs("div",{className:"grid grid-cols-2",children:[o.jsxs("div",{children:[o.jsx(g,{children:"Movement Type"}),o.jsxs(X,{value:r.type,onValueChange:c=>a("type",c),className:"flex items-center space-x-2",children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(N,{value:"Incoming",id:"Incoming"}),o.jsx(g,{htmlFor:"Incoming",children:"Incoming"})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(N,{value:"Outgoing",id:"Outgoing"}),o.jsx(g,{htmlFor:"outgoing",children:"Outgoing"})]})]})]}),o.jsxs("div",{children:[o.jsx(g,{children:"Expiry Date"}),o.jsx(b,{id:"expirationDate",type:"date",name:"expirydate",value:r.expiry,onChange:c=>a("expiry",c.target.value)})]})]})}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(g,{htmlFor:"quantity",children:"Quantity"}),o.jsx(b,{id:"quantity",type:"number",min:"1",max:r.type==="Outgoing"?(v=e==null?void 0:e.stock[0])==null?void 0:v.stocks:void 0,name:"quantity",value:r.quantity,onChange:m,required:!0}),r.type==="Outgoing"&&o.jsxs("p",{className:"text-sm text-muted-foreground",children:["Maximum quantity that can be removed: ",(x=e==null?void 0:e.stock[0])==null?void 0:x.stocks]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(g,{htmlFor:"reason",children:["Reason ",r.type==="Outgoing"&&"(Required)"]}),o.jsx(me,{id:"reason",name:"reason",value:r.reason,onChange:m,placeholder:r.type==="Incoming"?"Optional":"Why is this item being removed from inventory?",required:r.type==="Outgoing"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(g,{htmlFor:"performedBy",children:"Performed By"}),o.jsx(b,{id:"performedBy",value:`${n==null?void 0:n.firstname} ${n==null?void 0:n.lastname}`,placeholder:"Name of staff member",required:!0})]}),o.jsxs(ae,{className:"pt-4",children:[o.jsx(D,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),o.jsx(D,{type:"submit",className:"bg-primary hover:bg-primary/90",disabled:i,children:"Save Changes"})]})]})]})})};export{$e as default};
