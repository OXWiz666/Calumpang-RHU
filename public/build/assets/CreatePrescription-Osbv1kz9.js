import{u as J,j as e,H as K,L,r as X}from"./app-CZwS2G5Y.js";import{r as y,R as Z}from"./vendor-DkBadjUr.js";import{A as ee}from"./AdminLayout-BdMzZsyd.js";import{B as _}from"./button-BesobgtA.js";import{I as b}from"./input-BuSGIsg0.js";import{L as m}from"./label-IliVNXtj.js";import{T as U}from"./textarea-B339UmIC.js";import{S as C,a as w,b as S,c as P,d as c}from"./select-Cxat1dCU.js";import{C as A,a as q,b as M,c as D}from"./card-CRUoSCLq.js";import{t as p,a as ie}from"./toast-Ba7XQqA2.js";import{A as se}from"./arrow-left-DcYYnBRL.js";import{U as R}from"./user-3RJR1iCA.js";import{T as V}from"./triangle-alert-BslwqqvL.js";import{C as te}from"./calendar-D9APQM2e.js";import{P as $}from"./pill-DIGxtF-3.js";import{P as re}from"./plus-MavOGQlj.js";import{T as ae}from"./trash-2-DJ5zXW8D.js";import"./pusher-DVtoYAOu.js";import"./index-B3OEEYC6.js";import"./avatar-DEV84UVA.js";import"./react-icons.esm-Bo4nchVy.js";import"./separator-6iJRufmK.js";import"./index-Bgkzuaxa.js";import"./index-DWou3t1m.js";import"./moment-C5S46NFB.js";import"./dialog-Tf1FOk7X.js";import"./index-VaCZcEHj.js";import"./tslib.es6-M_FJ09fS.js";import"./calendar-LRnVXR3S.js";import"./index-hcl4Lfqn.js";import"./index-Dg-CcdeN.js";import"./format-Dp3w_Y3x.js";import"./isSameMonth-BOwz-_mK.js";import"./isBefore-Bnl9x5VB.js";import"./TextInput-BgmIWbMp.js";import"./createLucideIcon-BKWaAi2G.js";import"./x-b8JahagL.js";import"./settings-D_MeB5oN.js";import"./house-CSq-WFst.js";import"./users-D4PhO1-D.js";import"./file-text-YZXa1D2L.js";import"./badge-ChpTVm3n.js";import"./pusher-qs61TsAX.js";import"./printer-CfgcPaUh.js";import"./package-L7rgkkVO.js";import"./circle-check-big-BQVCuGNJ.js";import"./index-0fk0WGfz.js";import"./proxy-C0TaRtDf.js";import"./autoprefixer-Bonhs1zv.js";import"./unit-CopbpOEH.js";import"./Toaster-BpbevUrA.js";import"./toast-T3VyHObl.js";import"./index-BL_R5CeI.js";import"./index-C0yHodGM.js";import"./use-toast-Dm0PN6fH.js";import"./layers-OK8ayVTK.js";import"./chart-column-yMaSKbSU.js";import"./index-DqxisvwK.js";import"./refresh-cw-D3hZ7e_O.js";import"./save-CAdd64LS.js";import"./square-pen-Bb1JtfBr.js";import"./download-BH8XyxCx.js";import"./archive-BwGVl8jP.js";import"./info-BVLwYIm5.js";import"./circle-x-Cf2XhiVO.js";import"./circle-check-F3PuHnLX.js";function yi({medicalRecords:x,medicines:v}){const[l,N]=y.useState([]),[g,O]=y.useState([]),[I,Q]=y.useState(""),[d,B]=y.useState([]);y.useEffect(()=>{v&&Array.isArray(v)&&O(v)},[v]);const H=Z.useMemo(()=>{if(!x||!Array.isArray(x))return[];const i=new Map;return x.forEach(a=>{i.has(a.patient_name)||i.set(a.patient_name,{id:a.patient_name,name:a.patient_name})}),Array.from(i.values())},[x]),z=i=>{Q(i);const a=x.filter(r=>r.patient_name===i);B(a),h("medical_record_id","")},{data:n,setData:h,post:ne,processing:F,errors:u}=J({medical_record_id:"",prescription_date:new Date().toISOString().split("T")[0],case_id:"",medicines:[],notes:""}),Y=()=>{const i={id:Date.now(),medicine_id:"",frequency:"",duration:"",quantity:"",instructions:""};N([...l,i])},G=i=>{N(l.filter(a=>a.id!==i))},f=(i,a,r)=>{console.log("updateMedicine called:",{id:i,field:a,value:r});const t=l.map(j=>j.id===i?{...j,[a]:r}:j);console.log("Updated medicines:",t),N(t)},E=(i,a)=>{if(!i||!a)return!1;const r=g.find(t=>t.id==i);return r?parseInt(a)>parseInt(r.available_quantity):!1},T=i=>{if(i.preventDefault(),console.log("Form submission started"),console.log("Event prevented:",i.defaultPrevented),l.some(s=>s.medicine_id&&s.quantity&&E(s.medicine_id,s.quantity))){p("Quantity Validation Error","Please fix quantity errors before submitting the prescription.");return}console.log("Raw selectedMedicines:",l),console.log("selectedMedicines length:",l.length);const r=l.filter(s=>{console.log("Filtering medicine:",s);const o=s.medicine_id&&s.frequency&&s.duration&&s.quantity;return console.log("Medicine valid:",o,{medicine_id:s.medicine_id,frequency:s.frequency,duration:s.duration,quantity:s.quantity}),o}).map(s=>({medicine_id:s.medicine_id,frequency:s.frequency,duration:s.duration,quantity:parseInt(s.quantity),instructions:s.instructions}));if(console.log("Selected medicines:",l),console.log("Filtered medicines data:",r),console.log("Form data before setData:",n),r.length===0){p("No Medicines Added","Please add at least one medicine to the prescription.");return}const t={...n,medicines:r};if(console.log("Route URL:",route("doctor.prescriptions.store")),console.log("Form data after setData:",t),console.log("Medicines array length:",r.length),console.log("Medicines validation:",r.every(s=>s.medicine_id&&s.frequency&&s.duration&&s.quantity)),!t.medical_record_id||!t.case_id||t.medicines.length===0){p("Missing Required Information","Please fill in all required fields and add at least one medicine.");return}try{const s=route("doctor.prescriptions.store");console.log("Generated route URL:",s)}catch(s){console.error("Route generation error:",s),p("Route Error","Unable to generate the correct route. Please refresh the page and try again.");return}console.log("About to submit prescription with data:",t);const j="/doctor/prescriptions";console.log("Route URL being used:",j),console.log("About to call router.post with data:",t),X.post(j,t,{onSuccess:s=>{console.log("Prescription created successfully!",s),ie("Prescription Created Successfully",`Prescription has been created successfully for ${r.length} medicine(s).`),N([]),h({medical_record_id:"",prescription_date:new Date().toISOString().split("T")[0],case_id:"",medicines:[],notes:""})},onError:s=>{if(console.error("Prescription creation failed:",s),s&&typeof s=="object"){const o=[];s.medicines&&o.push(`Medicines: ${Array.isArray(s.medicines)?s.medicines[0]:s.medicines}`),s.medical_record_id&&o.push(`Patient: ${Array.isArray(s.medical_record_id)?s.medical_record_id[0]:s.medical_record_id}`),s.case_id&&o.push(`Case ID: ${Array.isArray(s.case_id)?s.case_id[0]:s.case_id}`),s.prescription_date&&o.push(`Date: ${Array.isArray(s.prescription_date)?s.prescription_date[0]:s.prescription_date}`),o.length>0?p("Prescription Creation Failed",o.join(`
`)):p("Prescription Creation Failed","An error occurred while creating the prescription. Please check your inputs and try again."),Object.keys(s).forEach(k=>{console.error(`${k}:`,s[k])})}else p("Prescription Creation Failed","An unexpected error occurred. Please try again.")},onFinish:()=>{console.log("Form submission finished")}})},W=i=>g.find(a=>a.id==i);return e.jsxs(ee,{header:"Create Prescription",children:[e.jsx(K,{title:"Create Prescription"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{href:route("doctor.prescriptions"),children:e.jsxs(_,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Back"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Prescription"}),e.jsx("p",{className:"text-gray-600",children:"Create a prescription based on a patient's diagnosis"}),e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Medical Workflow:"})," Diagnosis â†’ Prescription. You can only create prescriptions for patients who have been diagnosed."]})})]})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Patient Diagnosis Information"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"patient_selection",children:"Select Patient *"}),e.jsxs(C,{value:I,onValueChange:z,children:[e.jsx(w,{className:"mt-1",children:e.jsx(S,{placeholder:"Choose a patient"})}),e.jsx(P,{children:H.map(i=>e.jsx(c,{value:String(i.id),children:e.jsx("span",{className:"font-medium",children:i.name})},i.id))})]})]}),I&&d.length>0&&e.jsxs("div",{children:[e.jsx(m,{htmlFor:"medical_record_id",children:"Select Diagnosis *"}),e.jsxs(C,{value:n.medical_record_id,onValueChange:i=>h("medical_record_id",i),children:[e.jsx(w,{className:"mt-1",children:e.jsx(S,{placeholder:"Choose a diagnosis"})}),e.jsx(P,{children:d.map(i=>e.jsx(c,{value:String(i.id),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:i.diagnosis}),e.jsx("span",{className:"text-xs text-gray-500",children:i.record_date})]})},i.id))})]})]}),n.medical_record_id&&e.jsx("div",{className:"mt-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(R,{className:"h-4 w-4 text-green-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-2",children:I}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("span",{className:"font-medium",children:"Diagnosis:"})," ",d.find(i=>i.id===parseInt(n.medical_record_id))?.diagnosis]}),d.find(i=>i.id===parseInt(n.medical_record_id))?.symptoms&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-green-800",children:"Symptoms:"}),e.jsx("p",{className:"text-sm text-green-600",children:d.find(i=>i.id===parseInt(n.medical_record_id))?.symptoms})]}),d.find(i=>i.id===parseInt(n.medical_record_id))?.treatment&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-green-800",children:"Treatment Plan:"}),e.jsx("p",{className:"text-sm text-green-600",children:d.find(i=>i.id===parseInt(n.medical_record_id))?.treatment})]}),d.find(i=>i.id===parseInt(n.medical_record_id))?.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-green-800",children:"Notes:"}),e.jsx("p",{className:"text-sm text-green-600",children:d.find(i=>i.id===parseInt(n.medical_record_id))?.notes})]}),e.jsxs("p",{className:"text-xs text-green-600",children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",d.find(i=>i.id===parseInt(n.medical_record_id))?.record_date]})]})]})]})}),u.medical_record_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:u.medical_record_id}),x.length===0&&e.jsx("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"No patients with diagnoses found. You must first create a medical record with a diagnosis before creating a prescription."})]})})]})]}),e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Prescription Details"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"prescription_date",children:"Prescription Date *"}),e.jsx(b,{id:"prescription_date",type:"date",value:n.prescription_date,onChange:i=>h("prescription_date",i.target.value),min:new Date().toISOString().split("T")[0],className:"mt-1"}),u.prescription_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:u.prescription_date})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"case_id",children:"Case ID *"}),e.jsx(b,{id:"case_id",type:"text",value:n.case_id,onChange:i=>h("case_id",i.target.value),placeholder:"e.g., CASE-001, MED-2025-001, etc.",className:"mt-1"}),u.case_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:u.case_id})]})]})]}),e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(M,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Medicines"]}),e.jsxs(_,{type:"button",onClick:Y,className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Add Medicine"]})]})}),e.jsx(D,{children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx($,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No medicines added yet"}),e.jsx("p",{className:"text-sm",children:'Click "Add Medicine" to start adding medicines to this prescription'})]}):e.jsx("div",{className:"space-y-4",children:l.map((i,a)=>{const r=W(i.medicine_id);return e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Medicine ",a+1]}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:()=>G(i.id),className:"text-red-600 hover:text-red-700",children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Medicine *"}),e.jsxs(C,{value:i.medicine_id,onValueChange:t=>f(i.id,"medicine_id",t),children:[e.jsx(w,{className:"mt-1",children:e.jsx(S,{placeholder:"Select medicine"})}),e.jsx(P,{children:g&&g.length>0?g.map(t=>e.jsxs(c,{value:String(t.id),children:[t.name," (",t.generic_name,") - Batch: ",t.batch_number," - Stock: ",t.available_quantity," ",t.unit]},t.id)):e.jsx(c,{value:"no-medicines",disabled:!0,children:"No medicines available"})})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Quantity *"}),e.jsx(b,{type:"number",min:"1",value:i.quantity,onChange:t=>f(i.id,"quantity",t.target.value),placeholder:"Enter quantity",className:`mt-1 ${E(i.medicine_id,i.quantity)?"border-red-500 focus:border-red-500 focus:ring-red-500":""}`}),r&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available: ",r.available_quantity," ",r.unit]}),E(i.medicine_id,i.quantity)&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),"Quantity exceeds available stock! Available: ",r?.available_quantity||0," ",r?.unit||"units"]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Frequency *"}),e.jsxs(C,{value:i.frequency,onValueChange:t=>f(i.id,"frequency",t),children:[e.jsx(w,{className:"mt-1",children:e.jsx(S,{placeholder:"Select frequency"})}),e.jsxs(P,{children:[e.jsx(c,{value:"Once daily",children:"Once daily"}),e.jsx(c,{value:"Twice daily",children:"Twice daily"}),e.jsx(c,{value:"Three times daily",children:"Three times daily"}),e.jsx(c,{value:"Four times daily",children:"Four times daily"}),e.jsx(c,{value:"Every 6 hours",children:"Every 6 hours"}),e.jsx(c,{value:"Every 8 hours",children:"Every 8 hours"}),e.jsx(c,{value:"Every 12 hours",children:"Every 12 hours"}),e.jsx(c,{value:"As needed",children:"As needed"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Duration *"}),e.jsx(b,{value:i.duration,onChange:t=>f(i.id,"duration",t.target.value),placeholder:"e.g., 7 days, 2 weeks",className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(m,{children:"Instructions"}),e.jsx(U,{value:i.instructions,onChange:t=>f(i.id,"instructions",t.target.value),placeholder:"Additional instructions for the patient",className:"mt-1",rows:2})]})]})]},i.id)})})})]}),e.jsxs(A,{children:[e.jsx(q,{children:e.jsx(M,{children:"Additional Notes"})}),e.jsx(D,{children:e.jsx(U,{value:n.notes,onChange:i=>h("notes",i.target.value),placeholder:"Any additional notes or instructions for this prescription",rows:4})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(L,{href:route("doctor.prescriptions"),children:e.jsx(_,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(_,{type:"button",onClick:i=>{i.preventDefault(),T(i)},disabled:F||l.length===0,children:F?"Creating...":"Create Prescription"})]})]})]})]})}export{yi as default};
