import{u as Q,j as e,H as B,L as A}from"./app-Dq_Q3Qwg.js";import{r as y}from"./vendor-DkBadjUr.js";import{A as V}from"./AdminLayout-ZetOe_y-.js";import{B as u}from"./button-C5uFo_s4.js";import{I as x}from"./input-onBXUy1Y.js";import{L as l}from"./label-D-GXHI76.js";import{T as E}from"./textarea-C9hsFzqx.js";import{S as f,a as v,b as N,c as _,d as a}from"./select-DVTvZC0C.js";import{C as b,a as C,b as q,c as S}from"./card-kiyN5UMh.js";import{A as H}from"./arrow-left-DcYYnBRL.js";import{U as O}from"./user-3RJR1iCA.js";import{P as M}from"./pill-DIGxtF-3.js";import{P as R}from"./plus-MavOGQlj.js";import{T as U}from"./trash-2-DJ5zXW8D.js";import{T as z}from"./triangle-alert-BslwqqvL.js";import"./pusher-DVtoYAOu.js";import"./index-Cwj52g8w.js";import"./avatar-BtPHERgy.js";import"./react-icons.esm-B4fS-S41.js";import"./separator-DEX7VqKX.js";import"./index-CTYbBDNA.js";import"./index-DZ3-Nn1l.js";import"./moment-C5S46NFB.js";import"./dialog-BOQ1IyqS.js";import"./index-BLzoH2V5.js";import"./tslib.es6-M_FJ09fS.js";import"./calendar-CUPskwmx.js";import"./index-Z1kVBYZG.js";import"./index-BZWX2-NB.js";import"./format-Dp3w_Y3x.js";import"./isBefore-COsor6RJ.js";import"./isSameMonth-BOwz-_mK.js";import"./TextInput-BpXAXdR6.js";import"./createLucideIcon-BKWaAi2G.js";import"./x-b8JahagL.js";import"./settings-D_MeB5oN.js";import"./house-CSq-WFst.js";import"./calendar-D9APQM2e.js";import"./users-D4PhO1-D.js";import"./badge-KwLpf8X3.js";import"./pusher-D48kA6HE.js";import"./printer-CfgcPaUh.js";import"./file-text-YZXa1D2L.js";import"./package-L7rgkkVO.js";import"./circle-check-big-BQVCuGNJ.js";import"./bell-HhCf5F9O.js";import"./index-lHzy3PXw.js";import"./proxy-CrAtMFvn.js";import"./autoprefixer-D_HbpVNe.js";import"./unit-CopbpOEH.js";import"./Toaster-BesWtvcS.js";import"./toast-CKDMsaUm.js";import"./index-DWmZ7jWL.js";import"./index-Bjz1F0Gi.js";import"./layers-OK8ayVTK.js";import"./chart-column-yMaSKbSU.js";import"./index-DqxisvwK.js";function Ke({patients:P,medicines:h}){const[n,j]=y.useState([]),[m,T]=y.useState([]);y.useEffect(()=>{h&&Array.isArray(h)&&T(h)},[h]);const{data:o,setData:p,post:D,processing:w,errors:c}=Q({patient_id:"",prescription_date:new Date().toISOString().split("T")[0],case_id:"",medicines:[],notes:""}),F=()=>{const s={id:Date.now(),medicine_id:"",dosage:"",frequency:"",duration:"",quantity:"",instructions:""};j([...n,s])},I=s=>{j(n.filter(r=>r.id!==s))},d=(s,r,i)=>{j(n.map(t=>t.id===s?{...t,[r]:i}:t))},g=(s,r)=>{if(!s||!r)return!1;const i=m.find(t=>t.id==s);return i?parseInt(r)>parseInt(i.available_quantity):!1},k=s=>{if(s.preventDefault(),n.some(t=>t.medicine_id&&t.quantity&&g(t.medicine_id,t.quantity))){alert("Please fix quantity errors before submitting the prescription.");return}const i=n.filter(t=>t.medicine_id&&t.dosage&&t.frequency&&t.duration&&t.quantity).map(t=>({medicine_id:t.medicine_id,dosage:t.dosage,frequency:t.frequency,duration:t.duration,quantity:parseInt(t.quantity),instructions:t.instructions}));console.log("Selected medicines:",n),console.log("Filtered medicines data:",i),console.log("Form data before setData:",o),p("medicines",i),console.log("Route URL:",route("doctor.prescriptions.store")),console.log("Form data after setData:",o),D("/doctor/prescriptions",{onSuccess:()=>{console.log("Prescription created successfully!"),j([])},onError:t=>{console.error("Prescription creation failed:",t)},onFinish:()=>{console.log("Form submission finished")}})},L=s=>m.find(r=>r.id==s);return e.jsxs(V,{header:"Create Prescription",children:[e.jsx(B,{title:"Create Prescription"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{href:route("doctor.prescriptions"),children:e.jsxs(u,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Back"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create Prescription"}),e.jsx("p",{className:"text-gray-600",children:"Create a new prescription for a patient"})]})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Patient Information"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"patient_id",children:"Select Patient *"}),e.jsxs(f,{value:o.patient_id,onValueChange:s=>p("patient_id",s),children:[e.jsx(v,{className:"mt-1",children:e.jsx(N,{placeholder:"Choose a patient"})}),e.jsx(_,{children:P.map(s=>e.jsxs(a,{value:String(s.id),children:[s.id," - ",s.name]},s.id))})]}),c.patient_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.patient_id})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"prescription_date",children:"Prescription Date *"}),e.jsx(x,{id:"prescription_date",type:"date",value:o.prescription_date,onChange:s=>p("prescription_date",s.target.value),className:"mt-1"}),c.prescription_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.prescription_date})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"case_id",children:"Case ID *"}),e.jsx(x,{id:"case_id",type:"text",value:o.case_id,onChange:s=>p("case_id",s.target.value),placeholder:"e.g., CASE-001, MED-2025-001, etc.",className:"mt-1"}),c.case_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.case_id})]})]})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(q,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Medicines"]}),e.jsxs(u,{type:"button",onClick:F,className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Add Medicine"]})]})}),e.jsx(S,{children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No medicines added yet"}),e.jsx("p",{className:"text-sm",children:'Click "Add Medicine" to start adding medicines to this prescription'})]}):e.jsx("div",{className:"space-y-4",children:n.map((s,r)=>{const i=L(s.medicine_id);return e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Medicine ",r+1]}),e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:()=>I(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Medicine *"}),e.jsxs(f,{value:s.medicine_id,onValueChange:t=>d(s.id,"medicine_id",t),children:[e.jsx(v,{className:"mt-1",children:e.jsx(N,{placeholder:"Select medicine"})}),e.jsx(_,{children:m&&m.length>0?m.map(t=>e.jsxs(a,{value:String(t.id),children:[t.name," (",t.generic_name,") - Batch: ",t.batch_number," - Stock: ",t.available_quantity," ",t.unit]},t.id)):e.jsx(a,{value:"no-medicines",disabled:!0,children:"No medicines available"})})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Quantity *"}),e.jsx(x,{type:"number",min:"1",value:s.quantity,onChange:t=>d(s.id,"quantity",t.target.value),placeholder:"Enter quantity",className:`mt-1 ${g(s.medicine_id,s.quantity)?"border-red-500 focus:border-red-500 focus:ring-red-500":""}`}),i&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available: ",i.available_quantity," ",i.unit]}),g(s.medicine_id,s.quantity)&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),"Quantity exceeds available stock! Available: ",i?.available_quantity||0," ",i?.unit||"units"]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Dosage *"}),e.jsx(x,{value:s.dosage,onChange:t=>d(s.id,"dosage",t.target.value),placeholder:"e.g., 500mg, 1 tablet",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Frequency *"}),e.jsxs(f,{value:s.frequency,onValueChange:t=>d(s.id,"frequency",t),children:[e.jsx(v,{className:"mt-1",children:e.jsx(N,{placeholder:"Select frequency"})}),e.jsxs(_,{children:[e.jsx(a,{value:"Once daily",children:"Once daily"}),e.jsx(a,{value:"Twice daily",children:"Twice daily"}),e.jsx(a,{value:"Three times daily",children:"Three times daily"}),e.jsx(a,{value:"Four times daily",children:"Four times daily"}),e.jsx(a,{value:"Every 6 hours",children:"Every 6 hours"}),e.jsx(a,{value:"Every 8 hours",children:"Every 8 hours"}),e.jsx(a,{value:"Every 12 hours",children:"Every 12 hours"}),e.jsx(a,{value:"As needed",children:"As needed"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Duration *"}),e.jsx(x,{value:s.duration,onChange:t=>d(s.id,"duration",t.target.value),placeholder:"e.g., 7 days, 2 weeks",className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{children:"Instructions"}),e.jsx(E,{value:s.instructions,onChange:t=>d(s.id,"instructions",t.target.value),placeholder:"Additional instructions for the patient",className:"mt-1",rows:2})]})]})]},s.id)})})})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsx(q,{children:"Additional Notes"})}),e.jsx(S,{children:e.jsx(E,{value:o.notes,onChange:s=>p("notes",s.target.value),placeholder:"Any additional notes or instructions for this prescription",rows:4})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(A,{href:route("doctor.prescriptions"),children:e.jsx(u,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(u,{type:"submit",disabled:w||n.length===0,children:w?"Creating...":"Create Prescription"})]})]})]})]})}export{Ke as default};
