import{r as m,P as O,j as e}from"./app-9IFjvyjq.js";import{D as $,a as V,b as H,c as L,d as Q}from"./dialog-BlSttdnZ.js";import{B as y}from"./button-BWLYpXz0.js";import{I as g}from"./input-fLU5VnAr.js";import{L as d}from"./label-C2QZitaL.js";import{T as U}from"./textarea-COBWyWer.js";import{S as v,a as _,b as f,c as N,d as q}from"./select-p8YEwkY-.js";import{T as D}from"./trash-2-vvbptI_1.js";import{m as S}from"./proxy-D62Q3uN7.js";import{H as X}from"./hash-C86GkOge.js";import{C as z}from"./calendar-DQr9f7aC.js";import{C as G}from"./circle-x-7HK7tFQ2.js";import{T as J}from"./triangle-alert-BkHbl9Bl.js";import{C as K}from"./circle-check-big-DR9FZaKw.js";import"./index-ZSsit5F4.js";import"./Combination-BD7y2hDp.js";import"./index-DMLVHKle.js";import"./utils-Dqxj4mrw.js";import"./index-iJsz53jB.js";import"./react-icons.esm-CBUbwQJY.js";import"./index-C6jRhQFj.js";import"./index-5FqUdhJW.js";import"./index-D1R9fGnO.js";import"./index-Bhu2lbiL.js";import"./createLucideIcon-DsPw26Nq.js";const fe=({open:p,onClose:x,item:l})=>{var b;const[C,w]=m.useState([]),[t,h]=m.useState(null),[i,c]=m.useState({}),{data:s,setData:r,post:E,processing:u}=O({item_id:(l==null?void 0:l.id)||"",batch_number:"",quantity:"",disposal_reason:"",disposal_method:"",disposal_date:"",disposed_by:"",notes:"",disposal_cost:""});m.useEffect(()=>{if(l&&p){const a=[{batch_number:l.batch_number||"BATCH-001",expiry_date:l.expiry_date||"2025-12-31",available_quantity:l.quantity||100,location:l.storage_location||"Shelf A1"}];w(a),r({item_id:l.id,batch_number:"",quantity:"",disposal_reason:"",disposal_method:"",disposal_date:new Date().toISOString().split("T")[0],disposed_by:"Current User",notes:"",disposal_cost:""})}},[l,p]);const A=a=>{h(a),r({...s,batch_number:a.batch_number,quantity:a.available_quantity}),c({})},P=()=>{const a={};return s.batch_number||(a.batch_number="Please select a batch"),!s.quantity||s.quantity<=0?a.quantity="Please enter a valid quantity":t&&s.quantity>t.available_quantity&&(a.quantity=`Quantity cannot exceed available stock (${t.available_quantity})`),s.disposal_reason.trim()||(a.disposal_reason="Please provide a reason for disposal"),s.disposal_method||(a.disposal_method="Please select a disposal method"),s.disposal_date||(a.disposal_date="Please select a disposal date"),c(a),Object.keys(a).length===0},T=a=>{if(a.preventDefault(),!!P()){if(s.quantity>t.available_quantity){c({quantity:`Cannot dispose more than available stock (${t.available_quantity} units)`});return}if(s.disposal_date&&new Date(s.disposal_date)<new Date){c({disposal_date:"Disposal date cannot be in the past"});return}E(route("pharmacist.inventory.dispose"),{onSuccess:()=>{x(),r({item_id:"",batch_number:"",quantity:"",disposal_reason:"",disposal_method:"",disposal_date:"",disposed_by:"",notes:"",disposal_cost:""}),h(null),c({})},onError:o=>{console.error("Disposal error:",o)}})}},k=a=>a?new Date(a).toLocaleDateString():"N/A",I=a=>a?new Date(a)<new Date:!1,B=a=>{if(!a)return!1;const o=new Date(a),j=Math.ceil((o-new Date)/(1e3*60*60*24));return j<=30&&j>0},F=a=>I(a)?{status:"expired",color:"text-red-600",bgColor:"bg-red-50",icon:e.jsx(G,{className:"h-4 w-4"})}:B(a)?{status:"expiring",color:"text-amber-600",bgColor:"bg-amber-50",icon:e.jsx(J,{className:"h-4 w-4"})}:{status:"valid",color:"text-green-600",bgColor:"bg-green-50",icon:e.jsx(K,{className:"h-4 w-4"})},R=[{value:"incineration",label:"Incineration"},{value:"landfill",label:"Landfill Disposal"},{value:"return_supplier",label:"Return to Supplier"},{value:"donation",label:"Donation (if applicable)"},{value:"other",label:"Other"}],M=[{value:"Expired",label:"Expired Product"},{value:"Damaged",label:"Damaged Product"},{value:"Recalled",label:"Product Recall"},{value:"Contaminated",label:"Contaminated Product"},{value:"Excess Stock",label:"Excess Stock"},{value:"Other",label:"Other"}];return l?e.jsx($,{open:p,onOpenChange:x,children:e.jsxs(V,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(H,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-red-600"}),"Batch Disposal - ",l.name]})}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Item Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.manufacturer||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"ml-2 font-medium",children:((b=l.category)==null?void 0:b.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[l.quantity||0," ",l.unit_type||"units"]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Available Batches"}),e.jsx("div",{className:"mt-2 space-y-2",children:C.map((a,o)=>{const n=F(a.expiry_date);return e.jsx(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.1},className:`p-3 border rounded-lg cursor-pointer transition-all ${(t==null?void 0:t.batch_number)===a.batch_number?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>A(a),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(t==null?void 0:t.batch_number)===a.batch_number?"bg-red-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.batch_number}),e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs ${n.bgColor} ${n.color}`,children:[n.icon,n.status==="expired"?"Expired":n.status==="expiring"?"Expiring Soon":"Valid"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Available: ",a.available_quantity," units"]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4"}),k(a.expiry_date)]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.location})]})]})},a.batch_number)})}),i.batch_number&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.batch_number})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"quantity",children:"Quantity to Dispose *"}),e.jsx(g,{id:"quantity",type:"number",min:"1",max:(t==null?void 0:t.available_quantity)||0,value:s.quantity,onChange:a=>r({...s,quantity:a.target.value}),placeholder:"Enter quantity",className:"mt-1"}),i.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.quantity}),t&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",t.available_quantity," units"]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"disposal_date",children:"Disposal Date *"}),e.jsx(g,{id:"disposal_date",type:"date",value:s.disposal_date,onChange:a=>r({...s,disposal_date:a.target.value}),className:"mt-1"}),i.disposal_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.disposal_date})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"disposal_reason",children:"Disposal Reason *"}),e.jsxs(v,{value:s.disposal_reason,onValueChange:a=>r({...s,disposal_reason:a}),children:[e.jsx(_,{className:"mt-1",children:e.jsx(f,{placeholder:"Select reason"})}),e.jsx(N,{children:M.map(a=>e.jsx(q,{value:a.value,children:a.label},a.value))})]}),i.disposal_reason&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.disposal_reason})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"disposal_method",children:"Disposal Method *"}),e.jsxs(v,{value:s.disposal_method,onValueChange:a=>r({...s,disposal_method:a}),children:[e.jsx(_,{className:"mt-1",children:e.jsx(f,{placeholder:"Select method"})}),e.jsx(N,{children:R.map(a=>e.jsx(q,{value:a.value,children:a.label},a.value))})]}),i.disposal_method&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.disposal_method})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(U,{id:"notes",value:s.notes,onChange:a=>r({...s,notes:a.target.value}),placeholder:"Any additional notes about the disposal...",className:"mt-1",rows:3})]}),t&&s.quantity&&e.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-2 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Disposal Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Batch:"}),e.jsx("span",{className:"ml-2 font-medium",children:t.batch_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Quantity:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[s.quantity," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Reason:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.disposal_reason||"Not specified"})]})]})]}),e.jsxs(Q,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:x,disabled:u,children:"Cancel"}),e.jsx(y,{type:"submit",disabled:u||!t,className:"bg-red-600 hover:bg-red-700 text-white",children:u?"Disposing...":"Dispose Batch"})]})]})]})}):null};export{fe as default};
