import{u as C,j as e}from"./app-Dq_Q3Qwg.js";import{r as n}from"./vendor-DkBadjUr.js";import{D,a as B,b as S,c as E,d as R}from"./dialog-BOQ1IyqS.js";import{B as N}from"./button-C5uFo_s4.js";import{I as g}from"./input-onBXUy1Y.js";import{L as f}from"./label-D-GXHI76.js";import{H as F}from"./hash-AgYeaIxt.js";import{C as q}from"./calendar-D9APQM2e.js";import{P as I}from"./plus-MavOGQlj.js";import{m as M}from"./proxy-CrAtMFvn.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-B4fS-S41.js";import"./index-Cwj52g8w.js";import"./index-BLzoH2V5.js";import"./tslib.es6-M_FJ09fS.js";import"./index-CTYbBDNA.js";import"./createLucideIcon-BKWaAi2G.js";const se=({open:v,onClose:d,item:t,categories:P=[],onBatchAdded:b,onCloseEditModal:y})=>{const[_,j]=n.useState({storage_location:"",batch_number:"",expiry_date:""}),[w,r]=n.useState(!1),[T,m]=n.useState(""),[c,u]=n.useState("success");n.useEffect(()=>{t&&j({storage_location:t.storageLocation||"",batch_number:"",expiry_date:""})},[t]);const{data:a,setData:L,post:A,processing:h,errors:o}=C(_),x=p=>{const{name:i,value:l}=p.target;L(i,l),j(s=>({...s,[i]:l}))},k=p=>{if(p.preventDefault(),console.log("Form submitted with data:",a),console.log("Item object:",t),!a.batch_number.trim()){console.log("Validation failed: No batch number"),alert("Please enter a batch number");return}if(!a.expiry_date){console.log("Validation failed: No expiry date"),alert("Please select an expiry date");return}if(a.expiry_date&&new Date(a.expiry_date)<=new Date){console.log("Validation failed: Expiry date in past"),alert("Expiry date must be in the future");return}const i={itemname:t.name||"",categoryid:t.categoryId||t.category?.id||"",manufacturer:t.manufacturer||"",description:t.description||"",unit_type:t.unit||t.unit_type||"",storage_location:a.storage_location||"",batch_number:a.batch_number.trim(),expiry_date:a.expiry_date,original_item_id:t.id};console.log("Item object:",t),console.log("Creating new batch:",i),console.log("About to call post with route:",route("pharmacist.inventory.item.add-batch"));const l=setTimeout(()=>{console.log("Request timeout - resetting loading state"),m("Request timed out. Please try again."),u("error"),r(!0),setTimeout(()=>{r(!1)},3e3)},1e4);fetch(route("pharmacist.inventory.item.add-batch"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(i)}).then(s=>{if(clearTimeout(l),console.log("Response received:",s.status),s.ok)return s.json();throw new Error(`HTTP error! status: ${s.status}`)}).then(s=>{console.log("Batch creation successful:",s),m("Batch added successfully!"),u("success"),r(!0),setTimeout(()=>{r(!1),d(),y&&y(),b&&b()},2e3)}).catch(s=>{clearTimeout(l),console.error("Error creating batch:",s),m("Error creating batch: "+s.message),u("error"),r(!0),setTimeout(()=>{r(!1)},3e3)})};return t?e.jsxs(D,{open:v,onOpenChange:d,children:[e.jsxs(B,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsx(E,{className:"text-xl font-semibold text-gray-900",children:"Add New Batch"}),e.jsxs("p",{className:"text-sm text-gray-600",children:['Add a new batch for "',t.name,'"']})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Batch Information"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"New batch details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(g,{id:"batch_number",name:"batch_number",value:a.batch_number,onChange:x,placeholder:"Enter batch number (e.g., RX12001121)",className:"pl-10",required:!0})]}),o.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:o.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(g,{id:"expiry_date",name:"expiry_date",type:"date",value:a.expiry_date,onChange:x,className:"pl-10",required:!0})]}),o.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:o.expiry_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"storage_location",className:"text-sm font-medium",children:"Storage Location"}),e.jsx(g,{id:"storage_location",name:"storage_location",value:a.storage_location,onChange:x,placeholder:"Enter storage location"}),o.storage_location&&e.jsx("p",{className:"text-sm text-red-600",children:o.storage_location})]})]})]}),e.jsxs(R,{className:"flex justify-end space-x-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:d,disabled:h,children:"Cancel"}),e.jsxs(N,{type:"submit",disabled:h,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),h?"Adding Batch...":"Add Batch"]})]})]})]}),w&&e.jsx(M.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:`fixed top-4 right-4 z-50 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden ${c==="success"?"border-l-4 border-green-400":"border-l-4 border-red-400"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`flex-shrink-0 ${c==="success"?"text-green-400":"text-red-400"}`,children:c==="success"?e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:`text-sm font-medium ${c==="success"?"text-green-800":"text-red-800"}`,children:T})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:()=>r(!1),children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})})})]}):null};export{se as default};
