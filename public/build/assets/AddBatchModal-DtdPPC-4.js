import{u as D,j as e}from"./app-C8tI36y-.js";import{r as d}from"./vendor-DkBadjUr.js";import{D as B,a as F,b as S,c as T,d as E}from"./dialog-ROlFfije.js";import{B as N}from"./button-B7RYL61J.js";import{I as h}from"./input-DyBsoQup.js";import{L as m}from"./label-BZn2K1na.js";import{U as I}from"./unitOptions-DzV97WAR.js";import{H as P}from"./hash-AgYeaIxt.js";import{C as V}from"./calendar-D9APQM2e.js";import{c as _}from"./createLucideIcon-BKWaAi2G.js";import{P as A}from"./plus-MavOGQlj.js";import{m as H}from"./proxy-Do-zny-D.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-BKesc81l.js";import"./index-BgM2LvZ7.js";import"./index-CR41gQkc.js";import"./tslib.es6-M_FJ09fS.js";import"./index-DorOO4sg.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]],$=_("Factory",R);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],U=_("Scale",O),de=({open:v,onClose:x,item:a,categories:Z=[],onBatchAdded:f,onCloseEditModal:g})=>{const[w,b]=d.useState({storage_location:"",batch_number:"",expiry_date:"",unit_of_measure:"",manufacturer:""}),[k,o]=d.useState(!1),[C,y]=d.useState(""),[u,j]=d.useState("success");d.useEffect(()=>{a&&b({storage_location:a.storageLocation||"",batch_number:"",expiry_date:"",unit_of_measure:a.unit||a.unit_type||"",manufacturer:a.manufacturer||""})},[a]);const{data:s,setData:L,post:q,processing:p,errors:r}=D(w),n=l=>{const{name:c,value:t}=l.target;L(c,t),b(i=>({...i,[c]:t}))},M=l=>{if(l.preventDefault(),console.log("Form submitted with data:",s),console.log("Item object:",a),!s.batch_number.trim()){console.log("Validation failed: No batch number"),alert("Please enter a batch number");return}if(!s.expiry_date){console.log("Validation failed: No expiry date"),alert("Please select an expiry date");return}if(s.expiry_date&&new Date(s.expiry_date)<=new Date){console.log("Validation failed: Expiry date in past"),alert("Expiry date must be in the future");return}const c={itemname:a.name||"",categoryid:a.categoryId||a.category?.id||"",manufacturer:s.manufacturer||a.manufacturer||"",description:a.description||"",unit_type:s.unit_of_measure||a.unit||a.unit_type||"",storage_location:s.storage_location||"",batch_number:s.batch_number.trim(),expiry_date:s.expiry_date,original_item_id:a.id};console.log("Item object:",a),console.log("Creating new batch:",c),window.axios.post(route("pharmacist.inventory.item.add-batch"),c,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>{console.log("Batch creation successful:",t.data),y(t.data.message||"Batch added successfully!"),j("success"),o(!0),setTimeout(()=>{o(!1),x(),g&&g(),f&&f()},2e3)}).catch(t=>{console.error("Error creating batch:",t);let i="Error creating batch. Please try again.";t.response&&t.response.data&&t.response.data.message?i=t.response.data.message:t.message&&(i="Error: "+t.message),y(i),j("error"),o(!0),setTimeout(()=>{o(!1)},3e3)})};return a?e.jsxs(e.Fragment,{children:[e.jsx(B,{open:v,onOpenChange:x,children:e.jsxs(F,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsx(T,{className:"text-xl font-semibold text-gray-900",children:"Add New Batch"}),e.jsxs("p",{className:"text-sm text-gray-600",children:['Add a new batch for "',a.name,'"']})]}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Batch Information"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"New batch details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(h,{id:"batch_number",name:"batch_number",value:s.batch_number,onChange:n,placeholder:"Enter batch number (e.g., RX12001121)",className:"pl-10",required:!0})]}),r.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:r.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(h,{id:"expiry_date",name:"expiry_date",type:"date",value:s.expiry_date,onChange:n,className:"pl-10",required:!0})]}),r.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.expiry_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"storage_location",className:"text-sm font-medium",children:"Storage Location"}),e.jsx(h,{id:"storage_location",name:"storage_location",value:s.storage_location,onChange:n,placeholder:"Enter storage location"}),r.storage_location&&e.jsx("p",{className:"text-sm text-red-600",children:r.storage_location})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Item Information"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Current item details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"unit_of_measure",className:"text-sm font-medium",children:"Unit of Measure"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsxs("select",{id:"unit_of_measure",name:"unit_of_measure",value:s.unit_of_measure,onChange:n,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select unit"}),I.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),r.unit_of_measure&&e.jsx("p",{className:"text-sm text-red-600",children:r.unit_of_measure})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"manufacturer",className:"text-sm font-medium",children:"Manufacturer"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(h,{id:"manufacturer",name:"manufacturer",value:s.manufacturer,onChange:n,placeholder:"Enter manufacturer name",className:"pl-10"})]}),r.manufacturer&&e.jsx("p",{className:"text-sm text-red-600",children:r.manufacturer})]})]})]}),e.jsxs(E,{className:"flex justify-end space-x-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:x,disabled:p,children:"Cancel"}),e.jsxs(N,{type:"submit",disabled:p,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),p?"Adding Batch...":"Add Batch"]})]})]})]})}),k&&e.jsx(H.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:`fixed top-4 right-4 z-[100] max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden ${u==="success"?"border-l-4 border-green-400":"border-l-4 border-red-400"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`flex-shrink-0 ${u==="success"?"text-green-400":"text-red-400"}`,children:u==="success"?e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:`text-sm font-medium ${u==="success"?"text-green-800":"text-red-800"}`,children:C})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:()=>o(!1),children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})})})]}):null};export{de as default};
