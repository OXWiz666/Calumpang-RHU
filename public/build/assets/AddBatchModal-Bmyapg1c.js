import{u as V,j as e}from"./app-CGmst3US.js";import{r as u}from"./vendor-DkBadjUr.js";import{D as $,a as O,b as A,c as H,d as R}from"./dialog-Co4q8fL2.js";import{B as C}from"./button-DtZ_znIb.js";import{I as f}from"./input-BuECbsc9.js";import{L as p}from"./label-0pL2i4V4.js";import{U}from"./unitOptions-DzV97WAR.js";import{H as Z}from"./hash-AgYeaIxt.js";import{C as z}from"./calendar-D9APQM2e.js";import{P as L}from"./plus-MavOGQlj.js";import{c as T}from"./createLucideIcon-BKWaAi2G.js";import{m as W}from"./proxy-B4BHiAvn.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-BcXWgb92.js";import"./index-B_PSVOSg.js";import"./index-Cjp041Hy.js";import"./tslib.es6-M_FJ09fS.js";import"./index-2wpBnRWd.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]],X=T("Factory",Q);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],J=T("Scale",G),ye=({open:b,onClose:j,item:t,categories:K=[],onBatchAdded:v,onCloseEditModal:w})=>{const[q,k]=u.useState({storage_location:"",batch_number:"",expiry_date:"",unit_of_measure:"",manufacturer:"",quantity:""}),[B,r]=u.useState(!1),[E,l]=u.useState(""),[g,c]=u.useState("success"),[D,M]=u.useState([]),[N,y]=u.useState(""),S=async()=>{if(t?.id)try{const s=await fetch(`/pharmacist/inventory/item/${t.id}/batches?t=${Date.now()}`);if(s.ok){const o=await s.json();M(o)}}catch(s){console.error("Error fetching batches:",s)}};u.useEffect(()=>{t&&b&&(k({storage_location:t.storageLocation||"",batch_number:"",expiry_date:"",unit_of_measure:t.unit||t.unit_type||"",manufacturer:t.manufacturer||"",quantity:""}),y(""),S())},[t,b]);const{data:a,setData:F,post:Y,processing:_,errors:i}=V(q),h=s=>{const{name:o,value:x}=s.target;F(o,x),k(d=>({...d,[o]:x})),o==="batch_number"&&I(x)},I=s=>{if(!s||!s.trim()){y("");return}const o=s.trim(),x=D.some(d=>d.batch_number&&d.batch_number.toLowerCase()===o.toLowerCase());y(x?"This batch number already exists for this item!":"")},P=s=>{if(s.preventDefault(),console.log("Form submitted with data:",a),console.log("Item object:",t),!a.batch_number.trim()){console.log("Validation failed: No batch number"),l("Please enter a batch number"),c("error"),r(!0),setTimeout(()=>r(!1),3e3);return}const o=a.batch_number.trim();if(D.some(n=>n.batch_number&&n.batch_number.toLowerCase()===o.toLowerCase())){console.log("Validation failed: Duplicate batch number"),l("This batch number already exists for this item! Please use a different batch number."),c("error"),r(!0),setTimeout(()=>r(!1),3e3);return}if(!a.expiry_date){console.log("Validation failed: No expiry date"),l("Please select an expiry date"),c("error"),r(!0),setTimeout(()=>r(!1),3e3);return}if(a.expiry_date){const n=new Date(a.expiry_date),m=new Date;if(m.setDate(m.getDate()+1),m.setHours(0,0,0,0),n<=new Date){console.log("Validation failed: Expiry date is not in the future"),l("Expiry date must be after today. Only future dates are allowed."),c("error"),r(!0),setTimeout(()=>r(!1),3e3);return}}if(!a.quantity||parseFloat(a.quantity)<=0){console.log("Validation failed: No quantity or invalid quantity"),l("Please enter a valid quantity greater than 0"),c("error"),r(!0),setTimeout(()=>r(!1),3e3);return}const d={itemname:t.name||"",categoryid:t.categoryId||t.category?.id||"",manufacturer:a.manufacturer||t.manufacturer||"",description:t.description||"",unit_type:a.unit_of_measure||t.unit||t.unit_type||"",storage_location:a.storage_location||"",batch_number:a.batch_number.trim(),expiry_date:a.expiry_date,quantity:a.quantity,original_item_id:t.id};console.log("Item object:",t),console.log("Creating new batch:",d),window.axios.post(route("pharmacist.inventory.item.add-batch"),d,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(n=>{console.log("Batch creation successful:",n.data),l(n.data.message||"Batch added successfully!"),c("success"),r(!0),setTimeout(()=>{r(!1),j(),w&&w(),v&&v()},2e3)}).catch(n=>{console.error("Error creating batch:",n);let m="Error creating batch. Please try again.";n.response&&n.response.data&&n.response.data.message?m=n.response.data.message:n.message&&(m="Error: "+n.message),l(m),c("error"),r(!0),setTimeout(()=>{r(!1)},3e3)})};return t?e.jsxs(e.Fragment,{children:[e.jsx($,{open:b,onOpenChange:j,children:e.jsxs(O,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsx(H,{className:"text-xl font-semibold text-gray-900",children:"Add New Batch"}),e.jsxs("p",{className:"text-sm text-gray-600",children:['Add a new batch for "',t.name,'"']})]}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Batch Information"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"New batch details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(f,{id:"batch_number",name:"batch_number",value:a.batch_number,onChange:h,placeholder:"Enter batch number (e.g., RX12001121)",className:`pl-10 ${N?"border-red-500":""}`,required:!0})]}),N&&e.jsx("p",{className:"text-sm text-red-600 font-medium",children:N}),i.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:i.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(f,{id:"expiry_date",name:"expiry_date",type:"date",value:a.expiry_date,onChange:h,className:"pl-10",min:new Date(Date.now()+864e5).toISOString().split("T")[0],required:!0})]}),i.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:i.expiry_date}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only future dates are allowed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"storage_location",className:"text-sm font-medium",children:"Storage Location"}),e.jsx(f,{id:"storage_location",name:"storage_location",value:a.storage_location,onChange:h,placeholder:"Enter storage location"}),i.storage_location&&e.jsx("p",{className:"text-sm text-red-600",children:i.storage_location})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"quantity",className:"text-sm font-medium",children:"Quantity *"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(f,{id:"quantity",name:"quantity",type:"number",value:a.quantity,onChange:h,placeholder:"Enter initial quantity",className:"pl-10",min:"1",step:"0.01",required:!0})]}),i.quantity&&e.jsx("p",{className:"text-sm text-red-600",children:i.quantity})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Item Information"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Current item details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"unit_of_measure",className:"text-sm font-medium",children:"Unit of Measure"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsxs("select",{id:"unit_of_measure",name:"unit_of_measure",value:a.unit_of_measure,onChange:h,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select unit"}),U.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),i.unit_of_measure&&e.jsx("p",{className:"text-sm text-red-600",children:i.unit_of_measure})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"manufacturer",className:"text-sm font-medium",children:"Manufacturer"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(f,{id:"manufacturer",name:"manufacturer",value:a.manufacturer,onChange:h,placeholder:"Enter manufacturer name",className:"pl-10"})]}),i.manufacturer&&e.jsx("p",{className:"text-sm text-red-600",children:i.manufacturer})]})]})]}),e.jsxs(R,{className:"flex justify-end space-x-2",children:[e.jsx(C,{type:"button",variant:"outline",onClick:j,disabled:_,children:"Cancel"}),e.jsxs(C,{type:"submit",disabled:_,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),_?"Adding Batch...":"Add Batch"]})]})]})]})}),B&&e.jsx(W.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:`fixed top-4 right-4 z-[100] max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden ${g==="success"?"border-l-4 border-green-400":"border-l-4 border-red-400"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`flex-shrink-0 ${g==="success"?"text-green-400":"text-red-400"}`,children:g==="success"?e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:`text-sm font-medium ${g==="success"?"text-green-800":"text-red-800"}`,children:E})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:()=>r(!1),children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})})})]}):null};export{ye as default};
