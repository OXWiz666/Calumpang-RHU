import{r as x,P as E,j as e}from"./app-B9imbgwF.js";import{D as I,a as R,b as L,c as M,d as T}from"./dialog-DPtsGNkJ.js";import{B as m}from"./button-Cp6C2OJZ.js";import{I as c}from"./input-DrzP4N1f.js";import{L as l}from"./label-1pz5fh5X.js";import{T as $}from"./textarea-D1CoOFw3.js";import{S as N,a as f,b as _,c as k,d as b}from"./select-DLnb01nw.js";import{P as z}from"./package-mXWpMwaL.js";import{m as O}from"./proxy-YO7Y0R0s.js";import{F as U}from"./file-text-DMqEqKtg.js";import{B as V}from"./building-2-D88aPbZc.js";import{H}from"./hash-wGhHJ59p.js";import{C as Q}from"./calendar-BRhaHUHQ.js";import"./Combination-BvFtu0HL.js";import"./index-CPfQda0F.js";import"./utils-D5ZoOHm5.js";import"./index-DXqKCwml.js";import"./index-CPs_XpmV.js";import"./index-DBYg8BeE.js";import"./index-Dm9R2YI4.js";import"./index-DBY2uWYu.js";import"./createLucideIcon-CiaC_9KA.js";const pe=({open:h,onClose:p,item:s})=>{const[i,S]=x.useState({}),[C,q]=x.useState([]),[D,v]=x.useState(!1),{data:a,setData:n,post:w,processing:j,reset:A}=E({item_id:s?.id||"",adjustment_type:"add",quantity:"",reason:"",reference_number:"",supplier:"",batch_number:s?.batch_number||"",expiry_date:s?.expiry_date?new Date(s.expiry_date).toISOString().split("T")[0]:"",notes:"",minimum_stock:s?.minimumStock||0,maximum_stock:s?.maximumStock||0});x.useEffect(()=>{s&&h&&(n("item_id",s.id),n("batch_number",s.batchNumber||s.batch_number||""),n("expiry_date",s.expiryDate&&s.expiryDate!=="N/A"?new Date(s.expiryDate).toISOString().split("T")[0]:""),F())},[s,h]);const F=async()=>{if(s?.id){console.log("Fetching batches for item:",s.name,"ID:",s.id),v(!0);try{const t=`/pharmacist/inventory/item/${s.id}/batches?t=${Date.now()}`;console.log("API URL:",t);const r=await fetch(t);if(console.log("Response status:",r.status),r.ok){const o=await r.json();console.log("Received batches for item",s.name,":",o),q(o)}else console.error("API response not OK:",r.status,r.statusText)}catch(t){console.error("Error fetching batches:",t)}finally{v(!1)}}},g=()=>Number(s?.quantity??s?.stock?.stocks??0)||0,d=()=>{const t=g(),r=Number(a.quantity)||0;return a.adjustment_type==="add"?t+r:t-r},u=t=>{const r=Math.max(0,Number(a.quantity||0)+t);n("quantity",r)},P=()=>{const t={};(!a.quantity||Number(a.quantity)<=0)&&(t.quantity="Please enter a valid quantity"),a.adjustment_type||(t.adjustment_type="Please select an adjustment type"),a.reason.trim()||(t.reason="Please provide a reason");const r=g();a.adjustment_type==="reduce"&&Number(a.quantity)>r&&(t.quantity=`Cannot reduce more than current stock (${r})`),a.adjustment_type==="reduce"&&d()<0&&(t.quantity="Resulting stock cannot be negative");const o=d(),y=Number(a.maximum_stock||0);return y>0&&o>y&&(t.quantity=`Projected stock (${o}) exceeds maximum (${y})`),a.minimum_stock<0&&(t.minimum_stock="Minimum stock cannot be negative"),a.maximum_stock<0&&(t.maximum_stock="Maximum stock cannot be negative"),Number(a.minimum_stock)>Number(a.maximum_stock)&&(t.maximum_stock="Maximum must be greater than or equal to minimum"),S(t),Object.keys(t).length===0},B=t=>{t.preventDefault(),P()&&w(route("pharmacist.inventory.update-stocks"),{onSuccess:()=>{p(),A()},onError:r=>{console.error("Update stocks error:",r)},preserveScroll:!0})};return s?e.jsx(I,{open:h,onOpenChange:p,children:e.jsxs(R,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(L,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Update Stocks - ",s.name]})}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Item Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[s.quantity||s.stock?.stocks||0," ",s.unit||s.unit_type||"units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.category?.name||s.category||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.manufacturer||"N/A"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Adjustment Type"}),e.jsxs(N,{value:a.adjustment_type,onValueChange:t=>n("adjustment_type",t),children:[e.jsx(f,{className:"mt-1",children:e.jsx(_,{placeholder:"Select type"})}),e.jsxs(k,{children:[e.jsx(b,{value:"add",children:"Add Stock"}),e.jsx(b,{value:"reduce",children:"Reduce Stock"})]})]}),i.adjustment_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.adjustment_type})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"quantity",children:"Quantity *"}),e.jsx(c,{id:"quantity",type:"number",min:"1",value:a.quantity,onChange:t=>n("quantity",t.target.value),placeholder:"Enter quantity",className:"mt-1"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>u(-10),children:"-10"}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>u(-1),children:"-1"}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>u(1),children:"+1"}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>u(10),children:"+10"})]}),i.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.quantity})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"reason",children:"Reason *"}),e.jsx(c,{id:"reason",value:a.reason,onChange:t=>n("reason",t.target.value),placeholder:"e.g., New delivery, correction, damage, audit",className:"mt-1"}),i.reason&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.reason})]})]}),e.jsxs(O.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Adjustment Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[g()," ",s.unit||s.unit_type||"units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Adjustment:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[a.adjustment_type==="add"?"+":"-",Number(a.quantity||0)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Projected Stock:"}),e.jsx("span",{className:`ml-2 font-medium ${d()<0?"text-red-600":""}`,children:d()})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"minimum_stock",children:"Minimum Stock Level"}),e.jsx(c,{id:"minimum_stock",type:"number",min:"0",value:a.minimum_stock,onChange:t=>n("minimum_stock",t.target.value),placeholder:"0",className:"mt-1"}),i.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.minimum_stock})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"maximum_stock",children:"Maximum Stock Level"}),e.jsx(c,{id:"maximum_stock",type:"number",min:"0",value:a.maximum_stock,onChange:t=>n("maximum_stock",t.target.value),placeholder:"0",className:"mt-1"}),i.maximum_stock&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.maximum_stock})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"reference_number",children:"Reference No."}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(c,{id:"reference_number",value:a.reference_number,onChange:t=>n("reference_number",t.target.value),placeholder:"e.g., DR-001122",className:"mt-1 pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"supplier",children:"Supplier"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(c,{id:"supplier",value:a.supplier,onChange:t=>n("supplier",t.target.value),placeholder:"Supplier name",className:"mt-1 pl-10"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"batch_number",children:"Batch/Lot Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 z-10"}),e.jsxs(N,{value:a.batch_number,onValueChange:t=>n("batch_number",t),children:[e.jsx(f,{className:"mt-1 pl-10",children:e.jsx(_,{placeholder:D?"Loading batches...":"Select a batch number"})}),e.jsx(k,{children:C.map(t=>e.jsx(b,{value:t.batch_number,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.batch_number}),t.expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.expiry_date).toLocaleDateString()]})]})},t.batch_number))})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"expiry_date",children:"Expiry Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(c,{id:"expiry_date",type:"date",value:a.expiry_date,onChange:t=>n("expiry_date",t.target.value),className:"mt-1 pl-10"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"notes",children:"Notes"}),e.jsx($,{id:"notes",value:a.notes,onChange:t=>n("notes",t.target.value),placeholder:"Any additional details...",className:"mt-1",rows:3})]}),e.jsxs(T,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:p,disabled:j,children:"Cancel"}),e.jsx(m,{type:"submit",disabled:j,style:{backgroundColor:"#2C3E50"},children:j?a.adjustment_type==="add"?"Adding...":"Reducing...":a.adjustment_type==="add"?"Add Stock":"Reduce Stock"})]})]})]})}):null};export{pe as default};
