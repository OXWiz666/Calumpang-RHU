import{r as m,P as S,j as e}from"./app-9IFjvyjq.js";import{D as E,a as w,b as P,c as k,d as A}from"./dialog-BlSttdnZ.js";import{B as j}from"./button-BWLYpXz0.js";import{I as o}from"./input-fLU5VnAr.js";import{L as l}from"./label-C2QZitaL.js";import{T as F}from"./textarea-COBWyWer.js";import{P as I}from"./package-CHcp06gv.js";import{m as y}from"./proxy-D62Q3uN7.js";import{H as T}from"./hash-C86GkOge.js";import{T as B}from"./triangle-alert-BkHbl9Bl.js";import{C as H}from"./calendar-DQr9f7aC.js";import{C as M}from"./circle-check-big-DR9FZaKw.js";import"./index-ZSsit5F4.js";import"./Combination-BD7y2hDp.js";import"./index-DMLVHKle.js";import"./utils-Dqxj4mrw.js";import"./index-iJsz53jB.js";import"./react-icons.esm-CBUbwQJY.js";import"./index-C6jRhQFj.js";import"./createLucideIcon-DsPw26Nq.js";const le=({open:d,onClose:p,item:s})=>{var b;const[g,v]=m.useState([]),[t,h]=m.useState(null),[r,x]=m.useState({}),{data:n,setData:i,post:N,processing:u}=S({item_id:(s==null?void 0:s.id)||"",batch_number:"",quantity:"",reason:"",patient_name:"",prescription_number:"",dispensed_by:"",notes:""});m.useEffect(()=>{if(s&&d){const a=[{batch_number:s.batch_number||"BATCH-001",expiry_date:s.expiry_date||"2025-12-31",available_quantity:s.quantity||100,location:s.storage_location||"Shelf A1"}];v(a),i("item_id",s.id),i("dispensed_by","Current User")}},[s,d]);const f=a=>{h(a),i("batch_number",a.batch_number),i("quantity",""),x({})},_=()=>{const a={};return n.batch_number||(a.batch_number="Please select a batch"),!n.quantity||n.quantity<=0?a.quantity="Please enter a valid quantity":t&&n.quantity>t.available_quantity&&(a.quantity=`Quantity cannot exceed available stock (${t.available_quantity})`),n.reason.trim()||(a.reason="Please provide a reason for dispensing"),n.patient_name.trim()||(a.patient_name="Please enter patient name"),n.prescription_number.trim()||(a.prescription_number="Please enter prescription number"),x(a),Object.keys(a).length===0},q=a=>{a.preventDefault(),_()&&N(route("pharmacist.inventory.dispense"),{onSuccess:()=>{p(),i({item_id:"",batch_number:"",quantity:"",reason:"",patient_name:"",prescription_number:"",dispensed_by:"",notes:""}),h(null),x({})},onError:c=>{console.error("Dispense error:",c)}})},D=a=>a?new Date(a).toLocaleDateString():"N/A",C=a=>{if(!a)return!1;const c=new Date(a);return Math.ceil((c-new Date)/(1e3*60*60*24))<=30};return s?e.jsx(E,{open:d,onOpenChange:p,children:e.jsxs(w,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Dispense Stock - ",s.name]})}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Item Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.manufacturer||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"ml-2 font-medium",children:((b=s.category)==null?void 0:b.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[s.quantity||0," ",s.unit_type||"units"]})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Available Batches"}),e.jsx("div",{className:"mt-2 space-y-2",children:g.map((a,c)=>e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:c*.1},className:`p-3 border rounded-lg cursor-pointer transition-all ${(t==null?void 0:t.batch_number)===a.batch_number?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>f(a),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(t==null?void 0:t.batch_number)===a.batch_number?"bg-blue-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.batch_number}),C(a.expiry_date)&&e.jsx(B,{className:"h-4 w-4 text-amber-500"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Available: ",a.available_quantity," units"]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-4 w-4"}),D(a.expiry_date)]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.location})]})]})},a.batch_number))}),r.batch_number&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.batch_number})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"quantity",children:"Quantity to Dispense *"}),e.jsx(o,{id:"quantity",type:"number",min:"1",max:(t==null?void 0:t.available_quantity)||0,value:n.quantity,onChange:a=>i("quantity",a.target.value),placeholder:"Enter quantity",className:"mt-1"}),r.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.quantity}),t&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",t.available_quantity," units"]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"reason",children:"Reason for Dispensing *"}),e.jsx(o,{id:"reason",value:n.reason,onChange:a=>i("reason",a.target.value),placeholder:"e.g., Prescription, Emergency",className:"mt-1"}),r.reason&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.reason})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"patient_name",children:"Patient Name *"}),e.jsx(o,{id:"patient_name",value:n.patient_name,onChange:a=>i("patient_name",a.target.value),placeholder:"Enter patient name",className:"mt-1"}),r.patient_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.patient_name})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"prescription_number",children:"Prescription Number *"}),e.jsx(o,{id:"prescription_number",value:n.prescription_number,onChange:a=>i("prescription_number",a.target.value),placeholder:"Enter prescription number",className:"mt-1"}),r.prescription_number&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:r.prescription_number})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(F,{id:"notes",value:n.notes,onChange:a=>i("notes",a.target.value),placeholder:"Any additional notes or instructions...",className:"mt-1",rows:3})]}),t&&n.quantity&&e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Dispense Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Batch:"}),e.jsx("span",{className:"ml-2 font-medium",children:t.batch_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Quantity:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.quantity," units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Patient:"}),e.jsx("span",{className:"ml-2 font-medium",children:n.patient_name||"Not specified"})]})]})]}),e.jsxs(A,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:p,disabled:u,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:u||!t,style:{backgroundColor:"#2C3E50"},children:u?"Dispensing...":"Dispense Stock"})]})]})]})}):null};export{le as default};
