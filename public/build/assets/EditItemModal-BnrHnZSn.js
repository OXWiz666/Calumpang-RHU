import{u as L,j as e,r as M}from"./app-Bz1k8fwb.js";import{r as p}from"./vendor-DkBadjUr.js";import{D as O,a as U,b as k,c as V,d as $}from"./dialog-Nua2NsPT.js";import{B as u}from"./button-BuxGVvE1.js";import{I as y}from"./input-Cxfo37eO.js";import{L as o}from"./label-DZLKBD76.js";import{T as H}from"./textarea-7f3gFOps.js";import{S as f,a as b,b as g,c as N,d as j}from"./select-CzkTuhTK.js";import{U as P}from"./unitOptions-DzV97WAR.js";import{B as z}from"./building-2-DmPcAwng.js";import{P as R}from"./plus-MavOGQlj.js";import{H as q}from"./hash-AgYeaIxt.js";import{C as G}from"./calendar-D9APQM2e.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-CaEbm_m1.js";import"./index-Sbype2of.js";import"./index-CVzUxLnK.js";import"./tslib.es6-M_FJ09fS.js";import"./index-COj9XpJO.js";import"./index-C9cWDRNv.js";import"./index-C2K23d2_.js";import"./index-zhi7iPPU.js";import"./index-2C8mQqet.js";import"./index-DqxisvwK.js";import"./index-DFHF6qpL.js";import"./createLucideIcon-BKWaAi2G.js";const ge=({open:x,onClose:h,item:a,categories:S=[],onAddBatch:D})=>{const[v,B]=p.useState([]),[C,_]=p.useState(!1),E=async()=>{if(a?.id){_(!0);try{const t=await fetch(`/pharmacist/inventory/item/${a.id}/batches?t=${Date.now()}`);if(t.ok){const r=await t.json();B(r)}}catch(t){console.error("Error fetching batches:",t)}finally{_(!1)}}},T={itemname:a?.name||"",categoryid:a?.categoryId||"",manufacturer:a?.manufacturer||"",description:a?.description||"",unit_type:a?.unit||"",storage_location:a?.storageLocation||"",batch_number:(()=>{if(a?.batches&&a.batches.length>0){const r=a.batches[0].batchNumber;return r&&r!=="N/A"&&r!=="new_batch"?r:""}const t=a?.batch_number;return t&&t!=="N/A"&&t!=="new_batch"?t:""})(),expiry_date:(()=>{if(a?.batches&&a.batches.length>0){const t=a.batches.reduce((r,s)=>{if(!r||s.expiryDate==="N/A"||r.expiryDate==="N/A")return s;try{const l=new Date(s.expiryDate),d=new Date(r.expiryDate);return isNaN(l.getTime())||isNaN(d.getTime())?r:l<d?s:r}catch{return r}},null);if(t&&t.expiryDate&&t.expiryDate!=="N/A")try{const r=new Date(t.expiryDate);if(!isNaN(r.getTime()))return r.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",t.expiryDate)}}if(a?.expiryDate&&a.expiryDate!=="N/A"&&a.expiryDate!=="Invalid Date")try{const t=new Date(a.expiryDate);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",a.expiryDate)}return""})()},{data:n,setData:c,put:A,processing:w,errors:i}=L(T);p.useEffect(()=>{a&&x&&(c("itemname",a.name||""),c("categoryid",a.categoryId||""),c("manufacturer",a.manufacturer||""),c("description",a.description||""),c("unit_type",a.unit||""),c("storage_location",a.storageLocation||""),c("batch_number",(()=>{if(a.batches&&a.batches.length>0){const s=a.batches[0].batchNumber;return s&&s!=="N/A"&&s!=="new_batch"?s:""}const t=a.batch_number;return t&&t!=="N/A"&&t!=="new_batch"?t:""})()),c("expiry_date",(()=>{if(a.batches&&a.batches.length>0){const t=a.batches.reduce((r,s)=>{if(!r||s.expiryDate==="N/A"||r.expiryDate==="N/A")return s;try{const l=new Date(s.expiryDate),d=new Date(r.expiryDate);return isNaN(l.getTime())||isNaN(d.getTime())?r:l<d?s:r}catch{return r}},null);if(t&&t.expiryDate&&t.expiryDate!=="N/A")try{const r=new Date(t.expiryDate);if(!isNaN(r.getTime()))return r.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",t.expiryDate)}}if(a.expiryDate&&a.expiryDate!=="N/A"&&a.expiryDate!=="Invalid Date")try{const t=new Date(a.expiryDate);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",a.expiryDate)}return""})()),E())},[a,x]);const m=t=>{const{name:r,value:s}=t.target;console.log("Input change:",{name:r,value:s,currentData:n.batch_number}),c(r,s)},I=(t,r)=>{c(t,r)},F=t=>{if(t.preventDefault(),!n.itemname.trim()||!n.categoryid||!n.unit_type||n.expiry_date&&new Date(n.expiry_date)<=new Date)return;const r={...n};console.log("Updating existing item:",r),A(route("pharmacist.inventory.item.update",a.id),{data:r,onSuccess:()=>{h(),M.visit(window.location.pathname,{method:"get"})},onError:s=>{console.error("Validation errors:",s)}})};return a?e.jsx(O,{open:x,onOpenChange:t=>{t||h()},children:e.jsxs(U,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(V,{className:"text-xl font-semibold text-gray-900",children:"Edit Item"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update the information for this inventory item"})]}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"itemname",className:"text-sm font-medium",children:"Item Name *"}),e.jsx(y,{id:"itemname",name:"item name",value:n.itemname,onChange:m,placeholder:"Enter item name",className:"w-full"}),i.itemname&&e.jsx("p",{className:"text-sm text-red-600",children:i.itemname})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"categoryid",className:"text-sm font-medium",children:"Category *"}),e.jsxs(f,{value:n.categoryid,onValueChange:t=>I("categoryid",t),children:[e.jsx(b,{children:e.jsx(g,{placeholder:"Select category"})}),e.jsx(N,{children:S.map(t=>e.jsx(j,{value:t.id.toString(),children:t.name},t.id))})]}),i.categoryid&&e.jsx("p",{className:"text-sm text-red-600",children:i.categoryid})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"manufacturer",className:"text-sm font-medium",children:"Manufacturer"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(y,{id:"manufacturer",name:"manufacturer",value:n.manufacturer,onChange:m,placeholder:"Enter manufacturer",className:"w-full pl-10"})]}),i.manufacturer&&e.jsx("p",{className:"text-sm text-red-600",children:i.manufacturer})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"unit_type",className:"text-sm font-medium",children:"Unit of Measure *"}),e.jsxs(f,{value:n.unit_type,onValueChange:t=>I("unit_type",t),children:[e.jsx(b,{children:e.jsx(g,{placeholder:"Select unit"})}),e.jsx(N,{children:P.map(t=>e.jsx(j,{value:t.value,children:t.label},t.value))})]}),i.unit_type&&e.jsx("p",{className:"text-sm text-red-600",children:i.unit_type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",className:"text-sm font-medium",children:"Description"}),e.jsx(H,{id:"description",name:"description",value:n.description,onChange:m,placeholder:"Enter item description",rows:3,className:"w-full"}),i.description&&e.jsx("p",{className:"text-sm text-red-600",children:i.description})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Batch & Expiry Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number"}),e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:()=>D&&D(a),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(R,{className:"w-4 h-4"}),"Add Batch"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 pointer-events-none"}),e.jsxs(f,{value:n.batch_number||"",onValueChange:t=>{console.log("Select value changed to:",t),c("batch_number",t),console.log("Set batch_number to:",t)},children:[e.jsx(b,{className:"w-full pl-10",children:e.jsx(g,{placeholder:C?"Loading batches...":"Select a batch number"})}),e.jsx(N,{children:v.length>0?v.filter(t=>t.batch_number&&t.batch_number!=="new_batch"&&t.batch_number!=="N/A").map((t,r)=>e.jsx(j,{value:t.batch_number,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.batch_number}),t.expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.expiry_date).toLocaleDateString()]})]})},`batch-${t.batch_number}-${r}`)):e.jsx("div",{className:"px-2 py-1 text-sm text-gray-500",children:"No batches available"})})]})]}),i.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:i.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(y,{id:"expiry_date",name:"expiry_date",type:"date",value:n.expiry_date,onChange:m,className:"w-full pl-10"})]}),i.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:i.expiry_date})]})]})]}),e.jsxs($,{className:"flex gap-3 pt-6",children:[e.jsx(u,{type:"button",variant:"outline",onClick:h,className:"flex-1",children:"Cancel"}),e.jsx(u,{type:"submit",disabled:w,className:"flex-1",style:{backgroundColor:"#2C3E50"},children:w?"Updating...":"Update Item"})]})]})]})}):null};export{ge as default};
