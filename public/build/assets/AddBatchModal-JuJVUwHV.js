import{u as R,j as e}from"./app-BQNQ1hxz.js";import{r as h}from"./vendor-DkBadjUr.js";import{D as V,a as $,b as A,c as H,d as U}from"./dialog-IT4MXJ9f.js";import{B as C}from"./button-C7_v29ma.js";import{I as u}from"./input-DDD8PP7k.js";import{L as l}from"./label-BVBpM07b.js";import{U as X}from"./unitOptions-DzV97WAR.js";import{H as Q}from"./hash-AgYeaIxt.js";import{C as W}from"./calendar-D9APQM2e.js";import{P as S}from"./plus-MavOGQlj.js";import{P as Z}from"./package-L7rgkkVO.js";import{c as D}from"./createLucideIcon-BKWaAi2G.js";import{T as z}from"./trending-down-DADUT3dQ.js";import{T as J}from"./trending-up-BFbz08q-.js";import{m as K}from"./proxy-or7Emd4Q.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-BefAJGKT.js";import"./index-DQ-l7Ake.js";import"./index-CWXeSRhr.js";import"./tslib.es6-M_FJ09fS.js";import"./index-CHuFBonQ.js";/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]],Y=D("Factory",G);/**
 * @license lucide-react v0.477.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],te=D("Scale",ee),we=({open:y,onClose:j,item:a,categories:ae=[],onBatchAdded:v,onCloseEditModal:k})=>{const[L,w]=h.useState({storage_location:"",batch_number:"",expiry_date:"",minimum_stock:"",maximum_stock:"",unit_of_measure:"",manufacturer:"",quantity:"",current_quantity:""}),[E,s]=h.useState(!1),[M,m]=h.useState(""),[f,d]=h.useState("success"),[q,B]=h.useState([]),[b,g]=h.useState(""),F=async()=>{if(a?.id)try{const i=await fetch(`/pharmacist/inventory/item/${a.id}/batches?t=${Date.now()}`);if(i.ok){const c=await i.json();B(c)}}catch(i){console.error("Error fetching batches:",i)}};h.useEffect(()=>{a&&y&&(w({storage_location:a.storageLocation||"",batch_number:"",expiry_date:"",minimum_stock:a.minimum_stock||a.minimumStock||"",maximum_stock:a.maximum_stock||a.maximumStock||"",unit_of_measure:a.unit||a.unit_type||"",manufacturer:a.manufacturer||"",quantity:"",current_quantity:a.currentQuantity||a.quantity||a.stock?.stocks||""}),g(""),F())},[a,y]);const{data:t,setData:I,post:se,processing:N,errors:r}=R(L),o=i=>{const{name:c,value:p}=i.target;I(c,p),w(x=>({...x,[c]:p})),c==="batch_number"&&P(p)},P=i=>{if(!i||!i.trim()){g("");return}const c=i.trim(),p=q.some(x=>x.batch_number&&x.batch_number.toLowerCase()===c.toLowerCase());g(p?"This batch number already exists for this item!":"")},O=i=>{if(i.preventDefault(),console.log("Form submitted with data:",t),console.log("Item object:",a),!t.batch_number.trim()){console.log("Validation failed: No batch number"),m("Please enter a batch number"),d("error"),s(!0),setTimeout(()=>s(!1),3e3);return}const c=t.batch_number.trim();if(q.some(n=>n.batch_number&&n.batch_number.toLowerCase()===c.toLowerCase())){console.log("Validation failed: Duplicate batch number"),m("This batch number already exists for this item! Please use a different batch number."),d("error"),s(!0),setTimeout(()=>s(!1),3e3);return}if(!t.expiry_date){console.log("Validation failed: No expiry date"),m("Please select an expiry date"),d("error"),s(!0),setTimeout(()=>s(!1),3e3);return}if(t.expiry_date){const n=new Date(t.expiry_date),_=new Date;if(_.setDate(_.getDate()+1),_.setHours(0,0,0,0),n<=new Date){console.log("Validation failed: Expiry date is not in the future"),m("Expiry date must be after today. Only future dates are allowed."),d("error"),s(!0),setTimeout(()=>s(!1),3e3);return}}if(!t.quantity||parseFloat(t.quantity)<=0){console.log("Validation failed: No quantity or invalid quantity"),m("Please enter a valid quantity greater than 0"),d("error"),s(!0),setTimeout(()=>s(!1),3e3);return}const x={itemname:a.name||"",categoryid:a.categoryId||a.category?.id||"",manufacturer:t.manufacturer||a.manufacturer||"",description:a.description||"",unit_type:t.unit_of_measure||a.unit||a.unit_type||"",storage_location:t.storage_location||"",batch_number:t.batch_number.trim(),expiry_date:t.expiry_date,quantity:t.quantity,minimum_stock:t.minimum_stock||"",maximum_stock:t.maximum_stock||"",original_item_id:a.id};console.log("Item object:",a),console.log("Creating new batch:",x),console.log("About to call post with route:",route("pharmacist.inventory.item.add-batch"));const T=setTimeout(()=>{console.log("Request timeout - resetting loading state"),m("Request timed out. Please try again."),d("error"),s(!0),setTimeout(()=>{s(!1)},3e3)},1e4);fetch(route("pharmacist.inventory.item.add-batch"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(x)}).then(n=>{if(clearTimeout(T),console.log("Response received:",n.status),n.ok)return n.json();throw new Error(`HTTP error! status: ${n.status}`)}).then(n=>{console.log("Batch creation successful:",n),m("Batch added successfully!"),d("success"),s(!0),setTimeout(()=>{s(!1),j(),k&&k(),v&&v()},2e3)}).catch(n=>{clearTimeout(T),console.error("Error creating batch:",n),m("Error creating batch: "+n.message),d("error"),s(!0),setTimeout(()=>{s(!1)},3e3)})};return a?e.jsxs(V,{open:y,onOpenChange:j,children:[e.jsxs($,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsx(H,{className:"text-xl font-semibold text-gray-900",children:"Add New Batch"}),e.jsxs("p",{className:"text-sm text-gray-600",children:['Add a new batch for "',a.name,'"']})]}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Batch Information"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"New batch details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{id:"batch_number",name:"batch_number",value:t.batch_number,onChange:o,placeholder:"Enter batch number (e.g., RX12001121)",className:`pl-10 ${b?"border-red-500":""}`,required:!0})]}),b&&e.jsx("p",{className:"text-sm text-red-600 font-medium",children:b}),r.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:r.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{id:"expiry_date",name:"expiry_date",type:"date",value:t.expiry_date,onChange:o,className:"pl-10",min:new Date(Date.now()+864e5).toISOString().split("T")[0],required:!0})]}),r.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.expiry_date}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only future dates are allowed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"storage_location",className:"text-sm font-medium",children:"Storage Location"}),e.jsx(u,{id:"storage_location",name:"storage_location",value:t.storage_location,onChange:o,placeholder:"Enter storage location"}),r.storage_location&&e.jsx("p",{className:"text-sm text-red-600",children:r.storage_location})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"quantity",className:"text-sm font-medium",children:"Quantity *"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{id:"quantity",name:"quantity",type:"number",value:t.quantity,onChange:o,placeholder:"Enter initial quantity",className:"pl-10",min:"1",step:"0.01",required:!0})]}),r.quantity&&e.jsx("p",{className:"text-sm text-red-600",children:r.quantity})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Item Information"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Current item details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"current_quantity",className:"text-sm font-medium",children:"Current Quantity"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{id:"current_quantity",name:"current_quantity",type:"number",value:t.current_quantity,onChange:o,placeholder:"Enter current quantity",className:"pl-10",readOnly:!0})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Current stock level (read-only)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"unit_of_measure",className:"text-sm font-medium",children:"Unit of Measure"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsxs("select",{id:"unit_of_measure",name:"unit_of_measure",value:t.unit_of_measure,onChange:o,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select unit"}),X.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]})]}),r.unit_of_measure&&e.jsx("p",{className:"text-sm text-red-600",children:r.unit_of_measure})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"manufacturer",className:"text-sm font-medium",children:"Manufacturer"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{id:"manufacturer",name:"manufacturer",value:t.manufacturer,onChange:o,placeholder:"Enter manufacturer name",className:"pl-10"})]}),r.manufacturer&&e.jsx("p",{className:"text-sm text-red-600",children:r.manufacturer})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"minimum_stock",className:"text-sm font-medium",children:"Minimum Stock Level"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{id:"minimum_stock",name:"minimum_stock",type:"number",min:"0",value:t.minimum_stock,onChange:o,placeholder:"Enter minimum stock level",className:"pl-10"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alert threshold for low stock"}),r.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600",children:r.minimum_stock})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"maximum_stock",className:"text-sm font-medium",children:"Maximum Stock Level"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{id:"maximum_stock",name:"maximum_stock",type:"number",min:"0",value:t.maximum_stock,onChange:o,placeholder:"Enter maximum stock level",className:"pl-10"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum capacity limit"}),r.maximum_stock&&e.jsx("p",{className:"text-sm text-red-600",children:r.maximum_stock})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Stock Level Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:t.current_quantity||0}),e.jsx("div",{className:"text-gray-600",children:"Current"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:t.minimum_stock||0}),e.jsx("div",{className:"text-gray-600",children:"Minimum"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:t.maximum_stock||0}),e.jsx("div",{className:"text-gray-600",children:"Maximum"})]})]})]})]}),e.jsxs(U,{className:"flex justify-end space-x-2",children:[e.jsx(C,{type:"button",variant:"outline",onClick:j,disabled:N,children:"Cancel"}),e.jsxs(C,{type:"submit",disabled:N,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),N?"Adding Batch...":"Add Batch"]})]})]})]}),E&&e.jsx(K.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:`fixed top-4 right-4 z-50 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden ${f==="success"?"border-l-4 border-green-400":"border-l-4 border-red-400"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`flex-shrink-0 ${f==="success"?"text-green-400":"text-red-400"}`,children:f==="success"?e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:`text-sm font-medium ${f==="success"?"text-green-800":"text-red-800"}`,children:M})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:()=>s(!1),children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})})})]}):null};export{we as default};
