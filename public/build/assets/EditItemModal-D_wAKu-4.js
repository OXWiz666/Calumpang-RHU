import{r as o,P as k,j as e}from"./app-CNLcV3Uy.js";import{D as M,a as V,b as U,c as O,d as P}from"./dialog-DVfT_V8C.js";import{B as I}from"./button-sKrKyyfs.js";import{I as x}from"./input-DwwFRcXc.js";import{L as i}from"./label-NZo9JiVO.js";import{T as H}from"./textarea-jcbswd-T.js";import{S as f,a as y,b as g,c as j,d}from"./select-Bp0DYyHk.js";import{B as R}from"./building-2-B0lsIeAk.js";import{H as $}from"./hash-ClIj3HX8.js";import{C as q}from"./calendar-Cuf42Q_b.js";import"./Combination-ISuQ_xQH.js";import"./index-CRjh3eQV.js";import"./utils-Cdwu_oFC.js";import"./index-CY8IRa4h.js";import"./index-5XPp9efM.js";import"./index-BmPn7Lwa.js";import"./index--okc8Vo6.js";import"./index-DCywbQWC.js";import"./createLucideIcon-N6tzm2Un.js";const me=({open:h,onClose:u,item:t,categories:S=[]})=>{const[C,B]=o.useState({itemname:"",categoryid:"",manufacturer:"",description:"",quantity:0,unit_type:"",minimum_stock:0,maximum_stock:0,storage_location:"",batch_number:"",expiry_date:""}),[p,E]=o.useState([]),[N,v]=o.useState(!1),T=async()=>{if(t?.id){v(!0);try{const a=await fetch(`/pharmacist/inventory/item/${t.id}/batches?t=${Date.now()}`);if(a.ok){const s=await a.json();E(s)}}catch(a){console.error("Error fetching batches:",a)}finally{v(!1)}}};o.useEffect(()=>{t&&(B({itemname:t.name||"Invalid Name",categoryid:t.categoryId||"Invalid Category",manufacturer:t.manufacturer||"Invalid Manufacturer",description:t.description||"Invalid Description",unit_type:t.unit||"Invalid Unit",storage_location:t.storageLocation||"Invalid Storage Location",batch_number:t.batches&&t.batches.length>0?t.batches[0].batchNumber||"Invalid Batch Number":t.batchNumber||"Invalid Batch Number",expiry_date:(()=>{if(t.batches&&t.batches.length>0){const a=t.batches.reduce((s,n)=>{if(!s||n.expiryDate==="N/A"||s.expiryDate==="N/A")return n;try{const b=new Date(n.expiryDate),w=new Date(s.expiryDate);return isNaN(b.getTime())||isNaN(w.getTime())?s:b<w?n:s}catch{return s}},null);if(a&&a.expiryDate&&a.expiryDate!=="N/A")try{const s=new Date(a.expiryDate);if(!isNaN(s.getTime()))return s.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",a.expiryDate)}}if(t.expiryDate&&t.expiryDate!=="N/A"&&t.expiryDate!=="Invalid Date")try{const a=new Date(t.expiryDate);if(!isNaN(a.getTime()))return a.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",t.expiryDate)}return""})()}),h&&T())},[t,h]);const{data:r,setData:m,put:F,processing:_,errors:l}=k(C),c=a=>{const{name:s,value:n}=a.target;m(s,n)},D=(a,s)=>{m(a,s)},A=a=>{a.preventDefault(),r.itemname.trim()&&r.categoryid&&r.unit_type&&(r.expiry_date&&new Date(r.expiry_date)<=new Date||F(route("pharmacist.inventory.item.update",t.id),{onSuccess:()=>{u()},onError:s=>{console.error("Validation errors:",s)}}))},L=[{value:"pieces",label:"Pieces"},{value:"tablets",label:"Tablets"},{value:"capsules",label:"Capsules"},{value:"bottles",label:"Bottles"},{value:"vials",label:"Vials"},{value:"tubes",label:"Tubes"},{value:"boxes",label:"Boxes"},{value:"packs",label:"Packs"}];return t?e.jsx(M,{open:h,onOpenChange:u,children:e.jsxs(V,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(U,{children:[e.jsx(O,{className:"text-xl font-semibold text-gray-900",children:"Edit Item"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update the information for this inventory item"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"itemname",className:"text-sm font-medium",children:"Item Name *"}),e.jsx(x,{id:"itemname",name:"item name",value:r.itemname,onChange:c,placeholder:"Enter item name",className:"w-full"}),l.itemname&&e.jsx("p",{className:"text-sm text-red-600",children:l.itemname})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"categoryid",className:"text-sm font-medium",children:"Category *"}),e.jsxs(f,{value:r.categoryid,onValueChange:a=>D("categoryid",a),children:[e.jsx(y,{children:e.jsx(g,{placeholder:"Select category"})}),e.jsx(j,{children:S.map(a=>e.jsx(d,{value:a.id.toString(),children:a.name},a.id))})]}),l.categoryid&&e.jsx("p",{className:"text-sm text-red-600",children:l.categoryid})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"manufacturer",className:"text-sm font-medium",children:"Manufacturer"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(x,{id:"manufacturer",name:"manufacturer",value:r.manufacturer,onChange:c,placeholder:"Enter manufacturer",className:"w-full pl-10"})]}),l.manufacturer&&e.jsx("p",{className:"text-sm text-red-600",children:l.manufacturer})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"unit_type",className:"text-sm font-medium",children:"Unit of Measure *"}),e.jsxs(f,{value:r.unit_type,onValueChange:a=>D("unit_type",a),children:[e.jsx(y,{children:e.jsx(g,{placeholder:"Select unit"})}),e.jsx(j,{children:L.map(a=>e.jsx(d,{value:a.value,children:a.label},a.value))})]}),l.unit_type&&e.jsx("p",{className:"text-sm text-red-600",children:l.unit_type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",className:"text-sm font-medium",children:"Description"}),e.jsx(H,{id:"description",name:"description",value:r.description,onChange:c,placeholder:"Enter item description",rows:3,className:"w-full"}),l.description&&e.jsx("p",{className:"text-sm text-red-600",children:l.description})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Batch & Expiry Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 z-10"}),e.jsxs(f,{value:r.batch_number,onValueChange:a=>{a==="new_batch"?m("batch_number",""):m("batch_number",a)},children:[e.jsx(y,{className:"w-full pl-10",children:e.jsx(g,{placeholder:N?"Loading batches...":"Select a batch number"})}),e.jsx(j,{children:p.length>0?e.jsxs(e.Fragment,{children:[p.map(a=>e.jsx(d,{value:a.batch_number,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:a.batch_number}),a.expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Expires: ",new Date(a.expiry_date).toLocaleDateString()]})]})},a.batch_number)),e.jsx(d,{value:"new_batch",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:"+ Add New Batch"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Create a new batch number"})]})})]}):e.jsx(d,{value:"new_batch",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:"+ Add New Batch"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Create a new batch number"})]})})})]})]}),(p.length===0||r.batch_number==="")&&!N&&e.jsx("div",{className:"mt-1",children:e.jsx(x,{id:"batch_number_input",value:r.batch_number,onChange:c,placeholder:"Enter new batch number (e.g., RX12001121)",className:"pl-10"})}),l.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:l.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(x,{id:"expiry_date",name:"expiry_date",type:"date",value:r.expiry_date,onChange:c,className:"w-full pl-10"})]}),l.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:l.expiry_date})]})]})]}),e.jsxs(P,{className:"flex gap-3 pt-6",children:[e.jsx(I,{type:"button",variant:"outline",onClick:u,className:"flex-1",children:"Cancel"}),e.jsx(I,{type:"submit",disabled:_,className:"flex-1",style:{backgroundColor:"#2C3E50"},children:_?"Updating...":"Update Item"})]})]})]})}):null};export{me as default};
