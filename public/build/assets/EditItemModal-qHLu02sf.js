import{u as L,j as e}from"./app-Ci6FsPEI.js";import{r as h}from"./vendor-DkBadjUr.js";import{D as M,a as O,b as V,c as U,d as P}from"./dialog-NMjAdLkI.js";import{B as p}from"./button-CNgURIMK.js";import{I as b}from"./input-CCqrrlXQ.js";import{L as o}from"./label-Bsu9V-2p.js";import{T as $}from"./textarea-CmmM-UAe.js";import{S as y,a as f,b as g,c as N,d as j}from"./select-Bs3uVyOJ.js";import{B as H}from"./building-2-DmPcAwng.js";import{P as z}from"./plus-MavOGQlj.js";import{H as R}from"./hash-AgYeaIxt.js";import{C as q}from"./calendar-D9APQM2e.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-Cg1Z9ZGK.js";import"./index-BpVWxWkG.js";import"./index-BYyo8n0W.js";import"./tslib.es6-M_FJ09fS.js";import"./index-PUx0SOs8.js";import"./index-B6i_t9H1.js";import"./index-D0_reY7q.js";import"./index-DbZPFhJ9.js";import"./index-CuaviD7G.js";import"./index-DqxisvwK.js";import"./index-MVKj6Ku2.js";import"./createLucideIcon-BKWaAi2G.js";const ye=({open:x,onClose:u,item:t,categories:I=[],onAddBatch:v})=>{const[D,B]=h.useState([]),[C,_]=h.useState(!1),E=async()=>{if(t?.id){_(!0);try{const a=await fetch(`/pharmacist/inventory/item/${t.id}/batches?t=${Date.now()}`);if(a.ok){const r=await a.json();B(r)}}catch(a){console.error("Error fetching batches:",a)}finally{_(!1)}}},T={itemname:t?.name||"",categoryid:t?.categoryId||"",manufacturer:t?.manufacturer||"",description:t?.description||"",unit_type:t?.unit||"",storage_location:t?.storageLocation||"",batch_number:(()=>{if(t?.batches&&t.batches.length>0){const r=t.batches[0].batchNumber;return r&&r!=="N/A"&&r!=="new_batch"?r:""}const a=t?.batch_number;return a&&a!=="N/A"&&a!=="new_batch"?a:""})(),expiry_date:(()=>{if(t?.batches&&t.batches.length>0){const a=t.batches.reduce((r,s)=>{if(!r||s.expiryDate==="N/A"||r.expiryDate==="N/A")return s;try{const c=new Date(s.expiryDate),d=new Date(r.expiryDate);return isNaN(c.getTime())||isNaN(d.getTime())?r:c<d?s:r}catch{return r}},null);if(a&&a.expiryDate&&a.expiryDate!=="N/A")try{const r=new Date(a.expiryDate);if(!isNaN(r.getTime()))return r.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",a.expiryDate)}}if(t?.expiryDate&&t.expiryDate!=="N/A"&&t.expiryDate!=="Invalid Date")try{const a=new Date(t.expiryDate);if(!isNaN(a.getTime()))return a.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",t.expiryDate)}return""})()},{data:n,setData:l,put:A,processing:w,errors:i}=L(T);h.useEffect(()=>{t&&x&&(l("itemname",t.name||""),l("categoryid",t.categoryId||""),l("manufacturer",t.manufacturer||""),l("description",t.description||""),l("unit_type",t.unit||""),l("storage_location",t.storageLocation||""),l("batch_number",(()=>{if(t.batches&&t.batches.length>0){const s=t.batches[0].batchNumber;return s&&s!=="N/A"&&s!=="new_batch"?s:""}const a=t.batch_number;return a&&a!=="N/A"&&a!=="new_batch"?a:""})()),l("expiry_date",(()=>{if(t.batches&&t.batches.length>0){const a=t.batches.reduce((r,s)=>{if(!r||s.expiryDate==="N/A"||r.expiryDate==="N/A")return s;try{const c=new Date(s.expiryDate),d=new Date(r.expiryDate);return isNaN(c.getTime())||isNaN(d.getTime())?r:c<d?s:r}catch{return r}},null);if(a&&a.expiryDate&&a.expiryDate!=="N/A")try{const r=new Date(a.expiryDate);if(!isNaN(r.getTime()))return r.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",a.expiryDate)}}if(t.expiryDate&&t.expiryDate!=="N/A"&&t.expiryDate!=="Invalid Date")try{const a=new Date(t.expiryDate);if(!isNaN(a.getTime()))return a.toISOString().split("T")[0]}catch{console.warn("Invalid expiry date in EditItemModal:",t.expiryDate)}return""})()),E())},[t,x]);const m=a=>{const{name:r,value:s}=a.target;console.log("Input change:",{name:r,value:s,currentData:n.batch_number}),l(r,s)},S=(a,r)=>{l(a,r)},F=a=>{if(a.preventDefault(),!n.itemname.trim()||!n.categoryid||!n.unit_type||n.expiry_date&&new Date(n.expiry_date)<=new Date)return;const r={...n};console.log("Updating existing item:",r),A(route("pharmacist.inventory.item.update",t.id),{data:r,onSuccess:()=>{u()},onError:s=>{console.error("Validation errors:",s)}})},k=[{value:"pieces",label:"Pieces"},{value:"tablets",label:"Tablets"},{value:"capsules",label:"Capsules"},{value:"bottles",label:"Bottles"},{value:"vials",label:"Vials"},{value:"tubes",label:"Tubes"},{value:"boxes",label:"Boxes"},{value:"packs",label:"Packs"}];return t?e.jsx(M,{open:x,onOpenChange:a=>{a||u()},children:e.jsxs(O,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsx(U,{className:"text-xl font-semibold text-gray-900",children:"Edit Item"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update the information for this inventory item"})]}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"itemname",className:"text-sm font-medium",children:"Item Name *"}),e.jsx(b,{id:"itemname",name:"item name",value:n.itemname,onChange:m,placeholder:"Enter item name",className:"w-full"}),i.itemname&&e.jsx("p",{className:"text-sm text-red-600",children:i.itemname})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"categoryid",className:"text-sm font-medium",children:"Category *"}),e.jsxs(y,{value:n.categoryid,onValueChange:a=>S("categoryid",a),children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Select category"})}),e.jsx(N,{children:I.map(a=>e.jsx(j,{value:a.id.toString(),children:a.name},a.id))})]}),i.categoryid&&e.jsx("p",{className:"text-sm text-red-600",children:i.categoryid})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"manufacturer",className:"text-sm font-medium",children:"Manufacturer"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(b,{id:"manufacturer",name:"manufacturer",value:n.manufacturer,onChange:m,placeholder:"Enter manufacturer",className:"w-full pl-10"})]}),i.manufacturer&&e.jsx("p",{className:"text-sm text-red-600",children:i.manufacturer})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"unit_type",className:"text-sm font-medium",children:"Unit of Measure *"}),e.jsxs(y,{value:n.unit_type,onValueChange:a=>S("unit_type",a),children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Select unit"})}),e.jsx(N,{children:k.map(a=>e.jsx(j,{value:a.value,children:a.label},a.value))})]}),i.unit_type&&e.jsx("p",{className:"text-sm text-red-600",children:i.unit_type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",className:"text-sm font-medium",children:"Description"}),e.jsx($,{id:"description",name:"description",value:n.description,onChange:m,placeholder:"Enter item description",rows:3,className:"w-full"}),i.description&&e.jsx("p",{className:"text-sm text-red-600",children:i.description})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Batch & Expiry Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{htmlFor:"batch_number",className:"text-sm font-medium",children:"Batch/Lot Number"}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:()=>v&&v(t),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(z,{className:"w-4 h-4"}),"Add Batch"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 pointer-events-none"}),e.jsxs(y,{value:n.batch_number||"",onValueChange:a=>{console.log("Select value changed to:",a),l("batch_number",a),console.log("Set batch_number to:",a)},children:[e.jsx(f,{className:"w-full pl-10",children:e.jsx(g,{placeholder:C?"Loading batches...":"Select a batch number"})}),e.jsx(N,{children:D.length>0?D.filter(a=>a.batch_number&&a.batch_number!=="new_batch"&&a.batch_number!=="N/A").map((a,r)=>e.jsx(j,{value:a.batch_number,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:a.batch_number}),a.expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Expires: ",new Date(a.expiry_date).toLocaleDateString()]})]})},`batch-${a.batch_number}-${r}`)):e.jsx("div",{className:"px-2 py-1 text-sm text-gray-500",children:"No batches available"})})]})]}),i.batch_number&&e.jsx("p",{className:"text-sm text-red-600",children:i.batch_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"expiry_date",className:"text-sm font-medium",children:"Expiry Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(b,{id:"expiry_date",name:"expiry_date",type:"date",value:n.expiry_date,onChange:m,className:"w-full pl-10"})]}),i.expiry_date&&e.jsx("p",{className:"text-sm text-red-600",children:i.expiry_date})]})]})]}),e.jsxs(P,{className:"flex gap-3 pt-6",children:[e.jsx(p,{type:"button",variant:"outline",onClick:u,className:"flex-1",children:"Cancel"}),e.jsx(p,{type:"submit",disabled:w,className:"flex-1",style:{backgroundColor:"#2C3E50"},children:w?"Updating...":"Update Item"})]})]})]})}):null};export{ye as default};
