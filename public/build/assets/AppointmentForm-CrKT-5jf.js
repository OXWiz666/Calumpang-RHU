import{j as e,a as xe}from"./app-COToGJgN.js";import{r as d,R as pe}from"./vendor-DkBadjUr.js";import{B as V}from"./button-618T9wCO.js";import{I as $}from"./input-CvzBKn0G.js";import{I as T}from"./InputError-CD-6riNT.js";import{L as N}from"./label-BwgxGJhu.js";import{S as Z,a as Q,b as D,c as ee,d as S}from"./select-mT28awoa.js";import we from"./CustomCalendar-C6cA9hyL.js";import{h as ae}from"./moment-C5S46NFB.js";import{t as ge,P as _e}from"./PhilippinesAddressLookup-3rN-B6FK.js";import{C as Se,a as Ce,b as ke,c as Me}from"./card-df5ukKsP.js";import{C as ce}from"./clock-D6yUBuGv.js";import"./pusher-DVtoYAOu.js";import"./index-_pe5jKXx.js";import"./react-icons.esm-Cp1qeI-T.js";import"./index-Bb8tsued.js";import"./index-CU4B9t9u.js";import"./index-CJsCTIuS.js";import"./tslib.es6-M_FJ09fS.js";import"./index-C10kMJZL.js";import"./index-D-XfwEVN.js";import"./index-DqxisvwK.js";import"./index-CmD3hvjm.js";import"./calendar-D9APQM2e.js";import"./createLucideIcon-BKWaAi2G.js";import"./chevron-left-B36-TXNE.js";import"./chevron-right-B3qqnx4D.js";import"./circle-x-Cf2XhiVO.js";import"./circle-alert-D8zT41fC.js";import"./circle-check-big-BQVCuGNJ.js";import"./format-Dp3w_Y3x.js";import"./isSameMonth-BOwz-_mK.js";import"./subMonths-B67T7BWk.js";import"./isBefore-Bnl9x5VB.js";const Ae=({isOpen:E,onClose:t,onConfirm:p,title:l="Confirmation",message:I="Are you sure you want to confirm this appointment?",confirmText:g="Confirm",cancelText:B="Cancel"})=>E?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm",onClick:t}),e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md mx-auto border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-center p-6 border-b border-gray-100",children:e.jsx("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})})}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:l}),e.jsx("p",{className:"text-gray-600 mb-8",children:I}),e.jsxs("div",{className:"flex space-x-4 justify-center",children:[e.jsxs("button",{onClick:t,className:"px-6 py-3 text-sm font-semibold text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{children:B})]}),e.jsxs("button",{onClick:p,className:"px-6 py-3 text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 transform hover:scale-105",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:g})]})]})]})]})})]}):null,Le=({isOpen:E,onClose:t,onVerified:p,appointmentData:l,verificationMethod:I})=>{const[g,B]=d.useState(""),[m,se]=d.useState(!1),[A,W]=d.useState(!1),[b,u]=d.useState(""),[L,O]=d.useState(300),[F,C]=d.useState(!1),[P,z]=d.useState(""),[R,k]=d.useState(""),[x,q]=d.useState(null),[f,U]=d.useState(0),[w,ie]=d.useState(!1),[Y,G]=d.useState("N/A"),[fe,de]=d.useState(""),X=c=>c==null?"N/A":c instanceof Date?c.toLocaleDateString():String(c),K=()=>{if(!l)return"N/A";let c=l.patient_name||l.name||l.full_name;if(!c){const h=l.first_name||l.firstName||l.firstname||"",y=l.last_name||l.lastName||l.Lastname||l.lastname||"";(h||y)&&(c=`${h} ${y}`.trim())}return c&&c.trim()!==""?c.trim():"N/A"};d.useEffect(()=>{if(F&&L>0){const c=setTimeout(()=>O(L-1),1e3);return()=>clearTimeout(c)}},[F,L]),d.useEffect(()=>{if(f>0){const c=setTimeout(()=>U(f-1),1e3);return()=>clearTimeout(c)}},[f]),d.useEffect(()=>{if(l){const c=K();G(c)}},[l]),d.useEffect(()=>{if(E){let c=l?.phone||l?.mobileNo||l?.contactno||(l?.mobileCountryCode&&l?.mobileNo?l.mobileCountryCode+l.mobileNo:null),h=l?.email||l?.emailAddress||l?.email_address;c&&(c=String(c).trim()),h&&(h=String(h).trim()),console.log("VerificationModal - appointmentData:",l),console.log("VerificationModal - extracted phone:",c,"type:",typeof c),console.log("VerificationModal - extracted email:",h,"type:",typeof h),z(c||""),k(h||""),c&&!h?q("sms"):h&&!c&&q("email")}},[E]);const te=async()=>{if(w){u("Please wait, generating verification code...");return}if(!x){u("Please select a verification method first.");return}ie(!0),u("");const c=Math.floor(1e5+Math.random()*9e5).toString();try{let h;x==="sms"?h=await fetch("/api/send-verification",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({appointment_id:l?.id||l?.appointment_id||null,method:"sms",contact:P,patient_name:Y,appointment_date:l?.date||l?.appointment_date,appointment_time:l?.time||l?.appointment_time,service_name:l?.service||l?.service_name||"General Consultation"})}):h=await fetch("/api/send-verification",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({appointment_id:l?.id||l?.appointment_id||null,method:"email",contact:R,patient_name:Y,appointment_date:l?.date||l?.appointment_date,appointment_time:l?.time||l?.appointment_time,service_name:l?.service||l?.service_name||"General Consultation"})});const y=await h.json();if(y.success){C(!0),O(300),U(120),u("");const J=y.data?.otp_code||y.data?.otp||c;de(J)}else{const J=y.message||`${x.toUpperCase()} sending failed. Please try again or contact support.`;u(J),console.error(`${x.toUpperCase()} sending failed:`,y.message)}}catch(h){console.error(`Error sending ${x.toUpperCase()}:`,h),u(`Network error: ${x.toUpperCase()} sending failed. Please check your connection and try again.`)}finally{ie(!1)}},M=async()=>{if(!g.trim()){u("Please enter the verification code");return}if(!x){u("Please select a verification method first.");return}se(!0),u("");try{const h=await(await fetch("/api/verify-code",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({verification_code:g,appointment_id:l?.id||l?.appointment_id||null,method:x,contact:x==="email"?R:P})})).json();if(h.success){console.log("OTP verified successfully, passing data to parent for appointment creation");const y={...l,firstname:l?.firstname||l?.first_name||"",lastname:l?.lastname||l?.last_name||"",email:l?.email||"",phone:P,date:l?.date||"",time:l?.time||"",service_name:l?.service_name||l?.servicename||"",subservice_name:l?.subservice_name||l?.subservicename||"",date_of_birth:l?.date_of_birth||l?.birth||"",gender:l?.gender||""};p(y)}else u(h.message||"Invalid verification code. Please try again.")}catch(c){console.error("Error verifying code:",c),u("Failed to verify code. Please try again.")}finally{se(!1)}},v=async()=>{if(f>0){u(`Please wait ${Math.ceil(f/60)} minutes before requesting another code.`);return}if(w){u("Please wait, generating verification code...");return}W(!0),u(""),B(""),O(300);try{await te()}catch{u("Failed to generate verification code. Please try again.")}finally{W(!1)}},ne=c=>{const h=Math.floor(c/60),y=c%60;return`${h}:${y.toString().padStart(2,"0")}`};return E?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs(Se,{className:"w-[500px] max-w-lg max-h-[90vh] shadow-lg rounded-lg flex flex-col",children:[e.jsxs(Ce,{className:"flex flex-row items-center justify-between pb-4 flex-shrink-0",children:[e.jsxs(ke,{className:"text-xl font-semibold flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Verify Your Appointment"]}),e.jsx(V,{variant:"ghost",onClick:t,className:"p-2",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs(Me,{className:"space-y-4 overflow-y-auto flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Please verify your appointment using the verification code below."}),!F&&(P||R)&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 text-center",children:"Choose Verification Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P&&e.jsx("button",{onClick:()=>q("sms"),className:`p-3 rounded-lg border-2 transition-all duration-200 ${x==="sms"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"text-xs font-medium",children:"SMS"}),e.jsx("span",{className:"text-xs text-gray-500",children:P})]})}),R&&e.jsx("button",{onClick:()=>q("email"),className:`p-3 rounded-lg border-2 transition-all duration-200 ${x==="email"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"text-xs font-medium",children:"Email"}),e.jsx("span",{className:"text-xs text-gray-500 truncate",children:R})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md border border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2 text-sm",children:"Appointment Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Date:"})," ",e.jsx("span",{className:"font-medium",children:X(l?.date)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Time:"})," ",e.jsx("span",{className:"font-medium",children:X(l?.time)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Service:"})," ",e.jsx("span",{className:"font-medium",children:X(l?.service)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Patient:"})," ",e.jsx("span",{className:"font-medium",children:Y})]})]})]}),F&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),e.jsx("p",{className:"text-sm font-medium text-green-800",children:x==="email"?"Email Sent Successfully":"SMS Sent Successfully"})]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:x==="email"?"Verification code sent to your email. Check your inbox and spam folder.":"Verification code sent to your phone. Check your SMS messages."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{htmlFor:"verificationCode",className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter Verification Code"}),e.jsx("input",{id:"verificationCode",type:"text",value:g,onChange:c=>B(c.target.value),placeholder:"Enter 6-digit code",className:"w-full max-w-xs px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-lg text-center tracking-widest font-mono",maxLength:6}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:x==="email"?"Enter the verification code sent to your email":"Enter the verification code sent to your phone"})]}),!F&&e.jsx("div",{className:"text-center",children:e.jsx(V,{onClick:te,disabled:w||A||!x,variant:"outline",size:"default",className:"px-6 py-2 text-blue-600 border-blue-200 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed",children:w||A?`Sending ${x?.toUpperCase()}...`:x?`Send ${x.toUpperCase()} Verification Code`:"Select Verification Method First"})})]}),F&&e.jsx("div",{className:"text-center space-y-2",children:L>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Code expires in ",e.jsx("span",{className:"font-bold text-orange-600",children:ne(L)})]}),f>0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Resend in ",Math.ceil(f/60),"m ",f%60,"s"]})]}),e.jsx(V,{onClick:v,disabled:A||f>0||w,variant:"outline",size:"sm",className:"px-4 py-2 text-blue-600 border-blue-200 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed",children:A||w?"Sending...":f>0?`Wait ${Math.ceil(f/60)}m`:"Send New Code"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Code expired"})}),e.jsx(V,{onClick:v,disabled:A||f>0||w,variant:"outline",size:"sm",className:"px-4 py-2 text-blue-600 border-blue-200 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed",children:A||w?"Sending...":f>0?`Wait ${Math.ceil(f/60)}m`:"Send New Code"})]})}),b&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-sm font-medium text-red-800",children:b})]})}),e.jsxs("div",{className:"flex justify-center space-x-3 mt-4",children:[e.jsx(V,{variant:"outline",onClick:t,disabled:m,size:"sm",className:"px-4 py-2",children:"Cancel"}),e.jsx(V,{onClick:M,disabled:m||!g.trim(),size:"sm",className:"px-4 py-2",children:m?"Verifying...":"Verify"})]})]})]})}):null},ms=({onSubmit:E=()=>{},formData:t,setFormData:p,errors:l,processing:I,services:g=[],setIsSubmitted:B})=>{if(console.log("AppointmentForm received formData:",t),console.log("formData type:",typeof t),console.log("formData is object:",typeof t=="object"&&t!==null),console.log("formData keys:",t&&typeof t=="object"?Object.keys(t):"not an object"),typeof t!="object"||t===null)return console.error("formData is not a valid object:",t),e.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Form Error"}),e.jsx("p",{className:"text-red-700",children:"There was an error loading the form data. Please refresh the page."})]});const m=xe().props.auth.user,[se,A]=d.useState(!1),[W,b]=d.useState(""),[u,L]=d.useState(!1),[O,F]=d.useState(!1),[C,P]=d.useState(!1),[z,R]=d.useState(null),[k,x]=d.useState(!1),[q,f]=d.useState(!1),[U,w]=d.useState(null),[ie,Y]=d.useState("email");d.useEffect(()=>{const i=new URLSearchParams(window.location.search).get("mode"),a=localStorage.getItem("rescheduleAppointmentData"),r=localStorage.getItem("existingPatientData"),o=localStorage.getItem("selectedPatientType");if(console.log("AppointmentForm useEffect - Mode Detection:",{mode:i,rescheduleAppointmentData:!!a,existingPatientData:!!r,patientType:o,isRescheduleMode:C,isExistingPatientMode:k}),i==="reschedule"&&a)try{const n=JSON.parse(a);P(!0),R(n),p(j=>({...typeof j=="object"&&j!==null?j:{},firstname:n.firstname||"",middlename:n.middlename||"",lastname:n.lastname||"",email:n.email||"",phone:n.phone||"",gender:n.gender||"",birth:n.date_of_birth||"",civil_status:n.civil_status||"",nationality:n.nationality||"",religion:n.religion||"",country:n.country||"",region:n.region||"",province:n.province||"",city:n.city||"",barangay:n.barangay||"",street:n.street||"",zip_code:n.zip_code||"",profile_picture:n.profile_picture||"",region_id:n.region_id||null,province_id:n.province_id||null,city_id:n.city_id||null,barangay_id:n.barangay_id||null,service:"",servicename:n.last_service||"",subservice:"",subservicename:n.last_subservice||""}))}catch(n){console.error("Error parsing reschedule data:",n)}else if(r&&o==="existing")try{const n=JSON.parse(r);x(!0),p(j=>({...typeof j=="object"&&j!==null?j:{},firstname:n.firstname||"",middlename:n.middlename||"",lastname:n.lastname||"",email:n.email||"",phone:n.phone?String(n.phone):"",gender:n.gender||"",birth:n.date_of_birth||"",civil_status:n.civil_status||"",nationality:n.nationality||"",religion:n.religion||"",country:n.country||"",region:n.region||"",province:n.province||"",city:n.city||"",barangay:n.barangay||"",street:n.street||"",zip_code:n.zip_code||"",profile_picture:n.profile_picture||"",region_id:n.region_id||null,province_id:n.province_id||null,city_id:n.city_id||null,barangay_id:n.barangay_id||null,service:"",servicename:"",subservice:"",subservicename:""})),L(!0)}catch(n){console.error("Error parsing existing patient data:",n)}else P(!1),x(!1),R(null)},[]),d.useEffect(()=>{if(C&&z&&g&&g.length>0){const s=g.find(i=>i.servicename===z.last_service);s&&(p(i=>({...typeof i=="object"&&i!==null?i:{},service:s.id,servicename:s.servicename})),fetch(`/services/get-sub-services/${s.id}`).then(i=>i.json()).then(i=>{y(i);const a=i.find(r=>r.subservicename===z.last_subservice);if(a&&(p(r=>({...typeof r=="object"&&r!==null?r:{},subservice:a.id,subservicename:a.subservicename})),H(a.time_slots),z.last_time)){const r=a.time_slots.find(o=>ae(o.time,"HH:mm:ss").format("hh:mm A")===z.last_time);r&&p(o=>({...typeof o=="object"&&o!==null?o:{},timeid:r.id,time:ae(r.time,"HH:mm:ss").format("hh:mm A")}))}}).catch(i=>{console.error("Error fetching sub-services:",i)}))}},[C,z,g]),d.useEffect(()=>()=>{},[]),d.useEffect(()=>{m&&!t.firstname&&!C&&!k&&(p({...typeof t=="object"&&t!==null?t:{},firstname:m.firstname,middlename:m.middlename??"",lastname:m.lastname,email:m.email,phone:m.contactno?String(m.contactno):"",servicename:"",service:"",gender:m.gender,birth:m.birth,priorityNumber:"",date_of_birth:m.birth||"",civil_status:m.civil_status||"",nationality:m.nationality||"",religion:m.religion||"",country:m.country||"",region:m.region||"",province:m.province||"",city:m.city||"",barangay:m.barangay||"",street:m.street||"",zip_code:m.zip_code||"",profile_picture:m.profile_picture||"",region_id:m.region_id||null,province_id:m.province_id||null,city_id:m.city_id||null,barangay_id:m.barangay_id||null}),L(!0))},[m]),d.useEffect(()=>{if(!m)if(ge.hasValidTokenSession()){const s=ge.getPatientData();s&&(p({...typeof t=="object"&&t!==null?t:{},firstname:s.firstname||"",middlename:s.middlename||"",lastname:s.lastname||"",email:s.email||"",phone:s.phone?String(s.phone):"",gender:s.sex||"",birth:s.birthdate||"",servicename:"",service:"",priorityNumber:"",date_of_birth:s.birthdate||"",civil_status:s.civilStatus||"",nationality:s.nationality||"",religion:s.religion||"",country:s.country||"",region:s.region||"",province:s.province||"",city:s.city||"",barangay:s.barangay||"",street:s.street||"",zip_code:s.zipCode||"",profile_picture:s.profileImage||"",region_id:s.region_id||null,province_id:s.province_id||null,city_id:s.city_id||null,barangay_id:s.barangay_id||null}),L(!0))}else{const s=localStorage.getItem("patientVerificationData");if(s)try{const i=JSON.parse(s);p({...typeof t=="object"&&t!==null?t:{},firstname:i.firstname||"",middlename:i.middlename||"",lastname:i.lastname||"",email:i.email||"",phone:i.phone?String(i.phone):"",gender:i.sex||"",birth:i.birthdate||"",servicename:"",service:"",priorityNumber:"",date_of_birth:i.birthdate||"",civil_status:i.civilStatus||"",nationality:i.nationality||"",religion:i.religion||"",country:i.country||"",region:i.region||"",province:i.province||"",city:i.city||"",barangay:i.barangay||"",street:i.street||"",zip_code:i.zipCode||"",profile_picture:i.profileImage||"",region_id:i.region_id||null,province_id:i.province_id||null,city_id:i.city_id||null,barangay_id:i.barangay_id||null}),localStorage.removeItem("patientVerificationData")}catch{}}},[]);const G=pe.useMemo(()=>!Array.isArray(g)||g.length===0?(console.warn("Services is not a valid array:",g),{}):g.reduce((s,i)=>(i&&i.id&&(s[i.id]=i),s),{}),[g]),[fe,de]=d.useState(new Date),X=()=>{A(!1),E(t)},K=(s,i=null)=>{if(!s)return;const a=i||t.date||new Date().toISOString().split("T")[0],r=`/services/get-sub-services/${s}?date=${a}`;console.log("Fetching subservices for service:",s,"date:",a),console.log("URL:",r),fetch(r).then(o=>(console.log("Response status:",o.status),console.log("Response ok:",o.ok),o.json())).then(o=>{if(console.log("Subservices data received:",o),console.log("Data type:",typeof o),console.log("Data length:",Array.isArray(o)?o.length:"Not an array"),y(o),o&&o.length>0){console.log("All subservices received:",o);const n=o.find(j=>j.id.toString()===t.subservice?.toString());console.log("Current subservice found:",n),console.log("Looking for subservice ID:",t.subservice),n&&n.time_slots?(console.log("Setting times array:",n.time_slots),console.log("Times array length:",n.time_slots.length),H(n.time_slots)):(console.log("No times found for current subservice"),console.log("Current subservice time_slots property:",n?.time_slots),H([]))}else console.log("No subservices data received"),H([])}).catch(o=>{console.error("Error fetching sub-services:",o),console.error("Error details:",o.message),console.error("Error stack:",o.stack),H([])})},te=s=>{console.log("handleDateChange received date:",s),console.log("date type:",typeof s),console.log("date instanceof Date:",s instanceof Date);let i;if(s instanceof Date){const a=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0");i=`${a}-${r}-${o}`}else i=s;console.log("converted dateString:",i),p(a=>({...typeof a=="object"&&a!==null?a:{},date:i})),t.service&&K(t.service,i)},M=s=>{const{name:i,value:a}=s.target;if(i==="phone"){const r=String(a).replace(/[^0-9+]/g,"");p(o=>({...typeof o=="object"&&o!==null?o:{},[i]:r}))}else p(r=>({...typeof r=="object"&&r!==null?r:{},[i]:a}))},v=(s,i)=>{p(a=>({...typeof a=="object"&&a!==null?a:{},[s]:i??null}))},ne=(s,i)=>{p(a=>({...typeof a=="object"&&a!==null?a:{},[s]:i}))},c=(s,i)=>s===0?{status:"Full",color:"red",icon:"✗"}:s<=2?{status:"Limited",color:"orange",icon:"!"}:s<=5?{status:"Moderate",color:"yellow",icon:"!"}:{status:"Available",color:"green",icon:"✓"},[h,y]=d.useState([]),[J,H]=d.useState([]),[re,me]=d.useState(!1),be=async()=>{if(!(!t.subservice||!t.date)){me(!0);try{const i=await(await fetch(`/services/get-sub-services/${t.service}?date=${t.date}`)).json();if(i&&i.length>0){const a=i.find(r=>r.id.toString()===t.subservice?.toString());a&&a.time_slots&&H(a.time_slots)}}catch(s){console.error("Error refreshing time slots:",s)}finally{me(!1)}}},oe=pe.useMemo(()=>!Array.isArray(h)||h.length===0?{}:h.reduce((s,i)=>(i&&i.id&&(s[i.id]=i),s),{}),[h]),[ve,je]=d.useState([]);d.useEffect(()=>{const s=G[t.service];je(s?.servicedays?.map(i=>i.day))},[t,G]);const _=()=>C&&!k,le=()=>C&&!k,he=async s=>{const i=s.phone?String(s.phone):"",a=s.email?String(s.email):"",r=a&&a.trim()!=="",o=i&&i.trim()!=="";if(!r&&!o){b("Please provide either email or phone number for verification"),window.scrollTo({top:0,behavior:"smooth"});return}Y(r?"email":"sms"),w({...s,id:null}),f(!0)},ye=async s=>{console.log("Verification successful! Creating appointment..."),console.log("Pending appointment data:",U),console.log("Verified appointment data from modal:",s),f(!1);try{console.log("Sending appointment creation request...");const i=s||U;console.log("Using appointment data:",i);const a=await fetch(route("patient.appoint.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(i)});console.log("Response status:",a.status);const r=await a.json();if(console.log("Appointment creation result after verification:",r),console.log("Priority number from result:",r.priority_number),console.log("Priority number from appointment_data:",r.appointment_data?.priority_number),r.success){console.log("Appointment created successfully! Showing confirmation..."),console.log("Current formData before update:",t),console.log("Result appointment_data:",r.appointment_data),B&&B(!0);const o={...t,...r.appointment_data,id:r.appointment_data.id,priorityNumber:r.appointment_data?.priority_number||r.priority_number||t.priorityNumber||"TEST123",referenceNumber:r.appointment_data.reference_number||r.reference_number||t.referenceNumber,firstname:r.appointment_data?.firstname||t.firstname||"",lastname:r.appointment_data?.lastname||t.lastname||"",middlename:r.appointment_data?.middlename||t.middlename||"",email:r.appointment_data?.email||t.email||"",phone:r.appointment_data?.phone||t.phone||"",gender:r.appointment_data?.gender||t.gender||"",date_of_birth:r.appointment_data?.date_of_birth||t.date_of_birth||"",birth:r.appointment_data?.date_of_birth||t.birth||t.date_of_birth||"",servicename:r.appointment_data?.service_name||t.servicename||"",subservicename:r.appointment_data?.subservice_name||t.subservicename||"",date:r.appointment_data?.date||t.date||"",time:r.appointment_data?.time||t.time||"",notes:r.appointment_data?.notes||t.notes||""};if(console.log("Setting form data with priority number:",o.priorityNumber),console.log("Setting form data with patient data:",{firstname:o.firstname,lastname:o.lastname,email:o.email,phone:o.phone}),console.log("Full new form data:",o),localStorage.setItem("confirmed_appointment_data",JSON.stringify(o)),console.log("Stored appointment data in localStorage:",o),o.email&&o.email.trim()!=="")try{console.log("Sending appointment confirmation email to:",o.email);const ue=await(await fetch("/api/sms/send-appointment-email",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({appointment_data:{email:o.email,firstname:o.firstname,lastname:o.lastname,date:o.date,time:o.time,service_name:o.servicename,subservice_name:o.subservicename,priority_number:o.priorityNumber,appointment_id:o.id,phone:o.phone,date_of_birth:o.date_of_birth}})})).json();ue.success?(console.log("Appointment confirmation email sent successfully"),window.toast&&window.toast.success("Appointment confirmation email sent successfully!")):(console.warn("Failed to send appointment confirmation email:",ue.message),window.toast&&window.toast.warning("Appointment created but email confirmation failed. Please check your email settings."))}catch(j){console.error("Error sending appointment confirmation email:",j),window.toast&&window.toast.error("Appointment created but email confirmation failed. Please contact support if needed.")}else console.log("No email address provided, skipping email confirmation");p(o);const n=new URL(window.location);n.searchParams.set("confirmed","true"),window.history.replaceState({},"",n),window.scrollTo({top:0,behavior:"smooth"})}else console.error("Appointment creation failed:",r),b(r.message||"Failed to create appointment after verification"),window.scrollTo({top:0,behavior:"smooth"})}catch(i){console.error("Error creating appointment after verification:",i),b("An error occurred while creating the appointment. Please try again."),window.scrollTo({top:0,behavior:"smooth"})}},Ne=()=>{f(!1),w(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:s=>s.preventDefault(),className:"space-y-6 bg-white p-6 rounded-lg shadow-sm",children:[C&&!k&&e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Reschedule Appointment"}),e.jsx("p",{className:"text-sm text-orange-700",children:"You are rescheduling your appointment. Personal information and service type are locked. You can change the sub-service, date, and time."})]})]})}),W&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-start space-x-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium text-sm",children:W})}),e.jsx("button",{onClick:()=>b(""),className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),u&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg flex items-start space-x-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:m?"Personal information is locked for authenticated users":"Personal information is locked after verification"}),e.jsx("p",{className:"text-xs mt-1",children:m?"Your account information cannot be modified here":"This information was verified and cannot be changed"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name",children:"First Name"}),e.jsx($,{id:"firstname",name:"firstname",value:t.firstname,onChange:M,placeholder:"Your First Name",disabled:u||_(),required:!0}),e.jsx(T,{message:l.firstname})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"middlename",children:"Middle Name"}),e.jsx($,{id:"middlename",name:"middlename",value:t.middlename,onChange:M,placeholder:"N/A",disabled:u||_(),required:!0}),e.jsx(T,{message:l.middlename})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"lastname",children:"Last Name"}),e.jsx($,{id:"lastname",name:"lastname",value:t.lastname,onChange:M,placeholder:"Your Last Name",disabled:u||_(),required:!0}),e.jsx(T,{message:l.lastname})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"email",children:"Email Address (Optional)"}),e.jsx($,{id:"email",name:"email",type:"email",value:t.email,onChange:M,placeholder:"juan@example.com",disabled:u||_()}),e.jsx(T,{message:l.email})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"phone",children:"Phone Number (Optional)"}),e.jsx($,{id:"phone",name:"phone",type:"tel",value:t.phone,onChange:M,placeholder:"+63 912 345 6789",disabled:u||_()}),e.jsx(T,{message:l.phone})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Additional Patient Information"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This information will be automatically stored in our Patient Record for future appointments"})]}),e.jsx("button",{type:"button",onClick:()=>F(!O),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:O?"Hide Details":"Show Details"})]}),O&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"date_of_birth",children:"Date of Birth"}),e.jsx($,{id:"date_of_birth",name:"date_of_birth",type:"date",value:t.date_of_birth,onChange:M,disabled:u||_()})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"gender",children:"Gender"}),e.jsxs(Z,{value:t.gender,onValueChange:s=>ne("gender",s),disabled:u||_(),children:[e.jsx(Q,{children:e.jsx(D,{placeholder:"Select gender"})}),e.jsxs(ee,{children:[e.jsx(S,{value:"Male",children:"Male"}),e.jsx(S,{value:"Female",children:"Female"}),e.jsx(S,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"civil_status",children:"Civil Status"}),e.jsxs(Z,{value:t.civil_status,onValueChange:s=>ne("civil_status",s),disabled:u||_(),children:[e.jsx(Q,{children:e.jsx(D,{placeholder:"Select status"})}),e.jsxs(ee,{children:[e.jsx(S,{value:"Single",children:"Single"}),e.jsx(S,{value:"Married",children:"Married"}),e.jsx(S,{value:"Widowed",children:"Widowed"}),e.jsx(S,{value:"Divorced",children:"Divorced"}),e.jsx(S,{value:"Separated",children:"Separated"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"nationality",children:"Nationality"}),e.jsx($,{id:"nationality",name:"nationality",value:t.nationality,onChange:M,placeholder:"e.g., Filipino",disabled:u||_()})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"religion",children:"Religion"}),e.jsx($,{id:"religion",name:"religion",value:t.religion,onChange:M,placeholder:"e.g., Catholic",disabled:u||_()})]})]}),e.jsx(_e,{formData:t,setFormData:p,isDisabled:u||_(),showStreet:!0,showZipCode:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Service Type"}),e.jsxs(Z,{value:t.service?.toString(),onValueChange:s=>{if(le())return;const i=G[s];i&&(v("service",i.id),v("servicename",i.servicename),v("date",null),v("subservice",""),v("subservicename",""),v("timeid",""),v("time",""),console.log("Service selected, fetching subservices for service:",i.id),K(i.id))},disabled:le(),children:[e.jsx(Q,{className:"w-full",children:e.jsx(D,{placeholder:"Select service",children:t.service?(g||[]).find(s=>s.id.toString()===t.service.toString())?.servicename:"Select service"})}),e.jsx(ee,{children:(g||[]).map(s=>e.jsx(S,{value:s.id,children:s.servicename},s.id))})]}),e.jsx(T,{message:l.service})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Service Sub Type"}),e.jsxs(Z,{value:t.subservice?.toString(),onValueChange:s=>{if(le())return;const i=oe[s];v("subservice",i.id??null),v("subservicename",i.subservicename??null),v("timeid",""),v("time",""),t.date?(console.log("Subservice selected, fetching fresh time slots for date:",t.date),K(t.service,t.date)):(console.log("Subservice selected, but no date selected yet"),H(i?.time_slots||[]))},disabled:le(),children:[e.jsx(Q,{className:"w-full",children:e.jsx(D,{placeholder:"Select Sub Service",children:t.subservice?h.find(s=>s.id.toString()===t.subservice.toString())?.subservicename:"Select Sub-Service"})}),e.jsx(ee,{children:h?.map((s,i)=>e.jsx(S,{value:s.id,children:s.subservicename},i))})]}),e.jsx(T,{message:l.subservice})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Appointment Date"}),e.jsx(we,{selectedDate:t.date,onDateSelect:te,hasPrograms:ve,serviceId:t.service,subserviceId:t.subservice}),e.jsx(T,{message:l.date})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Appointment Time"}),e.jsxs(Z,{value:t.timeid,onValueChange:s=>{if(re)return;const a=oe[t.subservice]?.time_slots?.find(r=>r.id==s);if(a&&a.available_slots===0){b("This time slot is full. Please select another time.");return}b(""),v("timeid",s??null),v("time",a?.time??null),setTimeout(()=>{be()},500)},disabled:re,children:[e.jsx(Q,{className:"w-full",children:e.jsx(D,{placeholder:"Select time",children:re?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),e.jsx("span",{className:"text-gray-500",children:"Updating slots..."})]}):t.timeid?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),t.time?ae(t.time,"HH:mm:ss").format("h:mm A"):"Invalid time"]}),(()=>{const s=oe[t.subservice]?.time_slots?.find(o=>o.id==t.timeid),i=s?.available_slots||0,a=s?.max_slots||5,r=c(i);return e.jsxs("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.color==="green"?"bg-green-100 text-green-700":r.color==="yellow"?"bg-yellow-100 text-yellow-700":r.color==="orange"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:[r.icon," ",i,"/",a]})})()]}):"Select time"})}),e.jsx(ee,{children:re?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-2"}),e.jsx("span",{className:"text-gray-500",children:"Updating slot availability..."})]}):J.length>0?J.map((s,i)=>{const a=s.available_slots||0,r=s.max_slots||5,o=c(a),n=a===0,j=t.timeid==s.id;return e.jsx(S,{value:s.id,disabled:n,className:`${n?"opacity-50 cursor-not-allowed":""} ${j?"bg-blue-50":""}`,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:`h-4 w-4 ${n?"text-gray-400":"text-gray-500"}`}),e.jsxs("span",{className:`font-medium ${n?"text-gray-400":""}`,children:[ae(s.time,"HH:mm:ss").format("h:mm A"),n&&" (Full)",j&&" (Selected)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${o.color==="green"?"bg-green-100 text-green-700":o.color==="yellow"?"bg-yellow-100 text-yellow-700":o.color==="orange"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:[e.jsx("span",{children:o.icon}),e.jsxs("span",{children:[a,"/",r]})]}),j&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]})]})},s.id)}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 text-gray-500",children:[e.jsx(ce,{className:"h-3 w-3 mb-2 text-gray-400"}),e.jsx("span",{className:"text-lg font-medium mb-2",children:"No time slots available"})]})})]}),e.jsx(T,{message:l.time}),W&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:W})})]})}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Slot Availability Legend"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 text-xs",children:"✓"})}),e.jsx("span",{className:"text-gray-600",children:"Available (6+ slots)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-yellow-600 text-xs",children:"!"})}),e.jsx("span",{className:"text-gray-600",children:"Moderate (3-5 slots)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-orange-600 text-xs",children:"!"})}),e.jsx("span",{className:"text-gray-600",children:"Limited (1-2 slots)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 text-xs",children:"✗"})}),e.jsx("span",{className:"text-gray-600",children:"Full (0 slots)"})]})]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:xe().props.auth.user&&!k?e.jsx(V,{onClick:s=>{s.preventDefault(),s.stopPropagation();const a=["firstname","lastname","service","date","time"].filter(r=>!t[r]||t[r].toString().trim()==="");if(a.length>0){const r={firstname:"First Name",lastname:"Last Name",service:"Service Type",date:"Appointment Date",time:"Appointment Time"},o=a.map(n=>r[n]||n);b(`Please fill in the following required fields: ${o.join(", ")}`),window.scrollTo({top:0,behavior:"smooth"});return}if(t.timeid){const o=oe[t.subservice]?.time_slots?.find(n=>n.id==t.timeid);if(o&&o.available_slots===0){b("The selected time slot is full. Please choose another time."),window.scrollTo({top:0,behavior:"smooth"});return}}b(""),E(t)},disabled:I,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105",children:I?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processing..."})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:C&&!k?"Reschedule Appointment":"Schedule Appointment"})]})}):k?e.jsx(V,{onClick:s=>{s.preventDefault(),s.stopPropagation();const a=["firstname","lastname","service","date","time"].filter(r=>!t[r]||t[r].toString().trim()==="");if(a.length>0){const r={firstname:"First Name",lastname:"Last Name",service:"Service Type",date:"Appointment Date",time:"Appointment Time"},o=a.map(n=>r[n]||n);b(`Please fill in the following required fields: ${o.join(", ")}`),window.scrollTo({top:0,behavior:"smooth"});return}b(""),he(t)},disabled:I,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105",children:I?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processing..."})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Book New Appointment"})]})}):e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ready to Book Your Appointment?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Complete your patient verification to access appointment booking and manage your health records."}),e.jsx(V,{onClick:s=>{s.preventDefault(),s.stopPropagation();const a=["firstname","lastname","service","date","time"].filter(r=>!t[r]||t[r].toString().trim()==="");if(a.length>0){const r={firstname:"First Name",lastname:"Last Name",service:"Service Type",date:"Appointment Date",time:"Appointment Time"},o=a.map(n=>r[n]||n);b(`Please fill in the following required fields: ${o.join(", ")}`),window.scrollTo({top:0,behavior:"smooth"});return}b(""),he(t)},className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Appoint Now!"})]})})]})})})]}),e.jsx(Ae,{isOpen:se,onClose:()=>A(!1),onConfirm:X,title:"Confirmation",message:"Are you sure you want to confirm this appointment?",confirmText:"Confirm",cancelText:"Cancel"}),e.jsx(Le,{isOpen:q,onClose:Ne,onVerified:ye,appointmentData:U,verificationMethod:ie})]})};export{ms as default};
