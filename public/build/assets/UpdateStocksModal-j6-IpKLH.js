import{u as T,j as e,r as z}from"./app-4lbu88kA.js";import{r as u}from"./vendor-DkBadjUr.js";import{D as O,a as $,b as V,c as R,d as H}from"./dialog-vlGViv4z.js";import{B as o}from"./button-BXpDG3fF.js";import{I as m}from"./input-N5zOrGrX.js";import{L as c}from"./label-xH30sM7L.js";import{T as U}from"./textarea-CpaS5p9M.js";import{S as k,a as S,b as C,c as q,d as w}from"./select-C-0693IG.js";import{z as v}from"./index-WHihrx3k.js";import{P as Q}from"./package-L7rgkkVO.js";import{m as K}from"./proxy-Dc_Gbux2.js";import{B as G}from"./building-2-DmPcAwng.js";import{H as J}from"./hash-AgYeaIxt.js";import{C as W}from"./calendar-D9APQM2e.js";import"./pusher-DVtoYAOu.js";import"./react-icons.esm-CCKgqiWC.js";import"./index-BzPzP57-.js";import"./index-KF1t5bS2.js";import"./tslib.es6-M_FJ09fS.js";import"./index-MO574hLd.js";import"./index-DyRdtInp.js";import"./index-DO3t3vkD.js";import"./index-Dyxvh50g.js";import"./index-BHGKAdXF.js";import"./index-DqxisvwK.js";import"./index-BWRETVzy.js";import"./createLucideIcon-BKWaAi2G.js";const Se=({open:x,onClose:p,item:s})=>{const[n,h]=u.useState({}),[D,I]=u.useState([]),[A,_]=u.useState(!1),{data:a,setData:l,post:E,processing:j,errors:X,reset:F}=T({item_id:s?.id||"",adjustment_type:"add",quantity:"",reason:"",supplier:"",batch_number:s?.batch_number||"",expiry_date:s?.expiry_date?new Date(s.expiry_date).toISOString().split("T")[0]:"",notes:"",minimum_stock:s?.minimumStock||0,maximum_stock:s?.maximumStock||0});u.useEffect(()=>{s&&x&&(l("item_id",s.id),l("batch_number",s.batchNumber||s.batch_number||""),l("expiry_date",s.expiryDate&&s.expiryDate!=="N/A"?new Date(s.expiryDate).toISOString().split("T")[0]:""),B())},[s,x]);const B=async()=>{if(s?.id){console.log("Fetching batches for item:",s.name,"ID:",s.id),_(!0);try{const t=`/pharmacist/inventory/item/${s.id}/batches?t=${Date.now()}`;console.log("API URL:",t);const r=await fetch(t);if(console.log("Response status:",r.status),r.ok){const i=await r.json();console.log("Received batches for item",s.name,":",i),I(i)}else console.error("API response not OK:",r.status,r.statusText)}catch(t){console.error("Error fetching batches:",t)}finally{_(!1)}}},f=()=>Number(s?.quantity??s?.stock?.stocks??0)||0,y=()=>{const t=f(),r=Number(a.quantity)||0;return a.adjustment_type==="add"?t+r:t-r},d=t=>{const r=Math.max(0,Number(a.quantity||0)+t);l("quantity",r)},M=()=>{const t={};(!a.quantity||Number(a.quantity)<=0)&&(t.quantity="Please enter a valid quantity"),a.adjustment_type||(t.adjustment_type="Please select an adjustment type");const r=y(),i=Number(a.maximum_stock||0);i>0&&r>i&&(t.quantity=`Projected stock (${r}) exceeds maximum (${i})`);const g=parseInt(a.minimum_stock)||0,b=parseInt(a.maximum_stock)||0;if(g<0&&(t.minimum_stock="Minimum stock level cannot be negative."),b<0&&(t.maximum_stock="Maximum stock level cannot be negative."),g>0&&b>0&&g>b&&(t.minimum_stock="Minimum stock level cannot be greater than maximum stock level."),(!a.batch_number||a.batch_number.trim()==="")&&(t.batch_number="Batch/Lot number is required."),!a.expiry_date||a.expiry_date.trim()==="")t.expiry_date="Expiry date is required.";else{const L=new Date(a.expiry_date),N=new Date;N.setHours(0,0,0,0),L<N&&(t.expiry_date="Expiry date cannot be in the past.")}return h(t),Object.keys(t).length===0},P=t=>{if(t.preventDefault(),!M()){v.error("Please fix the validation errors before submitting.");return}E(route("pharmacist.inventory.update-stocks"),{onSuccess:()=>{v.success("Stock updated successfully!"),p(),F(),z.visit(window.location.pathname,{method:"get"})},onError:r=>{console.error("Update stocks error:",r),v.error("Failed to update stock. Please try again.")},preserveScroll:!0})};return s?e.jsx(O,{open:x,onOpenChange:p,children:e.jsxs($,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Update Stocks - ",s.name]})}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Item Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Item:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[s.quantity||s.stock?.stocks||0," ",s.unit||s.unit_type||"units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.category?.name||s.category||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Manufacturer:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.manufacturer||"N/A"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium",children:"Adjustment Type"}),e.jsxs(k,{value:a.adjustment_type,onValueChange:t=>l("adjustment_type",t),children:[e.jsx(S,{className:"mt-1",children:e.jsx(C,{placeholder:"Select type"})}),e.jsx(q,{children:e.jsx(w,{value:"add",children:"Add Stock"})})]}),n.adjustment_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.adjustment_type})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"quantity",children:"Quantity *"}),e.jsx(m,{id:"quantity",type:"number",min:"1",value:a.quantity,onChange:t=>l("quantity",t.target.value),placeholder:"Enter quantity",className:"mt-1"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>d(-10),children:"-10"}),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>d(-1),children:"-1"}),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>d(1),children:"+1"}),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>d(10),children:"+10"})]}),n.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.quantity})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"reason",children:"Reason (Optional)"}),e.jsx(m,{id:"reason",value:a.reason,onChange:t=>l("reason",t.target.value),placeholder:"e.g., New delivery, correction, damage, audit (optional)",className:"mt-1"}),n.reason&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.reason})]})]}),e.jsxs(K.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Adjustment Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Current Stock:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[f()," ",s.unit||s.unit_type||"units"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Adjustment:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[a.adjustment_type==="add"?"+":"-",Number(a.quantity||0)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Projected Stock:"}),e.jsx("span",{className:`ml-2 font-medium ${y()<0?"text-red-600":""}`,children:y()})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"minimum_stock",children:"Minimum Stock Level"}),e.jsx(m,{id:"minimum_stock",type:"number",min:"0",value:a.minimum_stock,onChange:t=>{l("minimum_stock",t.target.value);const r=parseInt(t.target.value)||0,i={...n};r<0?i.minimum_stock="Minimum stock level cannot be negative.":delete i.minimum_stock,h(i)},placeholder:"0",className:"mt-1"}),n.minimum_stock&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.minimum_stock})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"maximum_stock",children:"Maximum Stock Level"}),e.jsx(m,{id:"maximum_stock",type:"number",min:"0",value:a.maximum_stock,onChange:t=>{l("maximum_stock",t.target.value);const r=parseInt(t.target.value)||0,i={...n};r<0?i.maximum_stock="Maximum stock level cannot be negative.":delete i.maximum_stock,h(i)},placeholder:"0",className:"mt-1"}),n.maximum_stock&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.maximum_stock})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(c,{htmlFor:"supplier",children:"Supplier"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(m,{id:"supplier",value:a.supplier,onChange:t=>l("supplier",t.target.value),placeholder:"Supplier name",className:"mt-1 pl-10"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"batch_number",children:"Batch/Lot Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400 z-10"}),e.jsxs(k,{value:a.batch_number,onValueChange:t=>l("batch_number",t),children:[e.jsx(S,{className:"mt-1 pl-10",children:e.jsx(C,{placeholder:A?"Loading batches...":"Select a batch number"})}),e.jsx(q,{children:D.filter(t=>t.batch_number&&t.batch_number!=="new_batch"&&t.batch_number!=="N/A").map((t,r)=>e.jsx(w,{value:t.batch_number,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.batch_number}),t.expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.expiry_date).toLocaleDateString()]})]})},`batch-${t.batch_number}-${r}`))})]})]}),n.batch_number&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.batch_number})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"expiry_date",children:"Expiry Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(m,{id:"expiry_date",type:"date",value:a.expiry_date,onChange:t=>l("expiry_date",t.target.value),className:"mt-1 pl-10",min:new Date().toISOString().split("T")[0]})]}),n.expiry_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.expiry_date})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"notes",children:"Notes"}),e.jsx(U,{id:"notes",value:a.notes,onChange:t=>l("notes",t.target.value),placeholder:"Any additional details...",className:"mt-1",rows:3})]}),e.jsxs(H,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:p,disabled:j,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:j,style:{backgroundColor:"#2C3E50"},children:j?"Adding...":"Add Stock"})]})]})]})}):null};export{Se as default};
